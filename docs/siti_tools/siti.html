<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>siti_tools.siti API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../siti_tools.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;siti_tools</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="class" href="#EnumArg">EnumArg</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#HdrMode">HdrMode</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#HdrMode.SDR">SDR</a>
                        </li>
                        <li>
                                <a class="variable" href="#HdrMode.HDR10">HDR10</a>
                        </li>
                        <li>
                                <a class="variable" href="#HdrMode.HLG">HLG</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ColorRange">ColorRange</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ColorRange.LIMITED">LIMITED</a>
                        </li>
                        <li>
                                <a class="variable" href="#ColorRange.FULL">FULL</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EotfFunction">EotfFunction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#EotfFunction.BT1886">BT1886</a>
                        </li>
                        <li>
                                <a class="variable" href="#EotfFunction.INV_SRGB">INV_SRGB</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CalculationDomain">CalculationDomain</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#CalculationDomain.PQ">PQ</a>
                        </li>
                        <li>
                                <a class="variable" href="#CalculationDomain.PU21">PU21</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Pu21Mode">Pu21Mode</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Pu21Mode.BANDING">BANDING</a>
                        </li>
                        <li>
                                <a class="variable" href="#Pu21Mode.BANDING_GLARE">BANDING_GLARE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Pu21Mode.PEAKS">PEAKS</a>
                        </li>
                        <li>
                                <a class="variable" href="#Pu21Mode.PEAKS_GLARE">PEAKS_GLARE</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SiTiCalculator">SiTiCalculator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SiTiCalculator.__init__">SiTiCalculator</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_HDR_MODE">DEFAULT_HDR_MODE</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_BIT_DEPTH">DEFAULT_BIT_DEPTH</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_COLOR_RANGE">DEFAULT_COLOR_RANGE</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_EOTF_FUNCTION">DEFAULT_EOTF_FUNCTION</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_CALCULATION_DOMAIN">DEFAULT_CALCULATION_DOMAIN</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_PU21_MODE">DEFAULT_PU21_MODE</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_GAMMA">DEFAULT_GAMMA</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_L_MIN">DEFAULT_L_MIN</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_L_MAX">DEFAULT_L_MAX</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_L_MIN_HDR">DEFAULT_L_MIN_HDR</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.DEFAULT_L_MAX_HDR">DEFAULT_L_MAX_HDR</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.LIMITED_RANGE">LIMITED_RANGE</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.from_settings">from_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.show_histogram">show_histogram</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.legacy">legacy</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.callbacks">callbacks</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.hdr_mode">hdr_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.bit_depth">bit_depth</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.color_range">color_range</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.eotf_function">eotf_function</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.calculation_domain">calculation_domain</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.pu21_mode">pu21_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.oetf_function_kwargs">oetf_function_kwargs</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.gamma">gamma</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.si_values">si_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.ti_values">ti_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#SiTiCalculator.last_input_file">last_input_file</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.get_general_settings">get_general_settings</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.si">si</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.ti">ti</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.eotf_1886">eotf_1886</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.eotf_inv_srgb">eotf_inv_srgb</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.apply_display_model">apply_display_model</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.oetf_pq">oetf_pq</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.oetf_pu21">oetf_pu21</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.eotf_hlg">eotf_hlg</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.normalize_to_original_range">normalize_to_original_range</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.normalize_to_original_si_range">normalize_to_original_si_range</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.normalize_between_0_1">normalize_between_0_1</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.add_frame_callback">add_frame_callback</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.plot_histogram">plot_histogram</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.calculate">calculate</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.get_csv_results">get_csv_results</a>
                        </li>
                        <li>
                                <a class="function" href="#SiTiCalculator.get_results">get_results</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../siti_tools.html">siti_tools</a><wbr>.siti    </h1>

                
                        <input id="mod-siti-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-siti-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># This file is part of siti_tools</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1"># MIT License</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1"># siti_tools, Copyright (c) 2021 Werner Robitza</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1"># in the Software without restriction, including without limitation the rights</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1"># copies of the Software, and to permit persons to whom the Software is</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1"># furnished to do so, subject to the following conditions:</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1">#</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1"># The above copyright notice and this permission notice shall be included in all</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># copies or substantial portions of the Software.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1">#</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="c1"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="c1"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="c1"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="c1"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1"># SOFTWARE.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">plotille</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_container</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;siti&quot;</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnumArg</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HdrMode</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    Mode of HDR calculation, should be SDR by default</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="n">SDR</span> <span class="o">=</span> <span class="s2">&quot;sdr&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="n">HDR10</span> <span class="o">=</span> <span class="s2">&quot;hdr10&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="n">HLG</span> <span class="o">=</span> <span class="s2">&quot;hlg&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ColorRange</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    Limited or full range, where limited is from 16-235, and full is from 0-255.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="n">LIMITED</span> <span class="o">=</span> <span class="s2">&quot;limited&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">FULL</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EotfFunction</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    EOTF for converting SDR</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">BT1886</span> <span class="o">=</span> <span class="s2">&quot;bt1886&quot;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">INV_SRGB</span> <span class="o">=</span> <span class="s2">&quot;inv_srgb&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CalculationDomain</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    Domain in which to calculate SI/TI</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="n">PQ</span> <span class="o">=</span> <span class="s2">&quot;pq&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="n">PU21</span> <span class="o">=</span> <span class="s2">&quot;pu21&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Pu21Mode</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">BANDING</span> <span class="o">=</span> <span class="s2">&quot;banding&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="n">BANDING_GLARE</span> <span class="o">=</span> <span class="s2">&quot;banding_glare&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="n">PEAKS</span> <span class="o">=</span> <span class="s2">&quot;peaks&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="n">PEAKS_GLARE</span> <span class="o">=</span> <span class="s2">&quot;peaks_glare&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SiTiCalculator</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="n">DEFAULT_HDR_MODE</span> <span class="o">=</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="n">DEFAULT_BIT_DEPTH</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># or 10, 12</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">DEFAULT_COLOR_RANGE</span> <span class="o">=</span> <span class="n">ColorRange</span><span class="o">.</span><span class="n">LIMITED</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="n">DEFAULT_EOTF_FUNCTION</span> <span class="o">=</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="n">DEFAULT_CALCULATION_DOMAIN</span> <span class="o">=</span> <span class="n">CalculationDomain</span><span class="o">.</span><span class="n">PQ</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="n">DEFAULT_PU21_MODE</span> <span class="o">=</span> <span class="n">Pu21Mode</span><span class="o">.</span><span class="n">BANDING</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="n">DEFAULT_GAMMA</span> <span class="o">=</span> <span class="mf">2.4</span>  <span class="c1"># for BT.1886</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="n">DEFAULT_L_MIN</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">DEFAULT_L_MAX</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="n">DEFAULT_L_MIN_HDR</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="n">DEFAULT_L_MAX_HDR</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="c1"># Limited range values for different bit depths</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">LIMITED_RANGE</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">235</span><span class="p">},</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="mi">10</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">940</span><span class="p">},</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="mi">12</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">3760</span><span class="p">},</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="p">}</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">SiTiCalculator</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">hdr_mode</span><span class="p">:</span> <span class="n">HdrMode</span> <span class="o">=</span> <span class="n">DEFAULT_HDR_MODE</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_BIT_DEPTH</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">color_range</span><span class="p">:</span> <span class="n">ColorRange</span> <span class="o">=</span> <span class="n">DEFAULT_COLOR_RANGE</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">DEFAULT_EOTF_FUNCTION</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">calculation_domain</span><span class="p">:</span> <span class="n">CalculationDomain</span> <span class="o">=</span> <span class="n">DEFAULT_CALCULATION_DOMAIN</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">pu21_mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">DEFAULT_PU21_MODE</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">show_histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">legacy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="p">):</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Create a new SI/TI calculator</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        Args:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">            hdr_mode (HdrMode, optional): Select SDR, HDR10 or HLG. Defaults to SDR.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">            bit_depth (int, optional): 8, 10 or 12. Defaults to 8.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">            color_range (ColorRange, optional): Set the color range (limited or full). Defaults to limited.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">            eotf_function (EotfFunction, optional): EOTF function for converting SDR to HDR. Defaults to BT.1886.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            calculation_domain (CalculationDomain, optional): Domain to calculate SI/TI in. Defaults to PQ.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">            l_max (float, optional): Set the peak display luminance in cd/m2. Defaults to 300 (SDR) or 1000 (HDR).</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            l_min (float, optional): Set the black display luminance in cd/m2. Defaults to 0.1 (SDR) or 0.01 (HDR).</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">            gamma (float, optional): Set the BT.1886 gamma. Defaults to 2.4.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            pu21_mode (Pu21Mode, optional): Set the default PU21 mode. Defaults to BANDING.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">            verbose (bool, optional): Show verbose logging for the first frame.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">            show_histogram (bool, optional): Show a histogram for the first frame (computation-intensive).</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            legacy (bool, optional): Use legacy SI/TI calculation. Defaults to False.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_histogram</span> <span class="o">=</span> <span class="n">show_histogram</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="n">legacy</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">=</span> <span class="n">hdr_mode</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">bit_depth</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bit depth must be one of 8, 10, 12&quot;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">=</span> <span class="n">bit_depth</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">=</span> <span class="n">color_range</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span> <span class="o">=</span> <span class="n">eotf_function</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">=</span> <span class="n">calculation_domain</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span> <span class="o">=</span> <span class="n">pu21_mode</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">==</span> <span class="n">CalculationDomain</span><span class="o">.</span><span class="n">PQ</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pq</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pu21</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="c1"># overwrite the default depending on HDR type</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX_HDR</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="n">l_max</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">l_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN_HDR</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="n">l_min</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_general_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        A dictionary of settings used for the calculation</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="s2">&quot;calculation_domain&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span><span class="p">),</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="s2">&quot;hdr_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="p">),</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="s2">&quot;bit_depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="s2">&quot;color_range&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_range</span><span class="p">),</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="s2">&quot;eotf_function&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">),</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="s2">&quot;l_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="s2">&quot;l_min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="s2">&quot;pu21_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span><span class="p">),</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="s2">&quot;legacy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="p">}</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI of a frame</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        Args:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">            frame_data (ndarray): 2D array of input frame data</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        Returns:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">            float: SI</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="c1"># calculate horizontal/vertical operators</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">sob_x</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">sob_y</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="c1"># crop output to valid window, calculate gradient magnitude</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">sob_x</span><span class="p">,</span> <span class="n">sob_y</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">si</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ti</span><span class="p">(</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        Calculate TI between two frames.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Args:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            frame_data (ndarray): 2D array of current frame data</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            previous_frame_data (ndarray): 2D array of previous frame data, must be of same size as current frame</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">            float: TI, or None if previous frame data is not given</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="c1"># TODO: check array dimensions equal between both args</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="n">previous_frame_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frame_data</span> <span class="o">-</span> <span class="n">previous_frame_data</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_1886</span><span class="p">(</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        Electro-optical transfer function defined in ITU-R Rec. BT.1886</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        Args:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">            gamma: exponent</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">            l_min: minimum luminance</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">            l_max: maximum luminance</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        Note:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">            As the mapping to display luminance happens outside of this function, l_min and l_max are set to 0.0 and 1.0,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">            respectively. If you change these values while using this function in the context of SI/TI calculation, your</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">            output will be wrong. You can however change the values when using this function in a standalone fashion.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        Returns:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_inv_srgb</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        Inverse sRGB electro-optical transfer function</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        Args:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        Returns:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="o">*</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="mf">12.92</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_display_model</span><span class="p">(</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        Apply the SDR EOTF</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        Args:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            Other arguments: see calculate()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Returns:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            frame_data: pixel values in the physical domain.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &lt; 0&quot;</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &gt; 1&quot;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_1886</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="c1"># note that l_min/l_max are not passed here on purpose, as they are set to 0.0 and 1.0,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="c1"># and mapped outside of the eotf_1886 function</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">elif</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">INV_SRGB</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_inv_srgb</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown EOTF function!&quot;</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">fn</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pq</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        Perceptual quantizer opto-electrical transfer function defined in ITU-R Rec. BT.2100</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        Args:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">            frame_data: pixel values expected to be in the physical luminance between 0 and 10,000 cd/m^2</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        Returns:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="mf">78.84375</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mf">0.1593017578125</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">c1</span> <span class="o">=</span> <span class="mf">0.8359375</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">c2</span> <span class="o">=</span> <span class="mf">18.8515625</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">c3</span> <span class="o">=</span> <span class="mf">18.6875</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">lm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="c1"># FIXME: this might return an error if input is negative, see https://stackoverflow.com/q/45384602/</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">lm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">c1</span> <span class="o">*</span> <span class="n">lm1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lm1</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pu21</span><span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">Pu21Mode</span><span class="o">.</span><span class="n">BANDING</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        PU21 OETF, see https://github.com/gfxdisp/pu21</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">            mode (Pu21Mode), defaults to Pu21Mode.BANDING</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        Returns:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding&quot;</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                <span class="mf">1.070275272</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="mf">0.4088273932</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                <span class="mf">0.153224308</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                <span class="mf">0.2520326168</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="mf">1.063512885</span><span class="p">,</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="mf">1.14115047</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="mf">521.4527484</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="p">]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5580e-07</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">520.4673</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding_glare&quot;</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="mf">0.353487901</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                <span class="mf">0.3734658629</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="mf">8.277049286e-05</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                <span class="mf">0.9062562627</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="mf">0.09150303166</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="mf">0.9099517204</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="mf">596.3148142</span><span class="p">,</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="p">]</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">5.4705e-10</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">595.3939</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks&quot;</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="mf">1.043882782</span><span class="p">,</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="mf">0.6459495343</span><span class="p">,</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                <span class="mf">0.3194584211</span><span class="p">,</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                <span class="mf">0.374025247</span><span class="p">,</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                <span class="mf">1.114783422</span><span class="p">,</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="mf">1.095360363</span><span class="p">,</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="mf">384.9217577</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="p">]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">1.3674e-07</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">380.9853</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks_glare&quot;</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="mf">816.885024</span><span class="p">,</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                <span class="mf">1479.463946</span><span class="p">,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>                <span class="mf">0.001253215609</span><span class="p">,</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>                <span class="mf">0.9329636822</span><span class="p">,</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                <span class="mf">0.06746643971</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="mf">1.573435413</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="mf">419.6006374</span><span class="p">,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="p">]</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.7360e-08</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">407.5066</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode specified for PU21&quot;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="c1"># scale frame_data to the range 0.005 - 10,000</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="c1"># disabled since the input is already in physical luminance</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="c1"># frame_data = frame_data * 10000.0</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="c1"># frame_data = np.maximum(frame_data, 0.05)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                <span class="p">(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                <span class="p">),</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>            <span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="c1"># get the output into the range [0, 1]</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_max</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_hlg</span><span class="p">(</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN_HDR</span><span class="p">,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX_HDR</span><span class="p">,</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        Hybrid log-gamma opto-electrical transfer function defined in ITU-T Rec. BT.2100</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        Args:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">            frame_data: pixel values expected to be in the range [0, 1]</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Returns:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">            frame_data: pixel values in the physical luminance up to 10,000 cd/m^2</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.17883277</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.02372241</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="mf">1.00429347</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="o">&lt;=</span> <span class="mf">1000.0</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">+</span> <span class="mf">0.42</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">l_max</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="c1"># NOTE: The following is only valid when the function is applied to the Y channel.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="c1"># If frame_data was a color channel (R, G, or B), the correct implementation would be:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="c1"># (l_max - l_min) * np.power(Y, gamma - 1.0) * frame_data + l_min,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="c1"># where Y would be obtained from linearized R, G, B channels.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        Normalize frame data in the range [0, 1] to their original range, based on</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        bit depth, e.g. from [0, 1] to [0, 255].</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_si_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">        Normalize frame data in the range [0, 1] to [0, 255], which was the original</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">        range for SI/TI.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_between_0_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Normalize frame data in the range [0, x] to [0, 1], based on bit depth and color range.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">==</span> <span class="n">ColorRange</span><span class="o">.</span><span class="n">LIMITED</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="c1"># Get the limited range values for the current bit depth</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="n">limited_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">limited_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="c1"># Check if input is within expected limited range</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">input_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="n">input_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>            <span class="c1"># Provide a warning if values are outside limited range</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="k">if</span> <span class="n">input_min</span> <span class="o">&lt;</span> <span class="n">limited_min</span> <span class="ow">or</span> <span class="n">input_max</span> <span class="o">&gt;</span> <span class="n">limited_max</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input appears to be full range, but it is treated as limited range! &quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input range is [</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_min</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_max</span><span class="p">)</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected range for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="si">}</span><span class="s2">-bit limited content [</span><span class="si">{</span><span class="n">limited_min</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">limited_max</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                    <span class="s2">&quot;Specify the range as full instead.&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                <span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="c1"># Normalize from limited range directly to [0, 1]</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">limited_max</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="c1"># Full range: normalize from [0, 2^bit_depth - 1] to [0, 1]</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="k">return</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_frame_callback</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">callback_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="p">):</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a function that gets called whenever a frame&#39;s values are available</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">        Args:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">            callback_fn (Callable[[float, Union[float, None], int], None]): The function that should get called. It will receive SI, TI and the frame number.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback_fn</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="k">return</span> <span class="n">plotille</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="n">frame_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI and TI from an input file.</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">        Returns two arrays and one integer, the first array being the SI values, the</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">        second array being the TI values. The first element of the TI value array will</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        always be 0. The integer will be equal to the number of frames read.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        You can also get the results later via .get_results()</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">        Args:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">            input_file (str): input file path</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">            num_frames (int): number of frames to calculate. Defaults to 0 (unlimited).</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">        Returns:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">            [[float], [float|None], int]: [si_values], [ti_values], frame count</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="o">=</span> <span class="n">input_file</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="n">current_frame</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="k">for</span> <span class="n">frame_data</span> <span class="ow">in</span> <span class="n">read_container</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">current_frame</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Original frame data&quot;</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>            <span class="c1"># Normalize frame data according to bit depth between 0 and 1.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>            <span class="c1"># This will transform [0, 255] to [0, 1], and [0, 1023] to [0, 1] etc.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>            <span class="c1"># For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>            <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_between_0_1</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Frame data after normalization between 0 and 1&quot;</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                <span class="c1"># in legacy mode we&#39;ll compute the values directly in the SDR domain</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                <span class="k">pass</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">apply_display_model</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>                        <span class="n">frame_data</span><span class="p">,</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>                        <span class="n">eotf_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">,</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>                        <span class="n">l_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>                        <span class="n">l_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                        <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                    <span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after apply_display_model for SDR (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                        <span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>                    <span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>                        <span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HDR10</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>                    <span class="c1"># nothing to do, we are already in PQ domain</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                    <span class="c1"># TODO allow using Pu21 here?</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                    <span class="k">pass</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HLG</span><span class="p">:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_hlg</span><span class="p">(</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                    <span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after eotf_hlg for HLG with l_min/l_max settings </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                        <span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>                    <span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>                        <span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid HDR mode &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">si_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>            <span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>                    <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">ti</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">))</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>                <span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">si_value</span><span class="p">))</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">))</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="n">frame_data</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>            <span class="n">current_frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>                <span class="n">callback</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">,</span> <span class="n">current_frame</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>            <span class="k">if</span> <span class="n">num_frames</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">current_frame</span> <span class="o">&gt;=</span> <span class="n">num_frames</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_csv_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">        Return a CSV string with the results.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="sd">        Note that this does not output all data. Also, the first TI value will be output as &quot;None&quot;.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="c1"># prepend a zero here</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="n">ti_values_to_output</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">]</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;ti&quot;</span><span class="p">])</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="n">ti_values_to_output</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>        <span class="p">):</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>                <span class="p">{</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>                    <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>                    <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>                    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>                    <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>                    <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>                <span class="p">}</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">        Get a JSON-serializable result dictionary with SI, TI values, as well as used settings.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">        Returns:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">            dict: A dictionary containing &quot;si&quot;, &quot;ti&quot; arrays, &quot;settings&quot; as a dict, and the &quot;input_file&quot; name.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>            <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>            <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_general_settings</span><span class="p">(),</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>            <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>            <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>        <span class="p">}</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log_frame_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>            <span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">], mean </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">, median </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>        <span class="p">)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_histogram</span><span class="p">:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">frame_data</span><span class="p">))</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<span class="default_value">&lt;Logger siti (WARNING)&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
    

                </section>
                <section id="EnumArg">
                            <input id="EnumArg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EnumArg</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="EnumArg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EnumArg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EnumArg-42"><a href="#EnumArg-42"><span class="linenos">42</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EnumArg</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="EnumArg-43"><a href="#EnumArg-43"><span class="linenos">43</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EnumArg-44"><a href="#EnumArg-44"><span class="linenos">44</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li><p>attribute access:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
<li><p>value lookup:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
<li><p>name lookup:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
</ul>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="EnumArg.name" class="variable">name</dd>
                <dd id="EnumArg.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="HdrMode">
                            <input id="HdrMode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HdrMode</span><wbr>(<span class="base"><a href="#EnumArg">EnumArg</a></span>):

                <label class="view-source-button" for="HdrMode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HdrMode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HdrMode-47"><a href="#HdrMode-47"><span class="linenos">47</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HdrMode</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="HdrMode-48"><a href="#HdrMode-48"><span class="linenos">48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HdrMode-49"><a href="#HdrMode-49"><span class="linenos">49</span></a><span class="sd">    Mode of HDR calculation, should be SDR by default</span>
</span><span id="HdrMode-50"><a href="#HdrMode-50"><span class="linenos">50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HdrMode-51"><a href="#HdrMode-51"><span class="linenos">51</span></a>
</span><span id="HdrMode-52"><a href="#HdrMode-52"><span class="linenos">52</span></a>    <span class="n">SDR</span> <span class="o">=</span> <span class="s2">&quot;sdr&quot;</span>
</span><span id="HdrMode-53"><a href="#HdrMode-53"><span class="linenos">53</span></a>    <span class="n">HDR10</span> <span class="o">=</span> <span class="s2">&quot;hdr10&quot;</span>
</span><span id="HdrMode-54"><a href="#HdrMode-54"><span class="linenos">54</span></a>    <span class="n">HLG</span> <span class="o">=</span> <span class="s2">&quot;hlg&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Mode of HDR calculation, should be SDR by default</p>
</div>


                            <div id="HdrMode.SDR" class="classattr">
                                <div class="attr variable">
            <span class="name">SDR</span>        =
<span class="default_value">&lt;<a href="#HdrMode.SDR">HdrMode.SDR</a>: &#39;sdr&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#HdrMode.SDR"></a>
    
    

                            </div>
                            <div id="HdrMode.HDR10" class="classattr">
                                <div class="attr variable">
            <span class="name">HDR10</span>        =
<span class="default_value">&lt;<a href="#HdrMode.HDR10">HdrMode.HDR10</a>: &#39;hdr10&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#HdrMode.HDR10"></a>
    
    

                            </div>
                            <div id="HdrMode.HLG" class="classattr">
                                <div class="attr variable">
            <span class="name">HLG</span>        =
<span class="default_value">&lt;<a href="#HdrMode.HLG">HdrMode.HLG</a>: &#39;hlg&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#HdrMode.HLG"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="HdrMode.name" class="variable">name</dd>
                <dd id="HdrMode.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ColorRange">
                            <input id="ColorRange-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ColorRange</span><wbr>(<span class="base"><a href="#EnumArg">EnumArg</a></span>):

                <label class="view-source-button" for="ColorRange-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColorRange"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColorRange-57"><a href="#ColorRange-57"><span class="linenos">57</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ColorRange</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="ColorRange-58"><a href="#ColorRange-58"><span class="linenos">58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ColorRange-59"><a href="#ColorRange-59"><span class="linenos">59</span></a><span class="sd">    Limited or full range, where limited is from 16-235, and full is from 0-255.</span>
</span><span id="ColorRange-60"><a href="#ColorRange-60"><span class="linenos">60</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ColorRange-61"><a href="#ColorRange-61"><span class="linenos">61</span></a>
</span><span id="ColorRange-62"><a href="#ColorRange-62"><span class="linenos">62</span></a>    <span class="n">LIMITED</span> <span class="o">=</span> <span class="s2">&quot;limited&quot;</span>
</span><span id="ColorRange-63"><a href="#ColorRange-63"><span class="linenos">63</span></a>    <span class="n">FULL</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Limited or full range, where limited is from 16-235, and full is from 0-255.</p>
</div>


                            <div id="ColorRange.LIMITED" class="classattr">
                                <div class="attr variable">
            <span class="name">LIMITED</span>        =
<span class="default_value">&lt;<a href="#ColorRange.LIMITED">ColorRange.LIMITED</a>: &#39;limited&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ColorRange.LIMITED"></a>
    
    

                            </div>
                            <div id="ColorRange.FULL" class="classattr">
                                <div class="attr variable">
            <span class="name">FULL</span>        =
<span class="default_value">&lt;<a href="#ColorRange.FULL">ColorRange.FULL</a>: &#39;full&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ColorRange.FULL"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="ColorRange.name" class="variable">name</dd>
                <dd id="ColorRange.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="EotfFunction">
                            <input id="EotfFunction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EotfFunction</span><wbr>(<span class="base"><a href="#EnumArg">EnumArg</a></span>):

                <label class="view-source-button" for="EotfFunction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EotfFunction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EotfFunction-66"><a href="#EotfFunction-66"><span class="linenos">66</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EotfFunction</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="EotfFunction-67"><a href="#EotfFunction-67"><span class="linenos">67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EotfFunction-68"><a href="#EotfFunction-68"><span class="linenos">68</span></a><span class="sd">    EOTF for converting SDR</span>
</span><span id="EotfFunction-69"><a href="#EotfFunction-69"><span class="linenos">69</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EotfFunction-70"><a href="#EotfFunction-70"><span class="linenos">70</span></a>
</span><span id="EotfFunction-71"><a href="#EotfFunction-71"><span class="linenos">71</span></a>    <span class="n">BT1886</span> <span class="o">=</span> <span class="s2">&quot;bt1886&quot;</span>
</span><span id="EotfFunction-72"><a href="#EotfFunction-72"><span class="linenos">72</span></a>    <span class="n">INV_SRGB</span> <span class="o">=</span> <span class="s2">&quot;inv_srgb&quot;</span>
</span></pre></div>


            <div class="docstring"><p>EOTF for converting SDR</p>
</div>


                            <div id="EotfFunction.BT1886" class="classattr">
                                <div class="attr variable">
            <span class="name">BT1886</span>        =
<span class="default_value">&lt;<a href="#EotfFunction.BT1886">EotfFunction.BT1886</a>: &#39;bt1886&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#EotfFunction.BT1886"></a>
    
    

                            </div>
                            <div id="EotfFunction.INV_SRGB" class="classattr">
                                <div class="attr variable">
            <span class="name">INV_SRGB</span>        =
<span class="default_value">&lt;<a href="#EotfFunction.INV_SRGB">EotfFunction.INV_SRGB</a>: &#39;inv_srgb&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#EotfFunction.INV_SRGB"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="EotfFunction.name" class="variable">name</dd>
                <dd id="EotfFunction.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CalculationDomain">
                            <input id="CalculationDomain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CalculationDomain</span><wbr>(<span class="base"><a href="#EnumArg">EnumArg</a></span>):

                <label class="view-source-button" for="CalculationDomain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalculationDomain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalculationDomain-75"><a href="#CalculationDomain-75"><span class="linenos">75</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CalculationDomain</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="CalculationDomain-76"><a href="#CalculationDomain-76"><span class="linenos">76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalculationDomain-77"><a href="#CalculationDomain-77"><span class="linenos">77</span></a><span class="sd">    Domain in which to calculate SI/TI</span>
</span><span id="CalculationDomain-78"><a href="#CalculationDomain-78"><span class="linenos">78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CalculationDomain-79"><a href="#CalculationDomain-79"><span class="linenos">79</span></a>
</span><span id="CalculationDomain-80"><a href="#CalculationDomain-80"><span class="linenos">80</span></a>    <span class="n">PQ</span> <span class="o">=</span> <span class="s2">&quot;pq&quot;</span>
</span><span id="CalculationDomain-81"><a href="#CalculationDomain-81"><span class="linenos">81</span></a>    <span class="n">PU21</span> <span class="o">=</span> <span class="s2">&quot;pu21&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Domain in which to calculate SI/TI</p>
</div>


                            <div id="CalculationDomain.PQ" class="classattr">
                                <div class="attr variable">
            <span class="name">PQ</span>        =
<span class="default_value">&lt;<a href="#CalculationDomain.PQ">CalculationDomain.PQ</a>: &#39;pq&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#CalculationDomain.PQ"></a>
    
    

                            </div>
                            <div id="CalculationDomain.PU21" class="classattr">
                                <div class="attr variable">
            <span class="name">PU21</span>        =
<span class="default_value">&lt;<a href="#CalculationDomain.PU21">CalculationDomain.PU21</a>: &#39;pu21&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#CalculationDomain.PU21"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="CalculationDomain.name" class="variable">name</dd>
                <dd id="CalculationDomain.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Pu21Mode">
                            <input id="Pu21Mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Pu21Mode</span><wbr>(<span class="base"><a href="#EnumArg">EnumArg</a></span>):

                <label class="view-source-button" for="Pu21Mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pu21Mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pu21Mode-84"><a href="#Pu21Mode-84"><span class="linenos">84</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Pu21Mode</span><span class="p">(</span><span class="n">EnumArg</span><span class="p">):</span>
</span><span id="Pu21Mode-85"><a href="#Pu21Mode-85"><span class="linenos">85</span></a>    <span class="n">BANDING</span> <span class="o">=</span> <span class="s2">&quot;banding&quot;</span>
</span><span id="Pu21Mode-86"><a href="#Pu21Mode-86"><span class="linenos">86</span></a>    <span class="n">BANDING_GLARE</span> <span class="o">=</span> <span class="s2">&quot;banding_glare&quot;</span>
</span><span id="Pu21Mode-87"><a href="#Pu21Mode-87"><span class="linenos">87</span></a>    <span class="n">PEAKS</span> <span class="o">=</span> <span class="s2">&quot;peaks&quot;</span>
</span><span id="Pu21Mode-88"><a href="#Pu21Mode-88"><span class="linenos">88</span></a>    <span class="n">PEAKS_GLARE</span> <span class="o">=</span> <span class="s2">&quot;peaks_glare&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Create a collection of name/value pairs.</p>

<p>Example enumeration:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre>
</div>

<p>Access them by:</p>

<ul>
<li><p>attribute access:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
<li><p>value lookup:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
<li><p>name lookup:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Color</span><span class="p">[</span><span class="s1">&#39;RED&#39;</span><span class="p">]</span>
<span class="go">&lt;Color.RED: 1&gt;</span>
</code></pre>
</div></li>
</ul>

<p>Enumerations can be iterated over, and know how many members they have:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">3</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span>
<span class="go">[&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</span>
</code></pre>
</div>

<p>Methods can be added to enumerations, and members can have their own
attributes -- see the documentation for details.</p>
</div>


                            <div id="Pu21Mode.BANDING" class="classattr">
                                <div class="attr variable">
            <span class="name">BANDING</span>        =
<span class="default_value">&lt;<a href="#Pu21Mode.BANDING">Pu21Mode.BANDING</a>: &#39;banding&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Pu21Mode.BANDING"></a>
    
    

                            </div>
                            <div id="Pu21Mode.BANDING_GLARE" class="classattr">
                                <div class="attr variable">
            <span class="name">BANDING_GLARE</span>        =
<span class="default_value">&lt;<a href="#Pu21Mode.BANDING_GLARE">Pu21Mode.BANDING_GLARE</a>: &#39;banding_glare&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Pu21Mode.BANDING_GLARE"></a>
    
    

                            </div>
                            <div id="Pu21Mode.PEAKS" class="classattr">
                                <div class="attr variable">
            <span class="name">PEAKS</span>        =
<span class="default_value">&lt;<a href="#Pu21Mode.PEAKS">Pu21Mode.PEAKS</a>: &#39;peaks&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Pu21Mode.PEAKS"></a>
    
    

                            </div>
                            <div id="Pu21Mode.PEAKS_GLARE" class="classattr">
                                <div class="attr variable">
            <span class="name">PEAKS_GLARE</span>        =
<span class="default_value">&lt;<a href="#Pu21Mode.PEAKS_GLARE">Pu21Mode.PEAKS_GLARE</a>: &#39;peaks_glare&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Pu21Mode.PEAKS_GLARE"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="Pu21Mode.name" class="variable">name</dd>
                <dd id="Pu21Mode.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SiTiCalculator">
                            <input id="SiTiCalculator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SiTiCalculator</span>:

                <label class="view-source-button" for="SiTiCalculator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator-91"><a href="#SiTiCalculator-91"><span class="linenos"> 91</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SiTiCalculator</span><span class="p">:</span>
</span><span id="SiTiCalculator-92"><a href="#SiTiCalculator-92"><span class="linenos"> 92</span></a>    <span class="n">DEFAULT_HDR_MODE</span> <span class="o">=</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="SiTiCalculator-93"><a href="#SiTiCalculator-93"><span class="linenos"> 93</span></a>    <span class="n">DEFAULT_BIT_DEPTH</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># or 10, 12</span>
</span><span id="SiTiCalculator-94"><a href="#SiTiCalculator-94"><span class="linenos"> 94</span></a>    <span class="n">DEFAULT_COLOR_RANGE</span> <span class="o">=</span> <span class="n">ColorRange</span><span class="o">.</span><span class="n">LIMITED</span>
</span><span id="SiTiCalculator-95"><a href="#SiTiCalculator-95"><span class="linenos"> 95</span></a>    <span class="n">DEFAULT_EOTF_FUNCTION</span> <span class="o">=</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span>
</span><span id="SiTiCalculator-96"><a href="#SiTiCalculator-96"><span class="linenos"> 96</span></a>    <span class="n">DEFAULT_CALCULATION_DOMAIN</span> <span class="o">=</span> <span class="n">CalculationDomain</span><span class="o">.</span><span class="n">PQ</span>
</span><span id="SiTiCalculator-97"><a href="#SiTiCalculator-97"><span class="linenos"> 97</span></a>    <span class="n">DEFAULT_PU21_MODE</span> <span class="o">=</span> <span class="n">Pu21Mode</span><span class="o">.</span><span class="n">BANDING</span>
</span><span id="SiTiCalculator-98"><a href="#SiTiCalculator-98"><span class="linenos"> 98</span></a>    <span class="n">DEFAULT_GAMMA</span> <span class="o">=</span> <span class="mf">2.4</span>  <span class="c1"># for BT.1886</span>
</span><span id="SiTiCalculator-99"><a href="#SiTiCalculator-99"><span class="linenos"> 99</span></a>    <span class="n">DEFAULT_L_MIN</span> <span class="o">=</span> <span class="mf">0.1</span>
</span><span id="SiTiCalculator-100"><a href="#SiTiCalculator-100"><span class="linenos">100</span></a>    <span class="n">DEFAULT_L_MAX</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="SiTiCalculator-101"><a href="#SiTiCalculator-101"><span class="linenos">101</span></a>    <span class="n">DEFAULT_L_MIN_HDR</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span id="SiTiCalculator-102"><a href="#SiTiCalculator-102"><span class="linenos">102</span></a>    <span class="n">DEFAULT_L_MAX_HDR</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span><span id="SiTiCalculator-103"><a href="#SiTiCalculator-103"><span class="linenos">103</span></a>
</span><span id="SiTiCalculator-104"><a href="#SiTiCalculator-104"><span class="linenos">104</span></a>    <span class="c1"># Limited range values for different bit depths</span>
</span><span id="SiTiCalculator-105"><a href="#SiTiCalculator-105"><span class="linenos">105</span></a>    <span class="n">LIMITED_RANGE</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SiTiCalculator-106"><a href="#SiTiCalculator-106"><span class="linenos">106</span></a>        <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">235</span><span class="p">},</span>
</span><span id="SiTiCalculator-107"><a href="#SiTiCalculator-107"><span class="linenos">107</span></a>        <span class="mi">10</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">940</span><span class="p">},</span>
</span><span id="SiTiCalculator-108"><a href="#SiTiCalculator-108"><span class="linenos">108</span></a>        <span class="mi">12</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">3760</span><span class="p">},</span>
</span><span id="SiTiCalculator-109"><a href="#SiTiCalculator-109"><span class="linenos">109</span></a>    <span class="p">}</span>
</span><span id="SiTiCalculator-110"><a href="#SiTiCalculator-110"><span class="linenos">110</span></a>
</span><span id="SiTiCalculator-111"><a href="#SiTiCalculator-111"><span class="linenos">111</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-112"><a href="#SiTiCalculator-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="SiTiCalculator-113"><a href="#SiTiCalculator-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="n">SiTiCalculator</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="SiTiCalculator-114"><a href="#SiTiCalculator-114"><span class="linenos">114</span></a>
</span><span id="SiTiCalculator-115"><a href="#SiTiCalculator-115"><span class="linenos">115</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SiTiCalculator-116"><a href="#SiTiCalculator-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SiTiCalculator-117"><a href="#SiTiCalculator-117"><span class="linenos">117</span></a>        <span class="n">hdr_mode</span><span class="p">:</span> <span class="n">HdrMode</span> <span class="o">=</span> <span class="n">DEFAULT_HDR_MODE</span><span class="p">,</span>
</span><span id="SiTiCalculator-118"><a href="#SiTiCalculator-118"><span class="linenos">118</span></a>        <span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_BIT_DEPTH</span><span class="p">,</span>
</span><span id="SiTiCalculator-119"><a href="#SiTiCalculator-119"><span class="linenos">119</span></a>        <span class="n">color_range</span><span class="p">:</span> <span class="n">ColorRange</span> <span class="o">=</span> <span class="n">DEFAULT_COLOR_RANGE</span><span class="p">,</span>
</span><span id="SiTiCalculator-120"><a href="#SiTiCalculator-120"><span class="linenos">120</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">DEFAULT_EOTF_FUNCTION</span><span class="p">,</span>
</span><span id="SiTiCalculator-121"><a href="#SiTiCalculator-121"><span class="linenos">121</span></a>        <span class="n">calculation_domain</span><span class="p">:</span> <span class="n">CalculationDomain</span> <span class="o">=</span> <span class="n">DEFAULT_CALCULATION_DOMAIN</span><span class="p">,</span>
</span><span id="SiTiCalculator-122"><a href="#SiTiCalculator-122"><span class="linenos">122</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator-123"><a href="#SiTiCalculator-123"><span class="linenos">123</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator-124"><a href="#SiTiCalculator-124"><span class="linenos">124</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator-125"><a href="#SiTiCalculator-125"><span class="linenos">125</span></a>        <span class="n">pu21_mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">DEFAULT_PU21_MODE</span><span class="p">,</span>
</span><span id="SiTiCalculator-126"><a href="#SiTiCalculator-126"><span class="linenos">126</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator-127"><a href="#SiTiCalculator-127"><span class="linenos">127</span></a>        <span class="n">show_histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator-128"><a href="#SiTiCalculator-128"><span class="linenos">128</span></a>        <span class="n">legacy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator-129"><a href="#SiTiCalculator-129"><span class="linenos">129</span></a>    <span class="p">):</span>
</span><span id="SiTiCalculator-130"><a href="#SiTiCalculator-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-131"><a href="#SiTiCalculator-131"><span class="linenos">131</span></a><span class="sd">        Create a new SI/TI calculator</span>
</span><span id="SiTiCalculator-132"><a href="#SiTiCalculator-132"><span class="linenos">132</span></a>
</span><span id="SiTiCalculator-133"><a href="#SiTiCalculator-133"><span class="linenos">133</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-134"><a href="#SiTiCalculator-134"><span class="linenos">134</span></a><span class="sd">            hdr_mode (HdrMode, optional): Select SDR, HDR10 or HLG. Defaults to SDR.</span>
</span><span id="SiTiCalculator-135"><a href="#SiTiCalculator-135"><span class="linenos">135</span></a><span class="sd">            bit_depth (int, optional): 8, 10 or 12. Defaults to 8.</span>
</span><span id="SiTiCalculator-136"><a href="#SiTiCalculator-136"><span class="linenos">136</span></a><span class="sd">            color_range (ColorRange, optional): Set the color range (limited or full). Defaults to limited.</span>
</span><span id="SiTiCalculator-137"><a href="#SiTiCalculator-137"><span class="linenos">137</span></a><span class="sd">            eotf_function (EotfFunction, optional): EOTF function for converting SDR to HDR. Defaults to BT.1886.</span>
</span><span id="SiTiCalculator-138"><a href="#SiTiCalculator-138"><span class="linenos">138</span></a><span class="sd">            calculation_domain (CalculationDomain, optional): Domain to calculate SI/TI in. Defaults to PQ.</span>
</span><span id="SiTiCalculator-139"><a href="#SiTiCalculator-139"><span class="linenos">139</span></a><span class="sd">            l_max (float, optional): Set the peak display luminance in cd/m2. Defaults to 300 (SDR) or 1000 (HDR).</span>
</span><span id="SiTiCalculator-140"><a href="#SiTiCalculator-140"><span class="linenos">140</span></a><span class="sd">            l_min (float, optional): Set the black display luminance in cd/m2. Defaults to 0.1 (SDR) or 0.01 (HDR).</span>
</span><span id="SiTiCalculator-141"><a href="#SiTiCalculator-141"><span class="linenos">141</span></a><span class="sd">            gamma (float, optional): Set the BT.1886 gamma. Defaults to 2.4.</span>
</span><span id="SiTiCalculator-142"><a href="#SiTiCalculator-142"><span class="linenos">142</span></a><span class="sd">            pu21_mode (Pu21Mode, optional): Set the default PU21 mode. Defaults to BANDING.</span>
</span><span id="SiTiCalculator-143"><a href="#SiTiCalculator-143"><span class="linenos">143</span></a><span class="sd">            verbose (bool, optional): Show verbose logging for the first frame.</span>
</span><span id="SiTiCalculator-144"><a href="#SiTiCalculator-144"><span class="linenos">144</span></a><span class="sd">            show_histogram (bool, optional): Show a histogram for the first frame (computation-intensive).</span>
</span><span id="SiTiCalculator-145"><a href="#SiTiCalculator-145"><span class="linenos">145</span></a><span class="sd">            legacy (bool, optional): Use legacy SI/TI calculation. Defaults to False.</span>
</span><span id="SiTiCalculator-146"><a href="#SiTiCalculator-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-147"><a href="#SiTiCalculator-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="SiTiCalculator-148"><a href="#SiTiCalculator-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_histogram</span> <span class="o">=</span> <span class="n">show_histogram</span>
</span><span id="SiTiCalculator-149"><a href="#SiTiCalculator-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="n">legacy</span>
</span><span id="SiTiCalculator-150"><a href="#SiTiCalculator-150"><span class="linenos">150</span></a>
</span><span id="SiTiCalculator-151"><a href="#SiTiCalculator-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator-152"><a href="#SiTiCalculator-152"><span class="linenos">152</span></a>
</span><span id="SiTiCalculator-153"><a href="#SiTiCalculator-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">=</span> <span class="n">hdr_mode</span>
</span><span id="SiTiCalculator-154"><a href="#SiTiCalculator-154"><span class="linenos">154</span></a>
</span><span id="SiTiCalculator-155"><a href="#SiTiCalculator-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">bit_depth</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
</span><span id="SiTiCalculator-156"><a href="#SiTiCalculator-156"><span class="linenos">156</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bit depth must be one of 8, 10, 12&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-157"><a href="#SiTiCalculator-157"><span class="linenos">157</span></a>
</span><span id="SiTiCalculator-158"><a href="#SiTiCalculator-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">=</span> <span class="n">bit_depth</span>
</span><span id="SiTiCalculator-159"><a href="#SiTiCalculator-159"><span class="linenos">159</span></a>
</span><span id="SiTiCalculator-160"><a href="#SiTiCalculator-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">=</span> <span class="n">color_range</span>
</span><span id="SiTiCalculator-161"><a href="#SiTiCalculator-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span> <span class="o">=</span> <span class="n">eotf_function</span>
</span><span id="SiTiCalculator-162"><a href="#SiTiCalculator-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">=</span> <span class="n">calculation_domain</span>
</span><span id="SiTiCalculator-163"><a href="#SiTiCalculator-163"><span class="linenos">163</span></a>
</span><span id="SiTiCalculator-164"><a href="#SiTiCalculator-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span> <span class="o">=</span> <span class="n">pu21_mode</span>
</span><span id="SiTiCalculator-165"><a href="#SiTiCalculator-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SiTiCalculator-166"><a href="#SiTiCalculator-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">==</span> <span class="n">CalculationDomain</span><span class="o">.</span><span class="n">PQ</span><span class="p">:</span>
</span><span id="SiTiCalculator-167"><a href="#SiTiCalculator-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pq</span>
</span><span id="SiTiCalculator-168"><a href="#SiTiCalculator-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-169"><a href="#SiTiCalculator-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pu21</span>
</span><span id="SiTiCalculator-170"><a href="#SiTiCalculator-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span>
</span><span id="SiTiCalculator-171"><a href="#SiTiCalculator-171"><span class="linenos">171</span></a>
</span><span id="SiTiCalculator-172"><a href="#SiTiCalculator-172"><span class="linenos">172</span></a>        <span class="c1"># overwrite the default depending on HDR type</span>
</span><span id="SiTiCalculator-173"><a href="#SiTiCalculator-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator-174"><a href="#SiTiCalculator-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SiTiCalculator-175"><a href="#SiTiCalculator-175"><span class="linenos">175</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX</span>
</span><span id="SiTiCalculator-176"><a href="#SiTiCalculator-176"><span class="linenos">176</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="SiTiCalculator-177"><a href="#SiTiCalculator-177"><span class="linenos">177</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX_HDR</span>
</span><span id="SiTiCalculator-178"><a href="#SiTiCalculator-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator-179"><a href="#SiTiCalculator-179"><span class="linenos">179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-180"><a href="#SiTiCalculator-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="n">l_max</span>
</span><span id="SiTiCalculator-181"><a href="#SiTiCalculator-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="n">l_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator-182"><a href="#SiTiCalculator-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SiTiCalculator-183"><a href="#SiTiCalculator-183"><span class="linenos">183</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN</span>
</span><span id="SiTiCalculator-184"><a href="#SiTiCalculator-184"><span class="linenos">184</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="SiTiCalculator-185"><a href="#SiTiCalculator-185"><span class="linenos">185</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN_HDR</span>
</span><span id="SiTiCalculator-186"><a href="#SiTiCalculator-186"><span class="linenos">186</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator-187"><a href="#SiTiCalculator-187"><span class="linenos">187</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-188"><a href="#SiTiCalculator-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="n">l_min</span>
</span><span id="SiTiCalculator-189"><a href="#SiTiCalculator-189"><span class="linenos">189</span></a>
</span><span id="SiTiCalculator-190"><a href="#SiTiCalculator-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="SiTiCalculator-191"><a href="#SiTiCalculator-191"><span class="linenos">191</span></a>
</span><span id="SiTiCalculator-192"><a href="#SiTiCalculator-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator-193"><a href="#SiTiCalculator-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator-194"><a href="#SiTiCalculator-194"><span class="linenos">194</span></a>
</span><span id="SiTiCalculator-195"><a href="#SiTiCalculator-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-196"><a href="#SiTiCalculator-196"><span class="linenos">196</span></a>
</span><span id="SiTiCalculator-197"><a href="#SiTiCalculator-197"><span class="linenos">197</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_general_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SiTiCalculator-198"><a href="#SiTiCalculator-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-199"><a href="#SiTiCalculator-199"><span class="linenos">199</span></a><span class="sd">        A dictionary of settings used for the calculation</span>
</span><span id="SiTiCalculator-200"><a href="#SiTiCalculator-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-201"><a href="#SiTiCalculator-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="SiTiCalculator-202"><a href="#SiTiCalculator-202"><span class="linenos">202</span></a>            <span class="s2">&quot;calculation_domain&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span><span class="p">),</span>
</span><span id="SiTiCalculator-203"><a href="#SiTiCalculator-203"><span class="linenos">203</span></a>            <span class="s2">&quot;hdr_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="p">),</span>
</span><span id="SiTiCalculator-204"><a href="#SiTiCalculator-204"><span class="linenos">204</span></a>            <span class="s2">&quot;bit_depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="SiTiCalculator-205"><a href="#SiTiCalculator-205"><span class="linenos">205</span></a>            <span class="s2">&quot;color_range&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_range</span><span class="p">),</span>
</span><span id="SiTiCalculator-206"><a href="#SiTiCalculator-206"><span class="linenos">206</span></a>            <span class="s2">&quot;eotf_function&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">),</span>
</span><span id="SiTiCalculator-207"><a href="#SiTiCalculator-207"><span class="linenos">207</span></a>            <span class="s2">&quot;l_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="SiTiCalculator-208"><a href="#SiTiCalculator-208"><span class="linenos">208</span></a>            <span class="s2">&quot;l_min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="SiTiCalculator-209"><a href="#SiTiCalculator-209"><span class="linenos">209</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="SiTiCalculator-210"><a href="#SiTiCalculator-210"><span class="linenos">210</span></a>            <span class="s2">&quot;pu21_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span><span class="p">),</span>
</span><span id="SiTiCalculator-211"><a href="#SiTiCalculator-211"><span class="linenos">211</span></a>            <span class="s2">&quot;legacy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">,</span>
</span><span id="SiTiCalculator-212"><a href="#SiTiCalculator-212"><span class="linenos">212</span></a>            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
</span><span id="SiTiCalculator-213"><a href="#SiTiCalculator-213"><span class="linenos">213</span></a>        <span class="p">}</span>
</span><span id="SiTiCalculator-214"><a href="#SiTiCalculator-214"><span class="linenos">214</span></a>
</span><span id="SiTiCalculator-215"><a href="#SiTiCalculator-215"><span class="linenos">215</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-216"><a href="#SiTiCalculator-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SiTiCalculator-217"><a href="#SiTiCalculator-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI of a frame</span>
</span><span id="SiTiCalculator-218"><a href="#SiTiCalculator-218"><span class="linenos">218</span></a>
</span><span id="SiTiCalculator-219"><a href="#SiTiCalculator-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-220"><a href="#SiTiCalculator-220"><span class="linenos">220</span></a><span class="sd">            frame_data (ndarray): 2D array of input frame data</span>
</span><span id="SiTiCalculator-221"><a href="#SiTiCalculator-221"><span class="linenos">221</span></a>
</span><span id="SiTiCalculator-222"><a href="#SiTiCalculator-222"><span class="linenos">222</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-223"><a href="#SiTiCalculator-223"><span class="linenos">223</span></a><span class="sd">            float: SI</span>
</span><span id="SiTiCalculator-224"><a href="#SiTiCalculator-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-225"><a href="#SiTiCalculator-225"><span class="linenos">225</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="SiTiCalculator-226"><a href="#SiTiCalculator-226"><span class="linenos">226</span></a>
</span><span id="SiTiCalculator-227"><a href="#SiTiCalculator-227"><span class="linenos">227</span></a>        <span class="c1"># calculate horizontal/vertical operators</span>
</span><span id="SiTiCalculator-228"><a href="#SiTiCalculator-228"><span class="linenos">228</span></a>        <span class="n">sob_x</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SiTiCalculator-229"><a href="#SiTiCalculator-229"><span class="linenos">229</span></a>        <span class="n">sob_y</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SiTiCalculator-230"><a href="#SiTiCalculator-230"><span class="linenos">230</span></a>
</span><span id="SiTiCalculator-231"><a href="#SiTiCalculator-231"><span class="linenos">231</span></a>        <span class="c1"># crop output to valid window, calculate gradient magnitude</span>
</span><span id="SiTiCalculator-232"><a href="#SiTiCalculator-232"><span class="linenos">232</span></a>        <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">sob_x</span><span class="p">,</span> <span class="n">sob_y</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SiTiCalculator-233"><a href="#SiTiCalculator-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">si</span>
</span><span id="SiTiCalculator-234"><a href="#SiTiCalculator-234"><span class="linenos">234</span></a>
</span><span id="SiTiCalculator-235"><a href="#SiTiCalculator-235"><span class="linenos">235</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-236"><a href="#SiTiCalculator-236"><span class="linenos">236</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ti</span><span class="p">(</span>
</span><span id="SiTiCalculator-237"><a href="#SiTiCalculator-237"><span class="linenos">237</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
</span><span id="SiTiCalculator-238"><a href="#SiTiCalculator-238"><span class="linenos">238</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="SiTiCalculator-239"><a href="#SiTiCalculator-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-240"><a href="#SiTiCalculator-240"><span class="linenos">240</span></a><span class="sd">        Calculate TI between two frames.</span>
</span><span id="SiTiCalculator-241"><a href="#SiTiCalculator-241"><span class="linenos">241</span></a>
</span><span id="SiTiCalculator-242"><a href="#SiTiCalculator-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-243"><a href="#SiTiCalculator-243"><span class="linenos">243</span></a><span class="sd">            frame_data (ndarray): 2D array of current frame data</span>
</span><span id="SiTiCalculator-244"><a href="#SiTiCalculator-244"><span class="linenos">244</span></a><span class="sd">            previous_frame_data (ndarray): 2D array of previous frame data, must be of same size as current frame</span>
</span><span id="SiTiCalculator-245"><a href="#SiTiCalculator-245"><span class="linenos">245</span></a>
</span><span id="SiTiCalculator-246"><a href="#SiTiCalculator-246"><span class="linenos">246</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-247"><a href="#SiTiCalculator-247"><span class="linenos">247</span></a><span class="sd">            float: TI, or None if previous frame data is not given</span>
</span><span id="SiTiCalculator-248"><a href="#SiTiCalculator-248"><span class="linenos">248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-249"><a href="#SiTiCalculator-249"><span class="linenos">249</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="SiTiCalculator-250"><a href="#SiTiCalculator-250"><span class="linenos">250</span></a>        <span class="c1"># TODO: check array dimensions equal between both args</span>
</span><span id="SiTiCalculator-251"><a href="#SiTiCalculator-251"><span class="linenos">251</span></a>
</span><span id="SiTiCalculator-252"><a href="#SiTiCalculator-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">previous_frame_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator-253"><a href="#SiTiCalculator-253"><span class="linenos">253</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-254"><a href="#SiTiCalculator-254"><span class="linenos">254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-255"><a href="#SiTiCalculator-255"><span class="linenos">255</span></a>            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frame_data</span> <span class="o">-</span> <span class="n">previous_frame_data</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SiTiCalculator-256"><a href="#SiTiCalculator-256"><span class="linenos">256</span></a>
</span><span id="SiTiCalculator-257"><a href="#SiTiCalculator-257"><span class="linenos">257</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-258"><a href="#SiTiCalculator-258"><span class="linenos">258</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_1886</span><span class="p">(</span>
</span><span id="SiTiCalculator-259"><a href="#SiTiCalculator-259"><span class="linenos">259</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator-260"><a href="#SiTiCalculator-260"><span class="linenos">260</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator-261"><a href="#SiTiCalculator-261"><span class="linenos">261</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SiTiCalculator-262"><a href="#SiTiCalculator-262"><span class="linenos">262</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="SiTiCalculator-263"><a href="#SiTiCalculator-263"><span class="linenos">263</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-264"><a href="#SiTiCalculator-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-265"><a href="#SiTiCalculator-265"><span class="linenos">265</span></a><span class="sd">        Electro-optical transfer function defined in ITU-R Rec. BT.1886</span>
</span><span id="SiTiCalculator-266"><a href="#SiTiCalculator-266"><span class="linenos">266</span></a>
</span><span id="SiTiCalculator-267"><a href="#SiTiCalculator-267"><span class="linenos">267</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-268"><a href="#SiTiCalculator-268"><span class="linenos">268</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="SiTiCalculator-269"><a href="#SiTiCalculator-269"><span class="linenos">269</span></a><span class="sd">            gamma: exponent</span>
</span><span id="SiTiCalculator-270"><a href="#SiTiCalculator-270"><span class="linenos">270</span></a><span class="sd">            l_min: minimum luminance</span>
</span><span id="SiTiCalculator-271"><a href="#SiTiCalculator-271"><span class="linenos">271</span></a><span class="sd">            l_max: maximum luminance</span>
</span><span id="SiTiCalculator-272"><a href="#SiTiCalculator-272"><span class="linenos">272</span></a><span class="sd">        Note:</span>
</span><span id="SiTiCalculator-273"><a href="#SiTiCalculator-273"><span class="linenos">273</span></a><span class="sd">            As the mapping to display luminance happens outside of this function, l_min and l_max are set to 0.0 and 1.0,</span>
</span><span id="SiTiCalculator-274"><a href="#SiTiCalculator-274"><span class="linenos">274</span></a><span class="sd">            respectively. If you change these values while using this function in the context of SI/TI calculation, your</span>
</span><span id="SiTiCalculator-275"><a href="#SiTiCalculator-275"><span class="linenos">275</span></a><span class="sd">            output will be wrong. You can however change the values when using this function in a standalone fashion.</span>
</span><span id="SiTiCalculator-276"><a href="#SiTiCalculator-276"><span class="linenos">276</span></a>
</span><span id="SiTiCalculator-277"><a href="#SiTiCalculator-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-278"><a href="#SiTiCalculator-278"><span class="linenos">278</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator-279"><a href="#SiTiCalculator-279"><span class="linenos">279</span></a>
</span><span id="SiTiCalculator-280"><a href="#SiTiCalculator-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-281"><a href="#SiTiCalculator-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-282"><a href="#SiTiCalculator-282"><span class="linenos">282</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-283"><a href="#SiTiCalculator-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator-284"><a href="#SiTiCalculator-284"><span class="linenos">284</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-285"><a href="#SiTiCalculator-285"><span class="linenos">285</span></a>
</span><span id="SiTiCalculator-286"><a href="#SiTiCalculator-286"><span class="linenos">286</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SiTiCalculator-287"><a href="#SiTiCalculator-287"><span class="linenos">287</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SiTiCalculator-288"><a href="#SiTiCalculator-288"><span class="linenos">288</span></a>
</span><span id="SiTiCalculator-289"><a href="#SiTiCalculator-289"><span class="linenos">289</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator-290"><a href="#SiTiCalculator-290"><span class="linenos">290</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="SiTiCalculator-291"><a href="#SiTiCalculator-291"><span class="linenos">291</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator-292"><a href="#SiTiCalculator-292"><span class="linenos">292</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator-293"><a href="#SiTiCalculator-293"><span class="linenos">293</span></a>
</span><span id="SiTiCalculator-294"><a href="#SiTiCalculator-294"><span class="linenos">294</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator-295"><a href="#SiTiCalculator-295"><span class="linenos">295</span></a>
</span><span id="SiTiCalculator-296"><a href="#SiTiCalculator-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-297"><a href="#SiTiCalculator-297"><span class="linenos">297</span></a>
</span><span id="SiTiCalculator-298"><a href="#SiTiCalculator-298"><span class="linenos">298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-299"><a href="#SiTiCalculator-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_inv_srgb</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-300"><a href="#SiTiCalculator-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-301"><a href="#SiTiCalculator-301"><span class="linenos">301</span></a><span class="sd">        Inverse sRGB electro-optical transfer function</span>
</span><span id="SiTiCalculator-302"><a href="#SiTiCalculator-302"><span class="linenos">302</span></a>
</span><span id="SiTiCalculator-303"><a href="#SiTiCalculator-303"><span class="linenos">303</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-304"><a href="#SiTiCalculator-304"><span class="linenos">304</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="SiTiCalculator-305"><a href="#SiTiCalculator-305"><span class="linenos">305</span></a>
</span><span id="SiTiCalculator-306"><a href="#SiTiCalculator-306"><span class="linenos">306</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-307"><a href="#SiTiCalculator-307"><span class="linenos">307</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator-308"><a href="#SiTiCalculator-308"><span class="linenos">308</span></a>
</span><span id="SiTiCalculator-309"><a href="#SiTiCalculator-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-310"><a href="#SiTiCalculator-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-311"><a href="#SiTiCalculator-311"><span class="linenos">311</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-312"><a href="#SiTiCalculator-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator-313"><a href="#SiTiCalculator-313"><span class="linenos">313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-314"><a href="#SiTiCalculator-314"><span class="linenos">314</span></a>
</span><span id="SiTiCalculator-315"><a href="#SiTiCalculator-315"><span class="linenos">315</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SiTiCalculator-316"><a href="#SiTiCalculator-316"><span class="linenos">316</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SiTiCalculator-317"><a href="#SiTiCalculator-317"><span class="linenos">317</span></a>
</span><span id="SiTiCalculator-318"><a href="#SiTiCalculator-318"><span class="linenos">318</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="o">*</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="mf">12.92</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="SiTiCalculator-319"><a href="#SiTiCalculator-319"><span class="linenos">319</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
</span><span id="SiTiCalculator-320"><a href="#SiTiCalculator-320"><span class="linenos">320</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
</span><span id="SiTiCalculator-321"><a href="#SiTiCalculator-321"><span class="linenos">321</span></a>
</span><span id="SiTiCalculator-322"><a href="#SiTiCalculator-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-323"><a href="#SiTiCalculator-323"><span class="linenos">323</span></a>
</span><span id="SiTiCalculator-324"><a href="#SiTiCalculator-324"><span class="linenos">324</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-325"><a href="#SiTiCalculator-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_display_model</span><span class="p">(</span>
</span><span id="SiTiCalculator-326"><a href="#SiTiCalculator-326"><span class="linenos">326</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator-327"><a href="#SiTiCalculator-327"><span class="linenos">327</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">,</span>
</span><span id="SiTiCalculator-328"><a href="#SiTiCalculator-328"><span class="linenos">328</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX</span><span class="p">,</span>
</span><span id="SiTiCalculator-329"><a href="#SiTiCalculator-329"><span class="linenos">329</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN</span><span class="p">,</span>
</span><span id="SiTiCalculator-330"><a href="#SiTiCalculator-330"><span class="linenos">330</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator-331"><a href="#SiTiCalculator-331"><span class="linenos">331</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-332"><a href="#SiTiCalculator-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-333"><a href="#SiTiCalculator-333"><span class="linenos">333</span></a><span class="sd">        Apply the SDR EOTF</span>
</span><span id="SiTiCalculator-334"><a href="#SiTiCalculator-334"><span class="linenos">334</span></a>
</span><span id="SiTiCalculator-335"><a href="#SiTiCalculator-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-336"><a href="#SiTiCalculator-336"><span class="linenos">336</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="SiTiCalculator-337"><a href="#SiTiCalculator-337"><span class="linenos">337</span></a><span class="sd">            Other arguments: see calculate()</span>
</span><span id="SiTiCalculator-338"><a href="#SiTiCalculator-338"><span class="linenos">338</span></a>
</span><span id="SiTiCalculator-339"><a href="#SiTiCalculator-339"><span class="linenos">339</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-340"><a href="#SiTiCalculator-340"><span class="linenos">340</span></a><span class="sd">            frame_data: pixel values in the physical domain.</span>
</span><span id="SiTiCalculator-341"><a href="#SiTiCalculator-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-342"><a href="#SiTiCalculator-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-343"><a href="#SiTiCalculator-343"><span class="linenos">343</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &lt; 0&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-344"><a href="#SiTiCalculator-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator-345"><a href="#SiTiCalculator-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &gt; 1&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-346"><a href="#SiTiCalculator-346"><span class="linenos">346</span></a>
</span><span id="SiTiCalculator-347"><a href="#SiTiCalculator-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">:</span>
</span><span id="SiTiCalculator-348"><a href="#SiTiCalculator-348"><span class="linenos">348</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_1886</span>
</span><span id="SiTiCalculator-349"><a href="#SiTiCalculator-349"><span class="linenos">349</span></a>            <span class="c1"># note that l_min/l_max are not passed here on purpose, as they are set to 0.0 and 1.0,</span>
</span><span id="SiTiCalculator-350"><a href="#SiTiCalculator-350"><span class="linenos">350</span></a>            <span class="c1"># and mapped outside of the eotf_1886 function</span>
</span><span id="SiTiCalculator-351"><a href="#SiTiCalculator-351"><span class="linenos">351</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
</span><span id="SiTiCalculator-352"><a href="#SiTiCalculator-352"><span class="linenos">352</span></a>        <span class="k">elif</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">INV_SRGB</span><span class="p">:</span>
</span><span id="SiTiCalculator-353"><a href="#SiTiCalculator-353"><span class="linenos">353</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_inv_srgb</span>
</span><span id="SiTiCalculator-354"><a href="#SiTiCalculator-354"><span class="linenos">354</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SiTiCalculator-355"><a href="#SiTiCalculator-355"><span class="linenos">355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-356"><a href="#SiTiCalculator-356"><span class="linenos">356</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown EOTF function!&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-357"><a href="#SiTiCalculator-357"><span class="linenos">357</span></a>
</span><span id="SiTiCalculator-358"><a href="#SiTiCalculator-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">fn</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span><span id="SiTiCalculator-359"><a href="#SiTiCalculator-359"><span class="linenos">359</span></a>
</span><span id="SiTiCalculator-360"><a href="#SiTiCalculator-360"><span class="linenos">360</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-361"><a href="#SiTiCalculator-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pq</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-362"><a href="#SiTiCalculator-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-363"><a href="#SiTiCalculator-363"><span class="linenos">363</span></a><span class="sd">        Perceptual quantizer opto-electrical transfer function defined in ITU-R Rec. BT.2100</span>
</span><span id="SiTiCalculator-364"><a href="#SiTiCalculator-364"><span class="linenos">364</span></a>
</span><span id="SiTiCalculator-365"><a href="#SiTiCalculator-365"><span class="linenos">365</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-366"><a href="#SiTiCalculator-366"><span class="linenos">366</span></a><span class="sd">            frame_data: pixel values expected to be in the physical luminance between 0 and 10,000 cd/m^2</span>
</span><span id="SiTiCalculator-367"><a href="#SiTiCalculator-367"><span class="linenos">367</span></a>
</span><span id="SiTiCalculator-368"><a href="#SiTiCalculator-368"><span class="linenos">368</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-369"><a href="#SiTiCalculator-369"><span class="linenos">369</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator-370"><a href="#SiTiCalculator-370"><span class="linenos">370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-371"><a href="#SiTiCalculator-371"><span class="linenos">371</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="mf">78.84375</span>
</span><span id="SiTiCalculator-372"><a href="#SiTiCalculator-372"><span class="linenos">372</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mf">0.1593017578125</span>
</span><span id="SiTiCalculator-373"><a href="#SiTiCalculator-373"><span class="linenos">373</span></a>        <span class="n">c1</span> <span class="o">=</span> <span class="mf">0.8359375</span>
</span><span id="SiTiCalculator-374"><a href="#SiTiCalculator-374"><span class="linenos">374</span></a>        <span class="n">c2</span> <span class="o">=</span> <span class="mf">18.8515625</span>
</span><span id="SiTiCalculator-375"><a href="#SiTiCalculator-375"><span class="linenos">375</span></a>        <span class="n">c3</span> <span class="o">=</span> <span class="mf">18.6875</span>
</span><span id="SiTiCalculator-376"><a href="#SiTiCalculator-376"><span class="linenos">376</span></a>        <span class="n">lm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="SiTiCalculator-377"><a href="#SiTiCalculator-377"><span class="linenos">377</span></a>        <span class="c1"># FIXME: this might return an error if input is negative, see https://stackoverflow.com/q/45384602/</span>
</span><span id="SiTiCalculator-378"><a href="#SiTiCalculator-378"><span class="linenos">378</span></a>        <span class="n">lm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="SiTiCalculator-379"><a href="#SiTiCalculator-379"><span class="linenos">379</span></a>
</span><span id="SiTiCalculator-380"><a href="#SiTiCalculator-380"><span class="linenos">380</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">c1</span> <span class="o">*</span> <span class="n">lm1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lm1</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span>
</span><span id="SiTiCalculator-381"><a href="#SiTiCalculator-381"><span class="linenos">381</span></a>
</span><span id="SiTiCalculator-382"><a href="#SiTiCalculator-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-383"><a href="#SiTiCalculator-383"><span class="linenos">383</span></a>
</span><span id="SiTiCalculator-384"><a href="#SiTiCalculator-384"><span class="linenos">384</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-385"><a href="#SiTiCalculator-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pu21</span><span class="p">(</span>
</span><span id="SiTiCalculator-386"><a href="#SiTiCalculator-386"><span class="linenos">386</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator-387"><a href="#SiTiCalculator-387"><span class="linenos">387</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">Pu21Mode</span><span class="o">.</span><span class="n">BANDING</span><span class="p">,</span>
</span><span id="SiTiCalculator-388"><a href="#SiTiCalculator-388"><span class="linenos">388</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-389"><a href="#SiTiCalculator-389"><span class="linenos">389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-390"><a href="#SiTiCalculator-390"><span class="linenos">390</span></a><span class="sd">        PU21 OETF, see https://github.com/gfxdisp/pu21</span>
</span><span id="SiTiCalculator-391"><a href="#SiTiCalculator-391"><span class="linenos">391</span></a>
</span><span id="SiTiCalculator-392"><a href="#SiTiCalculator-392"><span class="linenos">392</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-393"><a href="#SiTiCalculator-393"><span class="linenos">393</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="SiTiCalculator-394"><a href="#SiTiCalculator-394"><span class="linenos">394</span></a><span class="sd">            mode (Pu21Mode), defaults to Pu21Mode.BANDING</span>
</span><span id="SiTiCalculator-395"><a href="#SiTiCalculator-395"><span class="linenos">395</span></a>
</span><span id="SiTiCalculator-396"><a href="#SiTiCalculator-396"><span class="linenos">396</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-397"><a href="#SiTiCalculator-397"><span class="linenos">397</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator-398"><a href="#SiTiCalculator-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-399"><a href="#SiTiCalculator-399"><span class="linenos">399</span></a>
</span><span id="SiTiCalculator-400"><a href="#SiTiCalculator-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator-401"><a href="#SiTiCalculator-401"><span class="linenos">401</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator-402"><a href="#SiTiCalculator-402"><span class="linenos">402</span></a>                <span class="mf">1.070275272</span><span class="p">,</span>
</span><span id="SiTiCalculator-403"><a href="#SiTiCalculator-403"><span class="linenos">403</span></a>                <span class="mf">0.4088273932</span><span class="p">,</span>
</span><span id="SiTiCalculator-404"><a href="#SiTiCalculator-404"><span class="linenos">404</span></a>                <span class="mf">0.153224308</span><span class="p">,</span>
</span><span id="SiTiCalculator-405"><a href="#SiTiCalculator-405"><span class="linenos">405</span></a>                <span class="mf">0.2520326168</span><span class="p">,</span>
</span><span id="SiTiCalculator-406"><a href="#SiTiCalculator-406"><span class="linenos">406</span></a>                <span class="mf">1.063512885</span><span class="p">,</span>
</span><span id="SiTiCalculator-407"><a href="#SiTiCalculator-407"><span class="linenos">407</span></a>                <span class="mf">1.14115047</span><span class="p">,</span>
</span><span id="SiTiCalculator-408"><a href="#SiTiCalculator-408"><span class="linenos">408</span></a>                <span class="mf">521.4527484</span><span class="p">,</span>
</span><span id="SiTiCalculator-409"><a href="#SiTiCalculator-409"><span class="linenos">409</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator-410"><a href="#SiTiCalculator-410"><span class="linenos">410</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5580e-07</span>
</span><span id="SiTiCalculator-411"><a href="#SiTiCalculator-411"><span class="linenos">411</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">520.4673</span>
</span><span id="SiTiCalculator-412"><a href="#SiTiCalculator-412"><span class="linenos">412</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding_glare&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator-413"><a href="#SiTiCalculator-413"><span class="linenos">413</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator-414"><a href="#SiTiCalculator-414"><span class="linenos">414</span></a>                <span class="mf">0.353487901</span><span class="p">,</span>
</span><span id="SiTiCalculator-415"><a href="#SiTiCalculator-415"><span class="linenos">415</span></a>                <span class="mf">0.3734658629</span><span class="p">,</span>
</span><span id="SiTiCalculator-416"><a href="#SiTiCalculator-416"><span class="linenos">416</span></a>                <span class="mf">8.277049286e-05</span><span class="p">,</span>
</span><span id="SiTiCalculator-417"><a href="#SiTiCalculator-417"><span class="linenos">417</span></a>                <span class="mf">0.9062562627</span><span class="p">,</span>
</span><span id="SiTiCalculator-418"><a href="#SiTiCalculator-418"><span class="linenos">418</span></a>                <span class="mf">0.09150303166</span><span class="p">,</span>
</span><span id="SiTiCalculator-419"><a href="#SiTiCalculator-419"><span class="linenos">419</span></a>                <span class="mf">0.9099517204</span><span class="p">,</span>
</span><span id="SiTiCalculator-420"><a href="#SiTiCalculator-420"><span class="linenos">420</span></a>                <span class="mf">596.3148142</span><span class="p">,</span>
</span><span id="SiTiCalculator-421"><a href="#SiTiCalculator-421"><span class="linenos">421</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator-422"><a href="#SiTiCalculator-422"><span class="linenos">422</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">5.4705e-10</span>
</span><span id="SiTiCalculator-423"><a href="#SiTiCalculator-423"><span class="linenos">423</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">595.3939</span>
</span><span id="SiTiCalculator-424"><a href="#SiTiCalculator-424"><span class="linenos">424</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator-425"><a href="#SiTiCalculator-425"><span class="linenos">425</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator-426"><a href="#SiTiCalculator-426"><span class="linenos">426</span></a>                <span class="mf">1.043882782</span><span class="p">,</span>
</span><span id="SiTiCalculator-427"><a href="#SiTiCalculator-427"><span class="linenos">427</span></a>                <span class="mf">0.6459495343</span><span class="p">,</span>
</span><span id="SiTiCalculator-428"><a href="#SiTiCalculator-428"><span class="linenos">428</span></a>                <span class="mf">0.3194584211</span><span class="p">,</span>
</span><span id="SiTiCalculator-429"><a href="#SiTiCalculator-429"><span class="linenos">429</span></a>                <span class="mf">0.374025247</span><span class="p">,</span>
</span><span id="SiTiCalculator-430"><a href="#SiTiCalculator-430"><span class="linenos">430</span></a>                <span class="mf">1.114783422</span><span class="p">,</span>
</span><span id="SiTiCalculator-431"><a href="#SiTiCalculator-431"><span class="linenos">431</span></a>                <span class="mf">1.095360363</span><span class="p">,</span>
</span><span id="SiTiCalculator-432"><a href="#SiTiCalculator-432"><span class="linenos">432</span></a>                <span class="mf">384.9217577</span><span class="p">,</span>
</span><span id="SiTiCalculator-433"><a href="#SiTiCalculator-433"><span class="linenos">433</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator-434"><a href="#SiTiCalculator-434"><span class="linenos">434</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">1.3674e-07</span>
</span><span id="SiTiCalculator-435"><a href="#SiTiCalculator-435"><span class="linenos">435</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">380.9853</span>
</span><span id="SiTiCalculator-436"><a href="#SiTiCalculator-436"><span class="linenos">436</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks_glare&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator-437"><a href="#SiTiCalculator-437"><span class="linenos">437</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator-438"><a href="#SiTiCalculator-438"><span class="linenos">438</span></a>                <span class="mf">816.885024</span><span class="p">,</span>
</span><span id="SiTiCalculator-439"><a href="#SiTiCalculator-439"><span class="linenos">439</span></a>                <span class="mf">1479.463946</span><span class="p">,</span>
</span><span id="SiTiCalculator-440"><a href="#SiTiCalculator-440"><span class="linenos">440</span></a>                <span class="mf">0.001253215609</span><span class="p">,</span>
</span><span id="SiTiCalculator-441"><a href="#SiTiCalculator-441"><span class="linenos">441</span></a>                <span class="mf">0.9329636822</span><span class="p">,</span>
</span><span id="SiTiCalculator-442"><a href="#SiTiCalculator-442"><span class="linenos">442</span></a>                <span class="mf">0.06746643971</span><span class="p">,</span>
</span><span id="SiTiCalculator-443"><a href="#SiTiCalculator-443"><span class="linenos">443</span></a>                <span class="mf">1.573435413</span><span class="p">,</span>
</span><span id="SiTiCalculator-444"><a href="#SiTiCalculator-444"><span class="linenos">444</span></a>                <span class="mf">419.6006374</span><span class="p">,</span>
</span><span id="SiTiCalculator-445"><a href="#SiTiCalculator-445"><span class="linenos">445</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator-446"><a href="#SiTiCalculator-446"><span class="linenos">446</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.7360e-08</span>
</span><span id="SiTiCalculator-447"><a href="#SiTiCalculator-447"><span class="linenos">447</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">407.5066</span>
</span><span id="SiTiCalculator-448"><a href="#SiTiCalculator-448"><span class="linenos">448</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-449"><a href="#SiTiCalculator-449"><span class="linenos">449</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode specified for PU21&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-450"><a href="#SiTiCalculator-450"><span class="linenos">450</span></a>
</span><span id="SiTiCalculator-451"><a href="#SiTiCalculator-451"><span class="linenos">451</span></a>        <span class="c1"># scale frame_data to the range 0.005 - 10,000</span>
</span><span id="SiTiCalculator-452"><a href="#SiTiCalculator-452"><span class="linenos">452</span></a>        <span class="c1"># disabled since the input is already in physical luminance</span>
</span><span id="SiTiCalculator-453"><a href="#SiTiCalculator-453"><span class="linenos">453</span></a>        <span class="c1"># frame_data = frame_data * 10000.0</span>
</span><span id="SiTiCalculator-454"><a href="#SiTiCalculator-454"><span class="linenos">454</span></a>        <span class="c1"># frame_data = np.maximum(frame_data, 0.05)</span>
</span><span id="SiTiCalculator-455"><a href="#SiTiCalculator-455"><span class="linenos">455</span></a>
</span><span id="SiTiCalculator-456"><a href="#SiTiCalculator-456"><span class="linenos">456</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SiTiCalculator-457"><a href="#SiTiCalculator-457"><span class="linenos">457</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
</span><span id="SiTiCalculator-458"><a href="#SiTiCalculator-458"><span class="linenos">458</span></a>                <span class="p">(</span>
</span><span id="SiTiCalculator-459"><a href="#SiTiCalculator-459"><span class="linenos">459</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SiTiCalculator-460"><a href="#SiTiCalculator-460"><span class="linenos">460</span></a>                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SiTiCalculator-461"><a href="#SiTiCalculator-461"><span class="linenos">461</span></a>                <span class="p">),</span>
</span><span id="SiTiCalculator-462"><a href="#SiTiCalculator-462"><span class="linenos">462</span></a>                <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span id="SiTiCalculator-463"><a href="#SiTiCalculator-463"><span class="linenos">463</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator-464"><a href="#SiTiCalculator-464"><span class="linenos">464</span></a>            <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="SiTiCalculator-465"><a href="#SiTiCalculator-465"><span class="linenos">465</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator-466"><a href="#SiTiCalculator-466"><span class="linenos">466</span></a>
</span><span id="SiTiCalculator-467"><a href="#SiTiCalculator-467"><span class="linenos">467</span></a>        <span class="c1"># get the output into the range [0, 1]</span>
</span><span id="SiTiCalculator-468"><a href="#SiTiCalculator-468"><span class="linenos">468</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_max</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span>
</span><span id="SiTiCalculator-469"><a href="#SiTiCalculator-469"><span class="linenos">469</span></a>
</span><span id="SiTiCalculator-470"><a href="#SiTiCalculator-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-471"><a href="#SiTiCalculator-471"><span class="linenos">471</span></a>
</span><span id="SiTiCalculator-472"><a href="#SiTiCalculator-472"><span class="linenos">472</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-473"><a href="#SiTiCalculator-473"><span class="linenos">473</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_hlg</span><span class="p">(</span>
</span><span id="SiTiCalculator-474"><a href="#SiTiCalculator-474"><span class="linenos">474</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator-475"><a href="#SiTiCalculator-475"><span class="linenos">475</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN_HDR</span><span class="p">,</span>
</span><span id="SiTiCalculator-476"><a href="#SiTiCalculator-476"><span class="linenos">476</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX_HDR</span><span class="p">,</span>
</span><span id="SiTiCalculator-477"><a href="#SiTiCalculator-477"><span class="linenos">477</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator-478"><a href="#SiTiCalculator-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-479"><a href="#SiTiCalculator-479"><span class="linenos">479</span></a><span class="sd">        Hybrid log-gamma opto-electrical transfer function defined in ITU-T Rec. BT.2100</span>
</span><span id="SiTiCalculator-480"><a href="#SiTiCalculator-480"><span class="linenos">480</span></a>
</span><span id="SiTiCalculator-481"><a href="#SiTiCalculator-481"><span class="linenos">481</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-482"><a href="#SiTiCalculator-482"><span class="linenos">482</span></a><span class="sd">            frame_data: pixel values expected to be in the range [0, 1]</span>
</span><span id="SiTiCalculator-483"><a href="#SiTiCalculator-483"><span class="linenos">483</span></a>
</span><span id="SiTiCalculator-484"><a href="#SiTiCalculator-484"><span class="linenos">484</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-485"><a href="#SiTiCalculator-485"><span class="linenos">485</span></a><span class="sd">            frame_data: pixel values in the physical luminance up to 10,000 cd/m^2</span>
</span><span id="SiTiCalculator-486"><a href="#SiTiCalculator-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-487"><a href="#SiTiCalculator-487"><span class="linenos">487</span></a>
</span><span id="SiTiCalculator-488"><a href="#SiTiCalculator-488"><span class="linenos">488</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.17883277</span>
</span><span id="SiTiCalculator-489"><a href="#SiTiCalculator-489"><span class="linenos">489</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.02372241</span>
</span><span id="SiTiCalculator-490"><a href="#SiTiCalculator-490"><span class="linenos">490</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="mf">1.00429347</span>
</span><span id="SiTiCalculator-491"><a href="#SiTiCalculator-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="o">&lt;=</span> <span class="mf">1000.0</span><span class="p">:</span>
</span><span id="SiTiCalculator-492"><a href="#SiTiCalculator-492"><span class="linenos">492</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span>
</span><span id="SiTiCalculator-493"><a href="#SiTiCalculator-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-494"><a href="#SiTiCalculator-494"><span class="linenos">494</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">+</span> <span class="mf">0.42</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">l_max</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</span><span id="SiTiCalculator-495"><a href="#SiTiCalculator-495"><span class="linenos">495</span></a>
</span><span id="SiTiCalculator-496"><a href="#SiTiCalculator-496"><span class="linenos">496</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="SiTiCalculator-497"><a href="#SiTiCalculator-497"><span class="linenos">497</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
</span><span id="SiTiCalculator-498"><a href="#SiTiCalculator-498"><span class="linenos">498</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="SiTiCalculator-499"><a href="#SiTiCalculator-499"><span class="linenos">499</span></a>
</span><span id="SiTiCalculator-500"><a href="#SiTiCalculator-500"><span class="linenos">500</span></a>        <span class="c1"># NOTE: The following is only valid when the function is applied to the Y channel.</span>
</span><span id="SiTiCalculator-501"><a href="#SiTiCalculator-501"><span class="linenos">501</span></a>        <span class="c1"># If frame_data was a color channel (R, G, or B), the correct implementation would be:</span>
</span><span id="SiTiCalculator-502"><a href="#SiTiCalculator-502"><span class="linenos">502</span></a>        <span class="c1"># (l_max - l_min) * np.power(Y, gamma - 1.0) * frame_data + l_min,</span>
</span><span id="SiTiCalculator-503"><a href="#SiTiCalculator-503"><span class="linenos">503</span></a>        <span class="c1"># where Y would be obtained from linearized R, G, B channels.</span>
</span><span id="SiTiCalculator-504"><a href="#SiTiCalculator-504"><span class="linenos">504</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span><span id="SiTiCalculator-505"><a href="#SiTiCalculator-505"><span class="linenos">505</span></a>
</span><span id="SiTiCalculator-506"><a href="#SiTiCalculator-506"><span class="linenos">506</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-507"><a href="#SiTiCalculator-507"><span class="linenos">507</span></a>
</span><span id="SiTiCalculator-508"><a href="#SiTiCalculator-508"><span class="linenos">508</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator-509"><a href="#SiTiCalculator-509"><span class="linenos">509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-510"><a href="#SiTiCalculator-510"><span class="linenos">510</span></a><span class="sd">        Normalize frame data in the range [0, 1] to their original range, based on</span>
</span><span id="SiTiCalculator-511"><a href="#SiTiCalculator-511"><span class="linenos">511</span></a><span class="sd">        bit depth, e.g. from [0, 1] to [0, 255].</span>
</span><span id="SiTiCalculator-512"><a href="#SiTiCalculator-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-513"><a href="#SiTiCalculator-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SiTiCalculator-514"><a href="#SiTiCalculator-514"><span class="linenos">514</span></a>
</span><span id="SiTiCalculator-515"><a href="#SiTiCalculator-515"><span class="linenos">515</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_si_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator-516"><a href="#SiTiCalculator-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-517"><a href="#SiTiCalculator-517"><span class="linenos">517</span></a><span class="sd">        Normalize frame data in the range [0, 1] to [0, 255], which was the original</span>
</span><span id="SiTiCalculator-518"><a href="#SiTiCalculator-518"><span class="linenos">518</span></a><span class="sd">        range for SI/TI.</span>
</span><span id="SiTiCalculator-519"><a href="#SiTiCalculator-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-520"><a href="#SiTiCalculator-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SiTiCalculator-521"><a href="#SiTiCalculator-521"><span class="linenos">521</span></a>
</span><span id="SiTiCalculator-522"><a href="#SiTiCalculator-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_between_0_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator-523"><a href="#SiTiCalculator-523"><span class="linenos">523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-524"><a href="#SiTiCalculator-524"><span class="linenos">524</span></a><span class="sd">        Normalize frame data in the range [0, x] to [0, 1], based on bit depth and color range.</span>
</span><span id="SiTiCalculator-525"><a href="#SiTiCalculator-525"><span class="linenos">525</span></a><span class="sd">        For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="SiTiCalculator-526"><a href="#SiTiCalculator-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-527"><a href="#SiTiCalculator-527"><span class="linenos">527</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">==</span> <span class="n">ColorRange</span><span class="o">.</span><span class="n">LIMITED</span><span class="p">:</span>
</span><span id="SiTiCalculator-528"><a href="#SiTiCalculator-528"><span class="linenos">528</span></a>            <span class="c1"># Get the limited range values for the current bit depth</span>
</span><span id="SiTiCalculator-529"><a href="#SiTiCalculator-529"><span class="linenos">529</span></a>            <span class="n">limited_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
</span><span id="SiTiCalculator-530"><a href="#SiTiCalculator-530"><span class="linenos">530</span></a>            <span class="n">limited_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span>
</span><span id="SiTiCalculator-531"><a href="#SiTiCalculator-531"><span class="linenos">531</span></a>
</span><span id="SiTiCalculator-532"><a href="#SiTiCalculator-532"><span class="linenos">532</span></a>            <span class="c1"># Check if input is within expected limited range</span>
</span><span id="SiTiCalculator-533"><a href="#SiTiCalculator-533"><span class="linenos">533</span></a>            <span class="n">input_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-534"><a href="#SiTiCalculator-534"><span class="linenos">534</span></a>            <span class="n">input_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-535"><a href="#SiTiCalculator-535"><span class="linenos">535</span></a>
</span><span id="SiTiCalculator-536"><a href="#SiTiCalculator-536"><span class="linenos">536</span></a>            <span class="c1"># Provide a warning if values are outside limited range</span>
</span><span id="SiTiCalculator-537"><a href="#SiTiCalculator-537"><span class="linenos">537</span></a>            <span class="k">if</span> <span class="n">input_min</span> <span class="o">&lt;</span> <span class="n">limited_min</span> <span class="ow">or</span> <span class="n">input_max</span> <span class="o">&gt;</span> <span class="n">limited_max</span><span class="p">:</span>
</span><span id="SiTiCalculator-538"><a href="#SiTiCalculator-538"><span class="linenos">538</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="SiTiCalculator-539"><a href="#SiTiCalculator-539"><span class="linenos">539</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input appears to be full range, but it is treated as limited range! &quot;</span>
</span><span id="SiTiCalculator-540"><a href="#SiTiCalculator-540"><span class="linenos">540</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input range is [</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_min</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_max</span><span class="p">)</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="SiTiCalculator-541"><a href="#SiTiCalculator-541"><span class="linenos">541</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected range for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="si">}</span><span class="s2">-bit limited content [</span><span class="si">{</span><span class="n">limited_min</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">limited_max</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="SiTiCalculator-542"><a href="#SiTiCalculator-542"><span class="linenos">542</span></a>                    <span class="s2">&quot;Specify the range as full instead.&quot;</span>
</span><span id="SiTiCalculator-543"><a href="#SiTiCalculator-543"><span class="linenos">543</span></a>                <span class="p">)</span>
</span><span id="SiTiCalculator-544"><a href="#SiTiCalculator-544"><span class="linenos">544</span></a>
</span><span id="SiTiCalculator-545"><a href="#SiTiCalculator-545"><span class="linenos">545</span></a>            <span class="c1"># Normalize from limited range directly to [0, 1]</span>
</span><span id="SiTiCalculator-546"><a href="#SiTiCalculator-546"><span class="linenos">546</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">limited_max</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span>
</span><span id="SiTiCalculator-547"><a href="#SiTiCalculator-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-548"><a href="#SiTiCalculator-548"><span class="linenos">548</span></a>            <span class="c1"># Full range: normalize from [0, 2^bit_depth - 1] to [0, 1]</span>
</span><span id="SiTiCalculator-549"><a href="#SiTiCalculator-549"><span class="linenos">549</span></a>            <span class="k">return</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SiTiCalculator-550"><a href="#SiTiCalculator-550"><span class="linenos">550</span></a>
</span><span id="SiTiCalculator-551"><a href="#SiTiCalculator-551"><span class="linenos">551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_frame_callback</span><span class="p">(</span>
</span><span id="SiTiCalculator-552"><a href="#SiTiCalculator-552"><span class="linenos">552</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">callback_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="SiTiCalculator-553"><a href="#SiTiCalculator-553"><span class="linenos">553</span></a>    <span class="p">):</span>
</span><span id="SiTiCalculator-554"><a href="#SiTiCalculator-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a function that gets called whenever a frame&#39;s values are available</span>
</span><span id="SiTiCalculator-555"><a href="#SiTiCalculator-555"><span class="linenos">555</span></a>
</span><span id="SiTiCalculator-556"><a href="#SiTiCalculator-556"><span class="linenos">556</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-557"><a href="#SiTiCalculator-557"><span class="linenos">557</span></a><span class="sd">            callback_fn (Callable[[float, Union[float, None], int], None]): The function that should get called. It will receive SI, TI and the frame number.</span>
</span><span id="SiTiCalculator-558"><a href="#SiTiCalculator-558"><span class="linenos">558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-559"><a href="#SiTiCalculator-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback_fn</span><span class="p">)</span>
</span><span id="SiTiCalculator-560"><a href="#SiTiCalculator-560"><span class="linenos">560</span></a>
</span><span id="SiTiCalculator-561"><a href="#SiTiCalculator-561"><span class="linenos">561</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator-562"><a href="#SiTiCalculator-562"><span class="linenos">562</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SiTiCalculator-563"><a href="#SiTiCalculator-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="n">plotille</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="SiTiCalculator-564"><a href="#SiTiCalculator-564"><span class="linenos">564</span></a>            <span class="n">frame_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="mi">0</span>
</span><span id="SiTiCalculator-565"><a href="#SiTiCalculator-565"><span class="linenos">565</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator-566"><a href="#SiTiCalculator-566"><span class="linenos">566</span></a>
</span><span id="SiTiCalculator-567"><a href="#SiTiCalculator-567"><span class="linenos">567</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="SiTiCalculator-568"><a href="#SiTiCalculator-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SiTiCalculator-569"><a href="#SiTiCalculator-569"><span class="linenos">569</span></a>        <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SiTiCalculator-570"><a href="#SiTiCalculator-570"><span class="linenos">570</span></a>        <span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SiTiCalculator-571"><a href="#SiTiCalculator-571"><span class="linenos">571</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="SiTiCalculator-572"><a href="#SiTiCalculator-572"><span class="linenos">572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI and TI from an input file.</span>
</span><span id="SiTiCalculator-573"><a href="#SiTiCalculator-573"><span class="linenos">573</span></a>
</span><span id="SiTiCalculator-574"><a href="#SiTiCalculator-574"><span class="linenos">574</span></a><span class="sd">        Returns two arrays and one integer, the first array being the SI values, the</span>
</span><span id="SiTiCalculator-575"><a href="#SiTiCalculator-575"><span class="linenos">575</span></a><span class="sd">        second array being the TI values. The first element of the TI value array will</span>
</span><span id="SiTiCalculator-576"><a href="#SiTiCalculator-576"><span class="linenos">576</span></a><span class="sd">        always be 0. The integer will be equal to the number of frames read.</span>
</span><span id="SiTiCalculator-577"><a href="#SiTiCalculator-577"><span class="linenos">577</span></a>
</span><span id="SiTiCalculator-578"><a href="#SiTiCalculator-578"><span class="linenos">578</span></a><span class="sd">        You can also get the results later via .get_results()</span>
</span><span id="SiTiCalculator-579"><a href="#SiTiCalculator-579"><span class="linenos">579</span></a>
</span><span id="SiTiCalculator-580"><a href="#SiTiCalculator-580"><span class="linenos">580</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator-581"><a href="#SiTiCalculator-581"><span class="linenos">581</span></a><span class="sd">            input_file (str): input file path</span>
</span><span id="SiTiCalculator-582"><a href="#SiTiCalculator-582"><span class="linenos">582</span></a><span class="sd">            num_frames (int): number of frames to calculate. Defaults to 0 (unlimited).</span>
</span><span id="SiTiCalculator-583"><a href="#SiTiCalculator-583"><span class="linenos">583</span></a>
</span><span id="SiTiCalculator-584"><a href="#SiTiCalculator-584"><span class="linenos">584</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-585"><a href="#SiTiCalculator-585"><span class="linenos">585</span></a><span class="sd">            [[float], [float|None], int]: [si_values], [ti_values], frame count</span>
</span><span id="SiTiCalculator-586"><a href="#SiTiCalculator-586"><span class="linenos">586</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-587"><a href="#SiTiCalculator-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator-588"><a href="#SiTiCalculator-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator-589"><a href="#SiTiCalculator-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="o">=</span> <span class="n">input_file</span>
</span><span id="SiTiCalculator-590"><a href="#SiTiCalculator-590"><span class="linenos">590</span></a>        <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-591"><a href="#SiTiCalculator-591"><span class="linenos">591</span></a>
</span><span id="SiTiCalculator-592"><a href="#SiTiCalculator-592"><span class="linenos">592</span></a>        <span class="n">current_frame</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SiTiCalculator-593"><a href="#SiTiCalculator-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">frame_data</span> <span class="ow">in</span> <span class="n">read_container</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
</span><span id="SiTiCalculator-594"><a href="#SiTiCalculator-594"><span class="linenos">594</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">current_frame</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-595"><a href="#SiTiCalculator-595"><span class="linenos">595</span></a>
</span><span id="SiTiCalculator-596"><a href="#SiTiCalculator-596"><span class="linenos">596</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-597"><a href="#SiTiCalculator-597"><span class="linenos">597</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Original frame data&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-598"><a href="#SiTiCalculator-598"><span class="linenos">598</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-599"><a href="#SiTiCalculator-599"><span class="linenos">599</span></a>
</span><span id="SiTiCalculator-600"><a href="#SiTiCalculator-600"><span class="linenos">600</span></a>            <span class="c1"># Normalize frame data according to bit depth between 0 and 1.</span>
</span><span id="SiTiCalculator-601"><a href="#SiTiCalculator-601"><span class="linenos">601</span></a>            <span class="c1"># This will transform [0, 255] to [0, 1], and [0, 1023] to [0, 1] etc.</span>
</span><span id="SiTiCalculator-602"><a href="#SiTiCalculator-602"><span class="linenos">602</span></a>            <span class="c1"># For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="SiTiCalculator-603"><a href="#SiTiCalculator-603"><span class="linenos">603</span></a>            <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_between_0_1</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-604"><a href="#SiTiCalculator-604"><span class="linenos">604</span></a>
</span><span id="SiTiCalculator-605"><a href="#SiTiCalculator-605"><span class="linenos">605</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-606"><a href="#SiTiCalculator-606"><span class="linenos">606</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Frame data after normalization between 0 and 1&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-607"><a href="#SiTiCalculator-607"><span class="linenos">607</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-608"><a href="#SiTiCalculator-608"><span class="linenos">608</span></a>
</span><span id="SiTiCalculator-609"><a href="#SiTiCalculator-609"><span class="linenos">609</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">:</span>
</span><span id="SiTiCalculator-610"><a href="#SiTiCalculator-610"><span class="linenos">610</span></a>                <span class="c1"># in legacy mode we&#39;ll compute the values directly in the SDR domain</span>
</span><span id="SiTiCalculator-611"><a href="#SiTiCalculator-611"><span class="linenos">611</span></a>                <span class="k">pass</span>
</span><span id="SiTiCalculator-612"><a href="#SiTiCalculator-612"><span class="linenos">612</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-613"><a href="#SiTiCalculator-613"><span class="linenos">613</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span><span class="p">:</span>
</span><span id="SiTiCalculator-614"><a href="#SiTiCalculator-614"><span class="linenos">614</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">apply_display_model</span><span class="p">(</span>
</span><span id="SiTiCalculator-615"><a href="#SiTiCalculator-615"><span class="linenos">615</span></a>                        <span class="n">frame_data</span><span class="p">,</span>
</span><span id="SiTiCalculator-616"><a href="#SiTiCalculator-616"><span class="linenos">616</span></a>                        <span class="n">eotf_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">,</span>
</span><span id="SiTiCalculator-617"><a href="#SiTiCalculator-617"><span class="linenos">617</span></a>                        <span class="n">l_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="SiTiCalculator-618"><a href="#SiTiCalculator-618"><span class="linenos">618</span></a>                        <span class="n">l_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="SiTiCalculator-619"><a href="#SiTiCalculator-619"><span class="linenos">619</span></a>                        <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="SiTiCalculator-620"><a href="#SiTiCalculator-620"><span class="linenos">620</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator-621"><a href="#SiTiCalculator-621"><span class="linenos">621</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-622"><a href="#SiTiCalculator-622"><span class="linenos">622</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator-623"><a href="#SiTiCalculator-623"><span class="linenos">623</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after apply_display_model for SDR (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="SiTiCalculator-624"><a href="#SiTiCalculator-624"><span class="linenos">624</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator-625"><a href="#SiTiCalculator-625"><span class="linenos">625</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-626"><a href="#SiTiCalculator-626"><span class="linenos">626</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="SiTiCalculator-627"><a href="#SiTiCalculator-627"><span class="linenos">627</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="SiTiCalculator-628"><a href="#SiTiCalculator-628"><span class="linenos">628</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator-629"><a href="#SiTiCalculator-629"><span class="linenos">629</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-630"><a href="#SiTiCalculator-630"><span class="linenos">630</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator-631"><a href="#SiTiCalculator-631"><span class="linenos">631</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator-632"><a href="#SiTiCalculator-632"><span class="linenos">632</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator-633"><a href="#SiTiCalculator-633"><span class="linenos">633</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-634"><a href="#SiTiCalculator-634"><span class="linenos">634</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HDR10</span><span class="p">:</span>
</span><span id="SiTiCalculator-635"><a href="#SiTiCalculator-635"><span class="linenos">635</span></a>                    <span class="c1"># nothing to do, we are already in PQ domain</span>
</span><span id="SiTiCalculator-636"><a href="#SiTiCalculator-636"><span class="linenos">636</span></a>                    <span class="c1"># TODO allow using Pu21 here?</span>
</span><span id="SiTiCalculator-637"><a href="#SiTiCalculator-637"><span class="linenos">637</span></a>                    <span class="k">pass</span>
</span><span id="SiTiCalculator-638"><a href="#SiTiCalculator-638"><span class="linenos">638</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HLG</span><span class="p">:</span>
</span><span id="SiTiCalculator-639"><a href="#SiTiCalculator-639"><span class="linenos">639</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_hlg</span><span class="p">(</span>
</span><span id="SiTiCalculator-640"><a href="#SiTiCalculator-640"><span class="linenos">640</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span>
</span><span id="SiTiCalculator-641"><a href="#SiTiCalculator-641"><span class="linenos">641</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator-642"><a href="#SiTiCalculator-642"><span class="linenos">642</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-643"><a href="#SiTiCalculator-643"><span class="linenos">643</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator-644"><a href="#SiTiCalculator-644"><span class="linenos">644</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after eotf_hlg for HLG with l_min/l_max settings </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator-645"><a href="#SiTiCalculator-645"><span class="linenos">645</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator-646"><a href="#SiTiCalculator-646"><span class="linenos">646</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-647"><a href="#SiTiCalculator-647"><span class="linenos">647</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="SiTiCalculator-648"><a href="#SiTiCalculator-648"><span class="linenos">648</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="SiTiCalculator-649"><a href="#SiTiCalculator-649"><span class="linenos">649</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator-650"><a href="#SiTiCalculator-650"><span class="linenos">650</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-651"><a href="#SiTiCalculator-651"><span class="linenos">651</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator-652"><a href="#SiTiCalculator-652"><span class="linenos">652</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator-653"><a href="#SiTiCalculator-653"><span class="linenos">653</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator-654"><a href="#SiTiCalculator-654"><span class="linenos">654</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-655"><a href="#SiTiCalculator-655"><span class="linenos">655</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-656"><a href="#SiTiCalculator-656"><span class="linenos">656</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid HDR mode &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-657"><a href="#SiTiCalculator-657"><span class="linenos">657</span></a>
</span><span id="SiTiCalculator-658"><a href="#SiTiCalculator-658"><span class="linenos">658</span></a>            <span class="n">si_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="SiTiCalculator-659"><a href="#SiTiCalculator-659"><span class="linenos">659</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator-660"><a href="#SiTiCalculator-660"><span class="linenos">660</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator-661"><a href="#SiTiCalculator-661"><span class="linenos">661</span></a>
</span><span id="SiTiCalculator-662"><a href="#SiTiCalculator-662"><span class="linenos">662</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator-663"><a href="#SiTiCalculator-663"><span class="linenos">663</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="SiTiCalculator-664"><a href="#SiTiCalculator-664"><span class="linenos">664</span></a>                    <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">ti</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">))</span>
</span><span id="SiTiCalculator-665"><a href="#SiTiCalculator-665"><span class="linenos">665</span></a>                <span class="p">)</span>
</span><span id="SiTiCalculator-666"><a href="#SiTiCalculator-666"><span class="linenos">666</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator-667"><a href="#SiTiCalculator-667"><span class="linenos">667</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-668"><a href="#SiTiCalculator-668"><span class="linenos">668</span></a>
</span><span id="SiTiCalculator-669"><a href="#SiTiCalculator-669"><span class="linenos">669</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-670"><a href="#SiTiCalculator-670"><span class="linenos">670</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator-671"><a href="#SiTiCalculator-671"><span class="linenos">671</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator-672"><a href="#SiTiCalculator-672"><span class="linenos">672</span></a>
</span><span id="SiTiCalculator-673"><a href="#SiTiCalculator-673"><span class="linenos">673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">si_value</span><span class="p">))</span>
</span><span id="SiTiCalculator-674"><a href="#SiTiCalculator-674"><span class="linenos">674</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator-675"><a href="#SiTiCalculator-675"><span class="linenos">675</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">))</span>
</span><span id="SiTiCalculator-676"><a href="#SiTiCalculator-676"><span class="linenos">676</span></a>
</span><span id="SiTiCalculator-677"><a href="#SiTiCalculator-677"><span class="linenos">677</span></a>            <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator-678"><a href="#SiTiCalculator-678"><span class="linenos">678</span></a>
</span><span id="SiTiCalculator-679"><a href="#SiTiCalculator-679"><span class="linenos">679</span></a>            <span class="n">current_frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SiTiCalculator-680"><a href="#SiTiCalculator-680"><span class="linenos">680</span></a>
</span><span id="SiTiCalculator-681"><a href="#SiTiCalculator-681"><span class="linenos">681</span></a>            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
</span><span id="SiTiCalculator-682"><a href="#SiTiCalculator-682"><span class="linenos">682</span></a>                <span class="n">callback</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">,</span> <span class="n">current_frame</span><span class="p">)</span>
</span><span id="SiTiCalculator-683"><a href="#SiTiCalculator-683"><span class="linenos">683</span></a>
</span><span id="SiTiCalculator-684"><a href="#SiTiCalculator-684"><span class="linenos">684</span></a>            <span class="k">if</span> <span class="n">num_frames</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">current_frame</span> <span class="o">&gt;=</span> <span class="n">num_frames</span><span class="p">:</span>
</span><span id="SiTiCalculator-685"><a href="#SiTiCalculator-685"><span class="linenos">685</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span><span id="SiTiCalculator-686"><a href="#SiTiCalculator-686"><span class="linenos">686</span></a>
</span><span id="SiTiCalculator-687"><a href="#SiTiCalculator-687"><span class="linenos">687</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span><span id="SiTiCalculator-688"><a href="#SiTiCalculator-688"><span class="linenos">688</span></a>
</span><span id="SiTiCalculator-689"><a href="#SiTiCalculator-689"><span class="linenos">689</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_csv_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SiTiCalculator-690"><a href="#SiTiCalculator-690"><span class="linenos">690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-691"><a href="#SiTiCalculator-691"><span class="linenos">691</span></a><span class="sd">        Return a CSV string with the results.</span>
</span><span id="SiTiCalculator-692"><a href="#SiTiCalculator-692"><span class="linenos">692</span></a>
</span><span id="SiTiCalculator-693"><a href="#SiTiCalculator-693"><span class="linenos">693</span></a><span class="sd">        Note that this does not output all data. Also, the first TI value will be output as &quot;None&quot;.</span>
</span><span id="SiTiCalculator-694"><a href="#SiTiCalculator-694"><span class="linenos">694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-695"><a href="#SiTiCalculator-695"><span class="linenos">695</span></a>        <span class="c1"># prepend a zero here</span>
</span><span id="SiTiCalculator-696"><a href="#SiTiCalculator-696"><span class="linenos">696</span></a>        <span class="n">ti_values_to_output</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">]</span>
</span><span id="SiTiCalculator-697"><a href="#SiTiCalculator-697"><span class="linenos">697</span></a>
</span><span id="SiTiCalculator-698"><a href="#SiTiCalculator-698"><span class="linenos">698</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</span><span id="SiTiCalculator-699"><a href="#SiTiCalculator-699"><span class="linenos">699</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;ti&quot;</span><span class="p">])</span>
</span><span id="SiTiCalculator-700"><a href="#SiTiCalculator-700"><span class="linenos">700</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="SiTiCalculator-701"><a href="#SiTiCalculator-701"><span class="linenos">701</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="SiTiCalculator-702"><a href="#SiTiCalculator-702"><span class="linenos">702</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="n">ti_values_to_output</span><span class="p">)</span>
</span><span id="SiTiCalculator-703"><a href="#SiTiCalculator-703"><span class="linenos">703</span></a>        <span class="p">):</span>
</span><span id="SiTiCalculator-704"><a href="#SiTiCalculator-704"><span class="linenos">704</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
</span><span id="SiTiCalculator-705"><a href="#SiTiCalculator-705"><span class="linenos">705</span></a>                <span class="p">{</span>
</span><span id="SiTiCalculator-706"><a href="#SiTiCalculator-706"><span class="linenos">706</span></a>                    <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="SiTiCalculator-707"><a href="#SiTiCalculator-707"><span class="linenos">707</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-708"><a href="#SiTiCalculator-708"><span class="linenos">708</span></a>                    <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="SiTiCalculator-709"><a href="#SiTiCalculator-709"><span class="linenos">709</span></a>                    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SiTiCalculator-710"><a href="#SiTiCalculator-710"><span class="linenos">710</span></a>                    <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="SiTiCalculator-711"><a href="#SiTiCalculator-711"><span class="linenos">711</span></a>                    <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator-712"><a href="#SiTiCalculator-712"><span class="linenos">712</span></a>                <span class="p">}</span>
</span><span id="SiTiCalculator-713"><a href="#SiTiCalculator-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator-714"><a href="#SiTiCalculator-714"><span class="linenos">714</span></a>        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="SiTiCalculator-715"><a href="#SiTiCalculator-715"><span class="linenos">715</span></a>
</span><span id="SiTiCalculator-716"><a href="#SiTiCalculator-716"><span class="linenos">716</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SiTiCalculator-717"><a href="#SiTiCalculator-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-718"><a href="#SiTiCalculator-718"><span class="linenos">718</span></a><span class="sd">        Get a JSON-serializable result dictionary with SI, TI values, as well as used settings.</span>
</span><span id="SiTiCalculator-719"><a href="#SiTiCalculator-719"><span class="linenos">719</span></a>
</span><span id="SiTiCalculator-720"><a href="#SiTiCalculator-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator-721"><a href="#SiTiCalculator-721"><span class="linenos">721</span></a><span class="sd">            dict: A dictionary containing &quot;si&quot;, &quot;ti&quot; arrays, &quot;settings&quot; as a dict, and the &quot;input_file&quot; name.</span>
</span><span id="SiTiCalculator-722"><a href="#SiTiCalculator-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator-723"><a href="#SiTiCalculator-723"><span class="linenos">723</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="SiTiCalculator-724"><a href="#SiTiCalculator-724"><span class="linenos">724</span></a>            <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span>
</span><span id="SiTiCalculator-725"><a href="#SiTiCalculator-725"><span class="linenos">725</span></a>            <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span>
</span><span id="SiTiCalculator-726"><a href="#SiTiCalculator-726"><span class="linenos">726</span></a>            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_general_settings</span><span class="p">(),</span>
</span><span id="SiTiCalculator-727"><a href="#SiTiCalculator-727"><span class="linenos">727</span></a>            <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="SiTiCalculator-728"><a href="#SiTiCalculator-728"><span class="linenos">728</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SiTiCalculator-729"><a href="#SiTiCalculator-729"><span class="linenos">729</span></a>            <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="SiTiCalculator-730"><a href="#SiTiCalculator-730"><span class="linenos">730</span></a>        <span class="p">}</span>
</span><span id="SiTiCalculator-731"><a href="#SiTiCalculator-731"><span class="linenos">731</span></a>
</span><span id="SiTiCalculator-732"><a href="#SiTiCalculator-732"><span class="linenos">732</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log_frame_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="SiTiCalculator-733"><a href="#SiTiCalculator-733"><span class="linenos">733</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator-734"><a href="#SiTiCalculator-734"><span class="linenos">734</span></a>            <span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">], mean </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">, median </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">frame_data</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator-735"><a href="#SiTiCalculator-735"><span class="linenos">735</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator-736"><a href="#SiTiCalculator-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_histogram</span><span class="p">:</span>
</span><span id="SiTiCalculator-737"><a href="#SiTiCalculator-737"><span class="linenos">737</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">frame_data</span><span class="p">))</span>
</span></pre></div>


    

                            <div id="SiTiCalculator.__init__" class="classattr">
                                        <input id="SiTiCalculator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SiTiCalculator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">hdr_mode</span><span class="p">:</span> <span class="n"><a href="#HdrMode">siti_tools.siti.HdrMode</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#HdrMode.SDR">HdrMode.SDR</a></span><span class="p">:</span> <span class="s1">&#39;sdr&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>,</span><span class="param">	<span class="n">color_range</span><span class="p">:</span> <span class="n"><a href="#ColorRange">siti_tools.siti.ColorRange</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#ColorRange.LIMITED">ColorRange.LIMITED</a></span><span class="p">:</span> <span class="s1">&#39;limited&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">eotf_function</span><span class="p">:</span> <span class="n"><a href="#EotfFunction">siti_tools.siti.EotfFunction</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#EotfFunction.BT1886">EotfFunction.BT1886</a></span><span class="p">:</span> <span class="s1">&#39;bt1886&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">calculation_domain</span><span class="p">:</span> <span class="n"><a href="#CalculationDomain">siti_tools.siti.CalculationDomain</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#CalculationDomain.PQ">CalculationDomain.PQ</a></span><span class="p">:</span> <span class="s1">&#39;pq&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">l_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">l_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span>,</span><span class="param">	<span class="n">pu21_mode</span><span class="p">:</span> <span class="n"><a href="#Pu21Mode">siti_tools.siti.Pu21Mode</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Pu21Mode.BANDING">Pu21Mode.BANDING</a></span><span class="p">:</span> <span class="s1">&#39;banding&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">show_histogram</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">legacy</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SiTiCalculator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.__init__-115"><a href="#SiTiCalculator.__init__-115"><span class="linenos">115</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SiTiCalculator.__init__-116"><a href="#SiTiCalculator.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-117"><a href="#SiTiCalculator.__init__-117"><span class="linenos">117</span></a>        <span class="n">hdr_mode</span><span class="p">:</span> <span class="n">HdrMode</span> <span class="o">=</span> <span class="n">DEFAULT_HDR_MODE</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-118"><a href="#SiTiCalculator.__init__-118"><span class="linenos">118</span></a>        <span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_BIT_DEPTH</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-119"><a href="#SiTiCalculator.__init__-119"><span class="linenos">119</span></a>        <span class="n">color_range</span><span class="p">:</span> <span class="n">ColorRange</span> <span class="o">=</span> <span class="n">DEFAULT_COLOR_RANGE</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-120"><a href="#SiTiCalculator.__init__-120"><span class="linenos">120</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">DEFAULT_EOTF_FUNCTION</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-121"><a href="#SiTiCalculator.__init__-121"><span class="linenos">121</span></a>        <span class="n">calculation_domain</span><span class="p">:</span> <span class="n">CalculationDomain</span> <span class="o">=</span> <span class="n">DEFAULT_CALCULATION_DOMAIN</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-122"><a href="#SiTiCalculator.__init__-122"><span class="linenos">122</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-123"><a href="#SiTiCalculator.__init__-123"><span class="linenos">123</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-124"><a href="#SiTiCalculator.__init__-124"><span class="linenos">124</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-125"><a href="#SiTiCalculator.__init__-125"><span class="linenos">125</span></a>        <span class="n">pu21_mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">DEFAULT_PU21_MODE</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-126"><a href="#SiTiCalculator.__init__-126"><span class="linenos">126</span></a>        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-127"><a href="#SiTiCalculator.__init__-127"><span class="linenos">127</span></a>        <span class="n">show_histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-128"><a href="#SiTiCalculator.__init__-128"><span class="linenos">128</span></a>        <span class="n">legacy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SiTiCalculator.__init__-129"><a href="#SiTiCalculator.__init__-129"><span class="linenos">129</span></a>    <span class="p">):</span>
</span><span id="SiTiCalculator.__init__-130"><a href="#SiTiCalculator.__init__-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.__init__-131"><a href="#SiTiCalculator.__init__-131"><span class="linenos">131</span></a><span class="sd">        Create a new SI/TI calculator</span>
</span><span id="SiTiCalculator.__init__-132"><a href="#SiTiCalculator.__init__-132"><span class="linenos">132</span></a>
</span><span id="SiTiCalculator.__init__-133"><a href="#SiTiCalculator.__init__-133"><span class="linenos">133</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.__init__-134"><a href="#SiTiCalculator.__init__-134"><span class="linenos">134</span></a><span class="sd">            hdr_mode (HdrMode, optional): Select SDR, HDR10 or HLG. Defaults to SDR.</span>
</span><span id="SiTiCalculator.__init__-135"><a href="#SiTiCalculator.__init__-135"><span class="linenos">135</span></a><span class="sd">            bit_depth (int, optional): 8, 10 or 12. Defaults to 8.</span>
</span><span id="SiTiCalculator.__init__-136"><a href="#SiTiCalculator.__init__-136"><span class="linenos">136</span></a><span class="sd">            color_range (ColorRange, optional): Set the color range (limited or full). Defaults to limited.</span>
</span><span id="SiTiCalculator.__init__-137"><a href="#SiTiCalculator.__init__-137"><span class="linenos">137</span></a><span class="sd">            eotf_function (EotfFunction, optional): EOTF function for converting SDR to HDR. Defaults to BT.1886.</span>
</span><span id="SiTiCalculator.__init__-138"><a href="#SiTiCalculator.__init__-138"><span class="linenos">138</span></a><span class="sd">            calculation_domain (CalculationDomain, optional): Domain to calculate SI/TI in. Defaults to PQ.</span>
</span><span id="SiTiCalculator.__init__-139"><a href="#SiTiCalculator.__init__-139"><span class="linenos">139</span></a><span class="sd">            l_max (float, optional): Set the peak display luminance in cd/m2. Defaults to 300 (SDR) or 1000 (HDR).</span>
</span><span id="SiTiCalculator.__init__-140"><a href="#SiTiCalculator.__init__-140"><span class="linenos">140</span></a><span class="sd">            l_min (float, optional): Set the black display luminance in cd/m2. Defaults to 0.1 (SDR) or 0.01 (HDR).</span>
</span><span id="SiTiCalculator.__init__-141"><a href="#SiTiCalculator.__init__-141"><span class="linenos">141</span></a><span class="sd">            gamma (float, optional): Set the BT.1886 gamma. Defaults to 2.4.</span>
</span><span id="SiTiCalculator.__init__-142"><a href="#SiTiCalculator.__init__-142"><span class="linenos">142</span></a><span class="sd">            pu21_mode (Pu21Mode, optional): Set the default PU21 mode. Defaults to BANDING.</span>
</span><span id="SiTiCalculator.__init__-143"><a href="#SiTiCalculator.__init__-143"><span class="linenos">143</span></a><span class="sd">            verbose (bool, optional): Show verbose logging for the first frame.</span>
</span><span id="SiTiCalculator.__init__-144"><a href="#SiTiCalculator.__init__-144"><span class="linenos">144</span></a><span class="sd">            show_histogram (bool, optional): Show a histogram for the first frame (computation-intensive).</span>
</span><span id="SiTiCalculator.__init__-145"><a href="#SiTiCalculator.__init__-145"><span class="linenos">145</span></a><span class="sd">            legacy (bool, optional): Use legacy SI/TI calculation. Defaults to False.</span>
</span><span id="SiTiCalculator.__init__-146"><a href="#SiTiCalculator.__init__-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.__init__-147"><a href="#SiTiCalculator.__init__-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="SiTiCalculator.__init__-148"><a href="#SiTiCalculator.__init__-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_histogram</span> <span class="o">=</span> <span class="n">show_histogram</span>
</span><span id="SiTiCalculator.__init__-149"><a href="#SiTiCalculator.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="n">legacy</span>
</span><span id="SiTiCalculator.__init__-150"><a href="#SiTiCalculator.__init__-150"><span class="linenos">150</span></a>
</span><span id="SiTiCalculator.__init__-151"><a href="#SiTiCalculator.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator.__init__-152"><a href="#SiTiCalculator.__init__-152"><span class="linenos">152</span></a>
</span><span id="SiTiCalculator.__init__-153"><a href="#SiTiCalculator.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">=</span> <span class="n">hdr_mode</span>
</span><span id="SiTiCalculator.__init__-154"><a href="#SiTiCalculator.__init__-154"><span class="linenos">154</span></a>
</span><span id="SiTiCalculator.__init__-155"><a href="#SiTiCalculator.__init__-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">bit_depth</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
</span><span id="SiTiCalculator.__init__-156"><a href="#SiTiCalculator.__init__-156"><span class="linenos">156</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bit depth must be one of 8, 10, 12&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.__init__-157"><a href="#SiTiCalculator.__init__-157"><span class="linenos">157</span></a>
</span><span id="SiTiCalculator.__init__-158"><a href="#SiTiCalculator.__init__-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">=</span> <span class="n">bit_depth</span>
</span><span id="SiTiCalculator.__init__-159"><a href="#SiTiCalculator.__init__-159"><span class="linenos">159</span></a>
</span><span id="SiTiCalculator.__init__-160"><a href="#SiTiCalculator.__init__-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">=</span> <span class="n">color_range</span>
</span><span id="SiTiCalculator.__init__-161"><a href="#SiTiCalculator.__init__-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span> <span class="o">=</span> <span class="n">eotf_function</span>
</span><span id="SiTiCalculator.__init__-162"><a href="#SiTiCalculator.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">=</span> <span class="n">calculation_domain</span>
</span><span id="SiTiCalculator.__init__-163"><a href="#SiTiCalculator.__init__-163"><span class="linenos">163</span></a>
</span><span id="SiTiCalculator.__init__-164"><a href="#SiTiCalculator.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span> <span class="o">=</span> <span class="n">pu21_mode</span>
</span><span id="SiTiCalculator.__init__-165"><a href="#SiTiCalculator.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SiTiCalculator.__init__-166"><a href="#SiTiCalculator.__init__-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span> <span class="o">==</span> <span class="n">CalculationDomain</span><span class="o">.</span><span class="n">PQ</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-167"><a href="#SiTiCalculator.__init__-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pq</span>
</span><span id="SiTiCalculator.__init__-168"><a href="#SiTiCalculator.__init__-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-169"><a href="#SiTiCalculator.__init__-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">oetf_pu21</span>
</span><span id="SiTiCalculator.__init__-170"><a href="#SiTiCalculator.__init__-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span>
</span><span id="SiTiCalculator.__init__-171"><a href="#SiTiCalculator.__init__-171"><span class="linenos">171</span></a>
</span><span id="SiTiCalculator.__init__-172"><a href="#SiTiCalculator.__init__-172"><span class="linenos">172</span></a>        <span class="c1"># overwrite the default depending on HDR type</span>
</span><span id="SiTiCalculator.__init__-173"><a href="#SiTiCalculator.__init__-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-174"><a href="#SiTiCalculator.__init__-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SiTiCalculator.__init__-175"><a href="#SiTiCalculator.__init__-175"><span class="linenos">175</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX</span>
</span><span id="SiTiCalculator.__init__-176"><a href="#SiTiCalculator.__init__-176"><span class="linenos">176</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="SiTiCalculator.__init__-177"><a href="#SiTiCalculator.__init__-177"><span class="linenos">177</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MAX_HDR</span>
</span><span id="SiTiCalculator.__init__-178"><a href="#SiTiCalculator.__init__-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator.__init__-179"><a href="#SiTiCalculator.__init__-179"><span class="linenos">179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-180"><a href="#SiTiCalculator.__init__-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span> <span class="o">=</span> <span class="n">l_max</span>
</span><span id="SiTiCalculator.__init__-181"><a href="#SiTiCalculator.__init__-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="n">l_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-182"><a href="#SiTiCalculator.__init__-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SiTiCalculator.__init__-183"><a href="#SiTiCalculator.__init__-183"><span class="linenos">183</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN</span>
</span><span id="SiTiCalculator.__init__-184"><a href="#SiTiCalculator.__init__-184"><span class="linenos">184</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span>
</span><span id="SiTiCalculator.__init__-185"><a href="#SiTiCalculator.__init__-185"><span class="linenos">185</span></a>                <span class="k">else</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">DEFAULT_L_MIN_HDR</span>
</span><span id="SiTiCalculator.__init__-186"><a href="#SiTiCalculator.__init__-186"><span class="linenos">186</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator.__init__-187"><a href="#SiTiCalculator.__init__-187"><span class="linenos">187</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.__init__-188"><a href="#SiTiCalculator.__init__-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span> <span class="o">=</span> <span class="n">l_min</span>
</span><span id="SiTiCalculator.__init__-189"><a href="#SiTiCalculator.__init__-189"><span class="linenos">189</span></a>
</span><span id="SiTiCalculator.__init__-190"><a href="#SiTiCalculator.__init__-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="SiTiCalculator.__init__-191"><a href="#SiTiCalculator.__init__-191"><span class="linenos">191</span></a>
</span><span id="SiTiCalculator.__init__-192"><a href="#SiTiCalculator.__init__-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator.__init__-193"><a href="#SiTiCalculator.__init__-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator.__init__-194"><a href="#SiTiCalculator.__init__-194"><span class="linenos">194</span></a>
</span><span id="SiTiCalculator.__init__-195"><a href="#SiTiCalculator.__init__-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Create a new SI/TI calculator</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>hdr_mode (HdrMode, optional):</strong>  Select SDR, HDR10 or HLG. Defaults to SDR.</li>
<li><strong>bit_depth (int, optional):</strong>  8, 10 or 12. Defaults to 8.</li>
<li><strong>color_range (ColorRange, optional):</strong>  Set the color range (limited or full). Defaults to limited.</li>
<li><strong>eotf_function (EotfFunction, optional):</strong>  EOTF function for converting SDR to HDR. Defaults to BT.1886.</li>
<li><strong>calculation_domain (CalculationDomain, optional):</strong>  Domain to calculate SI/TI in. Defaults to PQ.</li>
<li><strong>l_max (float, optional):</strong>  Set the peak display luminance in cd/m2. Defaults to 300 (SDR) or 1000 (HDR).</li>
<li><strong>l_min (float, optional):</strong>  Set the black display luminance in cd/m2. Defaults to 0.1 (SDR) or 0.01 (HDR).</li>
<li><strong>gamma (float, optional):</strong>  Set the BT.1886 gamma. Defaults to 2.4.</li>
<li><strong>pu21_mode (Pu21Mode, optional):</strong>  Set the default PU21 mode. Defaults to BANDING.</li>
<li><strong>verbose (bool, optional):</strong>  Show verbose logging for the first frame.</li>
<li><strong>show_histogram (bool, optional):</strong>  Show a histogram for the first frame (computation-intensive).</li>
<li><strong>legacy (bool, optional):</strong>  Use legacy SI/TI calculation. Defaults to False.</li>
</ul>
</div>


                            </div>
                            <div id="SiTiCalculator.DEFAULT_HDR_MODE" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_HDR_MODE</span>        =
<span class="default_value">&lt;<a href="#HdrMode.SDR">HdrMode.SDR</a>: &#39;sdr&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_HDR_MODE"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_BIT_DEPTH" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_BIT_DEPTH</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_BIT_DEPTH"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_COLOR_RANGE" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_COLOR_RANGE</span>        =
<span class="default_value">&lt;<a href="#ColorRange.LIMITED">ColorRange.LIMITED</a>: &#39;limited&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_COLOR_RANGE"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_EOTF_FUNCTION" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_EOTF_FUNCTION</span>        =
<span class="default_value">&lt;<a href="#EotfFunction.BT1886">EotfFunction.BT1886</a>: &#39;bt1886&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_EOTF_FUNCTION"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_CALCULATION_DOMAIN" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_CALCULATION_DOMAIN</span>        =
<span class="default_value">&lt;<a href="#CalculationDomain.PQ">CalculationDomain.PQ</a>: &#39;pq&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_CALCULATION_DOMAIN"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_PU21_MODE" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_PU21_MODE</span>        =
<span class="default_value">&lt;<a href="#Pu21Mode.BANDING">Pu21Mode.BANDING</a>: &#39;banding&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_PU21_MODE"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_GAMMA" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_GAMMA</span>        =
<span class="default_value">2.4</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_GAMMA"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_L_MIN" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_L_MIN</span>        =
<span class="default_value">0.1</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_L_MIN"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_L_MAX" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_L_MAX</span>        =
<span class="default_value">300</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_L_MAX"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_L_MIN_HDR" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_L_MIN_HDR</span>        =
<span class="default_value">0.01</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_L_MIN_HDR"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.DEFAULT_L_MAX_HDR" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULT_L_MAX_HDR</span>        =
<span class="default_value">1000.0</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.DEFAULT_L_MAX_HDR"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.LIMITED_RANGE" class="classattr">
                                <div class="attr variable">
            <span class="name">LIMITED_RANGE</span>        =
<span class="default_value">{8: {&#39;min&#39;: 16, &#39;max&#39;: 235}, 10: {&#39;min&#39;: 64, &#39;max&#39;: 940}, 12: {&#39;min&#39;: 256, &#39;max&#39;: 3760}}</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.LIMITED_RANGE"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.from_settings" class="classattr">
                                        <input id="SiTiCalculator.from_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span><span class="p">:</span> <span class="n">Dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SiTiCalculator.from_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.from_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.from_settings-111"><a href="#SiTiCalculator.from_settings-111"><span class="linenos">111</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.from_settings-112"><a href="#SiTiCalculator.from_settings-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="SiTiCalculator.from_settings-113"><a href="#SiTiCalculator.from_settings-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="n">SiTiCalculator</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SiTiCalculator.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.verbose"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.show_histogram" class="classattr">
                                <div class="attr variable">
            <span class="name">show_histogram</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.show_histogram"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.legacy" class="classattr">
                                <div class="attr variable">
            <span class="name">legacy</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.legacy"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.callbacks" class="classattr">
                                <div class="attr variable">
            <span class="name">callbacks</span><span class="annotation">: List[Callable]</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.callbacks"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.hdr_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">hdr_mode</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.hdr_mode"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.bit_depth" class="classattr">
                                <div class="attr variable">
            <span class="name">bit_depth</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.bit_depth"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.color_range" class="classattr">
                                <div class="attr variable">
            <span class="name">color_range</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.color_range"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.eotf_function" class="classattr">
                                <div class="attr variable">
            <span class="name">eotf_function</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.eotf_function"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.calculation_domain" class="classattr">
                                <div class="attr variable">
            <span class="name">calculation_domain</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.calculation_domain"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.pu21_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">pu21_mode</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.pu21_mode"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.oetf_function_kwargs" class="classattr">
                                <div class="attr variable">
            <span class="name">oetf_function_kwargs</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.oetf_function_kwargs"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.gamma" class="classattr">
                                <div class="attr variable">
            <span class="name">gamma</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.gamma"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.si_values" class="classattr">
                                <div class="attr variable">
            <span class="name">si_values</span><span class="annotation">: List[float]</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.si_values"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.ti_values" class="classattr">
                                <div class="attr variable">
            <span class="name">ti_values</span><span class="annotation">: List[Optional[float]]</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.ti_values"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.last_input_file" class="classattr">
                                <div class="attr variable">
            <span class="name">last_input_file</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#SiTiCalculator.last_input_file"></a>
    
    

                            </div>
                            <div id="SiTiCalculator.get_general_settings" class="classattr">
                                        <input id="SiTiCalculator.get_general_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_general_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.get_general_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.get_general_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.get_general_settings-197"><a href="#SiTiCalculator.get_general_settings-197"><span class="linenos">197</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_general_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SiTiCalculator.get_general_settings-198"><a href="#SiTiCalculator.get_general_settings-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_general_settings-199"><a href="#SiTiCalculator.get_general_settings-199"><span class="linenos">199</span></a><span class="sd">        A dictionary of settings used for the calculation</span>
</span><span id="SiTiCalculator.get_general_settings-200"><a href="#SiTiCalculator.get_general_settings-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_general_settings-201"><a href="#SiTiCalculator.get_general_settings-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="SiTiCalculator.get_general_settings-202"><a href="#SiTiCalculator.get_general_settings-202"><span class="linenos">202</span></a>            <span class="s2">&quot;calculation_domain&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculation_domain</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_general_settings-203"><a href="#SiTiCalculator.get_general_settings-203"><span class="linenos">203</span></a>            <span class="s2">&quot;hdr_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_general_settings-204"><a href="#SiTiCalculator.get_general_settings-204"><span class="linenos">204</span></a>            <span class="s2">&quot;bit_depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-205"><a href="#SiTiCalculator.get_general_settings-205"><span class="linenos">205</span></a>            <span class="s2">&quot;color_range&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_range</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_general_settings-206"><a href="#SiTiCalculator.get_general_settings-206"><span class="linenos">206</span></a>            <span class="s2">&quot;eotf_function&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_general_settings-207"><a href="#SiTiCalculator.get_general_settings-207"><span class="linenos">207</span></a>            <span class="s2">&quot;l_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-208"><a href="#SiTiCalculator.get_general_settings-208"><span class="linenos">208</span></a>            <span class="s2">&quot;l_min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-209"><a href="#SiTiCalculator.get_general_settings-209"><span class="linenos">209</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-210"><a href="#SiTiCalculator.get_general_settings-210"><span class="linenos">210</span></a>            <span class="s2">&quot;pu21_mode&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pu21_mode</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_general_settings-211"><a href="#SiTiCalculator.get_general_settings-211"><span class="linenos">211</span></a>            <span class="s2">&quot;legacy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-212"><a href="#SiTiCalculator.get_general_settings-212"><span class="linenos">212</span></a>            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_general_settings-213"><a href="#SiTiCalculator.get_general_settings-213"><span class="linenos">213</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>A dictionary of settings used for the calculation</p>
</div>


                            </div>
                            <div id="SiTiCalculator.si" class="classattr">
                                        <input id="SiTiCalculator.si-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">si</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.si-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.si"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.si-215"><a href="#SiTiCalculator.si-215"><span class="linenos">215</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.si-216"><a href="#SiTiCalculator.si-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SiTiCalculator.si-217"><a href="#SiTiCalculator.si-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI of a frame</span>
</span><span id="SiTiCalculator.si-218"><a href="#SiTiCalculator.si-218"><span class="linenos">218</span></a>
</span><span id="SiTiCalculator.si-219"><a href="#SiTiCalculator.si-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.si-220"><a href="#SiTiCalculator.si-220"><span class="linenos">220</span></a><span class="sd">            frame_data (ndarray): 2D array of input frame data</span>
</span><span id="SiTiCalculator.si-221"><a href="#SiTiCalculator.si-221"><span class="linenos">221</span></a>
</span><span id="SiTiCalculator.si-222"><a href="#SiTiCalculator.si-222"><span class="linenos">222</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.si-223"><a href="#SiTiCalculator.si-223"><span class="linenos">223</span></a><span class="sd">            float: SI</span>
</span><span id="SiTiCalculator.si-224"><a href="#SiTiCalculator.si-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.si-225"><a href="#SiTiCalculator.si-225"><span class="linenos">225</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="SiTiCalculator.si-226"><a href="#SiTiCalculator.si-226"><span class="linenos">226</span></a>
</span><span id="SiTiCalculator.si-227"><a href="#SiTiCalculator.si-227"><span class="linenos">227</span></a>        <span class="c1"># calculate horizontal/vertical operators</span>
</span><span id="SiTiCalculator.si-228"><a href="#SiTiCalculator.si-228"><span class="linenos">228</span></a>        <span class="n">sob_x</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SiTiCalculator.si-229"><a href="#SiTiCalculator.si-229"><span class="linenos">229</span></a>        <span class="n">sob_y</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">sobel</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SiTiCalculator.si-230"><a href="#SiTiCalculator.si-230"><span class="linenos">230</span></a>
</span><span id="SiTiCalculator.si-231"><a href="#SiTiCalculator.si-231"><span class="linenos">231</span></a>        <span class="c1"># crop output to valid window, calculate gradient magnitude</span>
</span><span id="SiTiCalculator.si-232"><a href="#SiTiCalculator.si-232"><span class="linenos">232</span></a>        <span class="n">si</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">sob_x</span><span class="p">,</span> <span class="n">sob_y</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SiTiCalculator.si-233"><a href="#SiTiCalculator.si-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">si</span>
</span></pre></div>


            <div class="docstring"><p>Calculate SI of a frame</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data (ndarray):</strong>  2D array of input frame data</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: SI</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.ti" class="classattr">
                                        <input id="SiTiCalculator.ti-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">ti</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">previous_frame_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.ti-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.ti"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.ti-235"><a href="#SiTiCalculator.ti-235"><span class="linenos">235</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.ti-236"><a href="#SiTiCalculator.ti-236"><span class="linenos">236</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ti</span><span class="p">(</span>
</span><span id="SiTiCalculator.ti-237"><a href="#SiTiCalculator.ti-237"><span class="linenos">237</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
</span><span id="SiTiCalculator.ti-238"><a href="#SiTiCalculator.ti-238"><span class="linenos">238</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="SiTiCalculator.ti-239"><a href="#SiTiCalculator.ti-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.ti-240"><a href="#SiTiCalculator.ti-240"><span class="linenos">240</span></a><span class="sd">        Calculate TI between two frames.</span>
</span><span id="SiTiCalculator.ti-241"><a href="#SiTiCalculator.ti-241"><span class="linenos">241</span></a>
</span><span id="SiTiCalculator.ti-242"><a href="#SiTiCalculator.ti-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.ti-243"><a href="#SiTiCalculator.ti-243"><span class="linenos">243</span></a><span class="sd">            frame_data (ndarray): 2D array of current frame data</span>
</span><span id="SiTiCalculator.ti-244"><a href="#SiTiCalculator.ti-244"><span class="linenos">244</span></a><span class="sd">            previous_frame_data (ndarray): 2D array of previous frame data, must be of same size as current frame</span>
</span><span id="SiTiCalculator.ti-245"><a href="#SiTiCalculator.ti-245"><span class="linenos">245</span></a>
</span><span id="SiTiCalculator.ti-246"><a href="#SiTiCalculator.ti-246"><span class="linenos">246</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.ti-247"><a href="#SiTiCalculator.ti-247"><span class="linenos">247</span></a><span class="sd">            float: TI, or None if previous frame data is not given</span>
</span><span id="SiTiCalculator.ti-248"><a href="#SiTiCalculator.ti-248"><span class="linenos">248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.ti-249"><a href="#SiTiCalculator.ti-249"><span class="linenos">249</span></a>        <span class="c1"># TODO: check array dimensions</span>
</span><span id="SiTiCalculator.ti-250"><a href="#SiTiCalculator.ti-250"><span class="linenos">250</span></a>        <span class="c1"># TODO: check array dimensions equal between both args</span>
</span><span id="SiTiCalculator.ti-251"><a href="#SiTiCalculator.ti-251"><span class="linenos">251</span></a>
</span><span id="SiTiCalculator.ti-252"><a href="#SiTiCalculator.ti-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">previous_frame_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator.ti-253"><a href="#SiTiCalculator.ti-253"><span class="linenos">253</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SiTiCalculator.ti-254"><a href="#SiTiCalculator.ti-254"><span class="linenos">254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.ti-255"><a href="#SiTiCalculator.ti-255"><span class="linenos">255</span></a>            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frame_data</span> <span class="o">-</span> <span class="n">previous_frame_data</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Calculate TI between two frames.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data (ndarray):</strong>  2D array of current frame data</li>
<li><strong>previous_frame_data (ndarray):</strong>  2D array of previous frame data, must be of same size as current frame</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: TI, or None if previous frame data is not given</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.eotf_1886" class="classattr">
                                        <input id="SiTiCalculator.eotf_1886-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">eotf_1886</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span>,</span><span class="param">	<span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.eotf_1886-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.eotf_1886"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.eotf_1886-257"><a href="#SiTiCalculator.eotf_1886-257"><span class="linenos">257</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.eotf_1886-258"><a href="#SiTiCalculator.eotf_1886-258"><span class="linenos">258</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_1886</span><span class="p">(</span>
</span><span id="SiTiCalculator.eotf_1886-259"><a href="#SiTiCalculator.eotf_1886-259"><span class="linenos">259</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_1886-260"><a href="#SiTiCalculator.eotf_1886-260"><span class="linenos">260</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_1886-261"><a href="#SiTiCalculator.eotf_1886-261"><span class="linenos">261</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_1886-262"><a href="#SiTiCalculator.eotf_1886-262"><span class="linenos">262</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_1886-263"><a href="#SiTiCalculator.eotf_1886-263"><span class="linenos">263</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_1886-264"><a href="#SiTiCalculator.eotf_1886-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_1886-265"><a href="#SiTiCalculator.eotf_1886-265"><span class="linenos">265</span></a><span class="sd">        Electro-optical transfer function defined in ITU-R Rec. BT.1886</span>
</span><span id="SiTiCalculator.eotf_1886-266"><a href="#SiTiCalculator.eotf_1886-266"><span class="linenos">266</span></a>
</span><span id="SiTiCalculator.eotf_1886-267"><a href="#SiTiCalculator.eotf_1886-267"><span class="linenos">267</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.eotf_1886-268"><a href="#SiTiCalculator.eotf_1886-268"><span class="linenos">268</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="SiTiCalculator.eotf_1886-269"><a href="#SiTiCalculator.eotf_1886-269"><span class="linenos">269</span></a><span class="sd">            gamma: exponent</span>
</span><span id="SiTiCalculator.eotf_1886-270"><a href="#SiTiCalculator.eotf_1886-270"><span class="linenos">270</span></a><span class="sd">            l_min: minimum luminance</span>
</span><span id="SiTiCalculator.eotf_1886-271"><a href="#SiTiCalculator.eotf_1886-271"><span class="linenos">271</span></a><span class="sd">            l_max: maximum luminance</span>
</span><span id="SiTiCalculator.eotf_1886-272"><a href="#SiTiCalculator.eotf_1886-272"><span class="linenos">272</span></a><span class="sd">        Note:</span>
</span><span id="SiTiCalculator.eotf_1886-273"><a href="#SiTiCalculator.eotf_1886-273"><span class="linenos">273</span></a><span class="sd">            As the mapping to display luminance happens outside of this function, l_min and l_max are set to 0.0 and 1.0,</span>
</span><span id="SiTiCalculator.eotf_1886-274"><a href="#SiTiCalculator.eotf_1886-274"><span class="linenos">274</span></a><span class="sd">            respectively. If you change these values while using this function in the context of SI/TI calculation, your</span>
</span><span id="SiTiCalculator.eotf_1886-275"><a href="#SiTiCalculator.eotf_1886-275"><span class="linenos">275</span></a><span class="sd">            output will be wrong. You can however change the values when using this function in a standalone fashion.</span>
</span><span id="SiTiCalculator.eotf_1886-276"><a href="#SiTiCalculator.eotf_1886-276"><span class="linenos">276</span></a>
</span><span id="SiTiCalculator.eotf_1886-277"><a href="#SiTiCalculator.eotf_1886-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.eotf_1886-278"><a href="#SiTiCalculator.eotf_1886-278"><span class="linenos">278</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator.eotf_1886-279"><a href="#SiTiCalculator.eotf_1886-279"><span class="linenos">279</span></a>
</span><span id="SiTiCalculator.eotf_1886-280"><a href="#SiTiCalculator.eotf_1886-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_1886-281"><a href="#SiTiCalculator.eotf_1886-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_1886-282"><a href="#SiTiCalculator.eotf_1886-282"><span class="linenos">282</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-283"><a href="#SiTiCalculator.eotf_1886-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_1886-284"><a href="#SiTiCalculator.eotf_1886-284"><span class="linenos">284</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_1886() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-285"><a href="#SiTiCalculator.eotf_1886-285"><span class="linenos">285</span></a>
</span><span id="SiTiCalculator.eotf_1886-286"><a href="#SiTiCalculator.eotf_1886-286"><span class="linenos">286</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-287"><a href="#SiTiCalculator.eotf_1886-287"><span class="linenos">287</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-288"><a href="#SiTiCalculator.eotf_1886-288"><span class="linenos">288</span></a>
</span><span id="SiTiCalculator.eotf_1886-289"><a href="#SiTiCalculator.eotf_1886-289"><span class="linenos">289</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-290"><a href="#SiTiCalculator.eotf_1886-290"><span class="linenos">290</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="SiTiCalculator.eotf_1886-291"><a href="#SiTiCalculator.eotf_1886-291"><span class="linenos">291</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_max</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">l_min</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-292"><a href="#SiTiCalculator.eotf_1886-292"><span class="linenos">292</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-293"><a href="#SiTiCalculator.eotf_1886-293"><span class="linenos">293</span></a>
</span><span id="SiTiCalculator.eotf_1886-294"><a href="#SiTiCalculator.eotf_1886-294"><span class="linenos">294</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gamma</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_1886-295"><a href="#SiTiCalculator.eotf_1886-295"><span class="linenos">295</span></a>
</span><span id="SiTiCalculator.eotf_1886-296"><a href="#SiTiCalculator.eotf_1886-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span></pre></div>


            <div class="docstring"><p>Electro-optical transfer function defined in ITU-R Rec. BT.1886</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data:</strong>  pixel values expected in the range [0, 1]</li>
<li><strong>gamma:</strong>  exponent</li>
<li><strong>l_min:</strong>  minimum luminance</li>
<li><strong>l_max:</strong>  maximum luminance</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>As the mapping to display luminance happens outside of this function, l_min and l_max are set to 0.0 and 1.0,
  respectively. If you change these values while using this function in the context of SI/TI calculation, your
  output will be wrong. You can however change the values when using this function in a standalone fashion.</p>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the range [0, 1]</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.eotf_inv_srgb" class="classattr">
                                        <input id="SiTiCalculator.eotf_inv_srgb-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">eotf_inv_srgb</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.eotf_inv_srgb-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.eotf_inv_srgb"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.eotf_inv_srgb-298"><a href="#SiTiCalculator.eotf_inv_srgb-298"><span class="linenos">298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-299"><a href="#SiTiCalculator.eotf_inv_srgb-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_inv_srgb</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-300"><a href="#SiTiCalculator.eotf_inv_srgb-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-301"><a href="#SiTiCalculator.eotf_inv_srgb-301"><span class="linenos">301</span></a><span class="sd">        Inverse sRGB electro-optical transfer function</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-302"><a href="#SiTiCalculator.eotf_inv_srgb-302"><span class="linenos">302</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-303"><a href="#SiTiCalculator.eotf_inv_srgb-303"><span class="linenos">303</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-304"><a href="#SiTiCalculator.eotf_inv_srgb-304"><span class="linenos">304</span></a><span class="sd">            frame_data: pixel values expected in the range [0, 1]</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-305"><a href="#SiTiCalculator.eotf_inv_srgb-305"><span class="linenos">305</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-306"><a href="#SiTiCalculator.eotf_inv_srgb-306"><span class="linenos">306</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-307"><a href="#SiTiCalculator.eotf_inv_srgb-307"><span class="linenos">307</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-308"><a href="#SiTiCalculator.eotf_inv_srgb-308"><span class="linenos">308</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-309"><a href="#SiTiCalculator.eotf_inv_srgb-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-310"><a href="#SiTiCalculator.eotf_inv_srgb-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-311"><a href="#SiTiCalculator.eotf_inv_srgb-311"><span class="linenos">311</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &lt; 0, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-312"><a href="#SiTiCalculator.eotf_inv_srgb-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-313"><a href="#SiTiCalculator.eotf_inv_srgb-313"><span class="linenos">313</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input for eotf_inv_srgb() was &gt; 1, truncating&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-314"><a href="#SiTiCalculator.eotf_inv_srgb-314"><span class="linenos">314</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-315"><a href="#SiTiCalculator.eotf_inv_srgb-315"><span class="linenos">315</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-316"><a href="#SiTiCalculator.eotf_inv_srgb-316"><span class="linenos">316</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-317"><a href="#SiTiCalculator.eotf_inv_srgb-317"><span class="linenos">317</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-318"><a href="#SiTiCalculator.eotf_inv_srgb-318"><span class="linenos">318</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.04045</span><span class="p">)</span> <span class="o">*</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="mf">12.92</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-319"><a href="#SiTiCalculator.eotf_inv_srgb-319"><span class="linenos">319</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-320"><a href="#SiTiCalculator.eotf_inv_srgb-320"><span class="linenos">320</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_inv_srgb-321"><a href="#SiTiCalculator.eotf_inv_srgb-321"><span class="linenos">321</span></a>
</span><span id="SiTiCalculator.eotf_inv_srgb-322"><a href="#SiTiCalculator.eotf_inv_srgb-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span></pre></div>


            <div class="docstring"><p>Inverse sRGB electro-optical transfer function</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data:</strong>  pixel values expected in the range [0, 1]</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the range [0, 1]</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.apply_display_model" class="classattr">
                                        <input id="SiTiCalculator.apply_display_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">apply_display_model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">eotf_function</span><span class="p">:</span> <span class="n"><a href="#EotfFunction">siti_tools.siti.EotfFunction</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#EotfFunction.BT1886">EotfFunction.BT1886</a></span><span class="p">:</span> <span class="s1">&#39;bt1886&#39;</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">300</span>,</span><span class="param">	<span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.apply_display_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.apply_display_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.apply_display_model-324"><a href="#SiTiCalculator.apply_display_model-324"><span class="linenos">324</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.apply_display_model-325"><a href="#SiTiCalculator.apply_display_model-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_display_model</span><span class="p">(</span>
</span><span id="SiTiCalculator.apply_display_model-326"><a href="#SiTiCalculator.apply_display_model-326"><span class="linenos">326</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator.apply_display_model-327"><a href="#SiTiCalculator.apply_display_model-327"><span class="linenos">327</span></a>        <span class="n">eotf_function</span><span class="p">:</span> <span class="n">EotfFunction</span> <span class="o">=</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">,</span>
</span><span id="SiTiCalculator.apply_display_model-328"><a href="#SiTiCalculator.apply_display_model-328"><span class="linenos">328</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX</span><span class="p">,</span>
</span><span id="SiTiCalculator.apply_display_model-329"><a href="#SiTiCalculator.apply_display_model-329"><span class="linenos">329</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN</span><span class="p">,</span>
</span><span id="SiTiCalculator.apply_display_model-330"><a href="#SiTiCalculator.apply_display_model-330"><span class="linenos">330</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_GAMMA</span><span class="p">,</span>
</span><span id="SiTiCalculator.apply_display_model-331"><a href="#SiTiCalculator.apply_display_model-331"><span class="linenos">331</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-332"><a href="#SiTiCalculator.apply_display_model-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.apply_display_model-333"><a href="#SiTiCalculator.apply_display_model-333"><span class="linenos">333</span></a><span class="sd">        Apply the SDR EOTF</span>
</span><span id="SiTiCalculator.apply_display_model-334"><a href="#SiTiCalculator.apply_display_model-334"><span class="linenos">334</span></a>
</span><span id="SiTiCalculator.apply_display_model-335"><a href="#SiTiCalculator.apply_display_model-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.apply_display_model-336"><a href="#SiTiCalculator.apply_display_model-336"><span class="linenos">336</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="SiTiCalculator.apply_display_model-337"><a href="#SiTiCalculator.apply_display_model-337"><span class="linenos">337</span></a><span class="sd">            Other arguments: see calculate()</span>
</span><span id="SiTiCalculator.apply_display_model-338"><a href="#SiTiCalculator.apply_display_model-338"><span class="linenos">338</span></a>
</span><span id="SiTiCalculator.apply_display_model-339"><a href="#SiTiCalculator.apply_display_model-339"><span class="linenos">339</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.apply_display_model-340"><a href="#SiTiCalculator.apply_display_model-340"><span class="linenos">340</span></a><span class="sd">            frame_data: pixel values in the physical domain.</span>
</span><span id="SiTiCalculator.apply_display_model-341"><a href="#SiTiCalculator.apply_display_model-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.apply_display_model-342"><a href="#SiTiCalculator.apply_display_model-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-343"><a href="#SiTiCalculator.apply_display_model-343"><span class="linenos">343</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &lt; 0&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.apply_display_model-344"><a href="#SiTiCalculator.apply_display_model-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-345"><a href="#SiTiCalculator.apply_display_model-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input for apply_display_model() was &gt; 1&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.apply_display_model-346"><a href="#SiTiCalculator.apply_display_model-346"><span class="linenos">346</span></a>
</span><span id="SiTiCalculator.apply_display_model-347"><a href="#SiTiCalculator.apply_display_model-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">BT1886</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-348"><a href="#SiTiCalculator.apply_display_model-348"><span class="linenos">348</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_1886</span>
</span><span id="SiTiCalculator.apply_display_model-349"><a href="#SiTiCalculator.apply_display_model-349"><span class="linenos">349</span></a>            <span class="c1"># note that l_min/l_max are not passed here on purpose, as they are set to 0.0 and 1.0,</span>
</span><span id="SiTiCalculator.apply_display_model-350"><a href="#SiTiCalculator.apply_display_model-350"><span class="linenos">350</span></a>            <span class="c1"># and mapped outside of the eotf_1886 function</span>
</span><span id="SiTiCalculator.apply_display_model-351"><a href="#SiTiCalculator.apply_display_model-351"><span class="linenos">351</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
</span><span id="SiTiCalculator.apply_display_model-352"><a href="#SiTiCalculator.apply_display_model-352"><span class="linenos">352</span></a>        <span class="k">elif</span> <span class="n">eotf_function</span> <span class="o">==</span> <span class="n">EotfFunction</span><span class="o">.</span><span class="n">INV_SRGB</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-353"><a href="#SiTiCalculator.apply_display_model-353"><span class="linenos">353</span></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_inv_srgb</span>
</span><span id="SiTiCalculator.apply_display_model-354"><a href="#SiTiCalculator.apply_display_model-354"><span class="linenos">354</span></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SiTiCalculator.apply_display_model-355"><a href="#SiTiCalculator.apply_display_model-355"><span class="linenos">355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.apply_display_model-356"><a href="#SiTiCalculator.apply_display_model-356"><span class="linenos">356</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown EOTF function!&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.apply_display_model-357"><a href="#SiTiCalculator.apply_display_model-357"><span class="linenos">357</span></a>
</span><span id="SiTiCalculator.apply_display_model-358"><a href="#SiTiCalculator.apply_display_model-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">fn</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span></pre></div>


            <div class="docstring"><p>Apply the SDR EOTF</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data (np.ndarray):</strong>  Raw frame data in full range, values in the range [0, 1]</li>
<li><strong>Other arguments:</strong>  see calculate()</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the physical domain.</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.oetf_pq" class="classattr">
                                        <input id="SiTiCalculator.oetf_pq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">oetf_pq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.oetf_pq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.oetf_pq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.oetf_pq-360"><a href="#SiTiCalculator.oetf_pq-360"><span class="linenos">360</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.oetf_pq-361"><a href="#SiTiCalculator.oetf_pq-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pq</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pq-362"><a href="#SiTiCalculator.oetf_pq-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.oetf_pq-363"><a href="#SiTiCalculator.oetf_pq-363"><span class="linenos">363</span></a><span class="sd">        Perceptual quantizer opto-electrical transfer function defined in ITU-R Rec. BT.2100</span>
</span><span id="SiTiCalculator.oetf_pq-364"><a href="#SiTiCalculator.oetf_pq-364"><span class="linenos">364</span></a>
</span><span id="SiTiCalculator.oetf_pq-365"><a href="#SiTiCalculator.oetf_pq-365"><span class="linenos">365</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.oetf_pq-366"><a href="#SiTiCalculator.oetf_pq-366"><span class="linenos">366</span></a><span class="sd">            frame_data: pixel values expected to be in the physical luminance between 0 and 10,000 cd/m^2</span>
</span><span id="SiTiCalculator.oetf_pq-367"><a href="#SiTiCalculator.oetf_pq-367"><span class="linenos">367</span></a>
</span><span id="SiTiCalculator.oetf_pq-368"><a href="#SiTiCalculator.oetf_pq-368"><span class="linenos">368</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.oetf_pq-369"><a href="#SiTiCalculator.oetf_pq-369"><span class="linenos">369</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator.oetf_pq-370"><a href="#SiTiCalculator.oetf_pq-370"><span class="linenos">370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.oetf_pq-371"><a href="#SiTiCalculator.oetf_pq-371"><span class="linenos">371</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="mf">78.84375</span>
</span><span id="SiTiCalculator.oetf_pq-372"><a href="#SiTiCalculator.oetf_pq-372"><span class="linenos">372</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mf">0.1593017578125</span>
</span><span id="SiTiCalculator.oetf_pq-373"><a href="#SiTiCalculator.oetf_pq-373"><span class="linenos">373</span></a>        <span class="n">c1</span> <span class="o">=</span> <span class="mf">0.8359375</span>
</span><span id="SiTiCalculator.oetf_pq-374"><a href="#SiTiCalculator.oetf_pq-374"><span class="linenos">374</span></a>        <span class="n">c2</span> <span class="o">=</span> <span class="mf">18.8515625</span>
</span><span id="SiTiCalculator.oetf_pq-375"><a href="#SiTiCalculator.oetf_pq-375"><span class="linenos">375</span></a>        <span class="n">c3</span> <span class="o">=</span> <span class="mf">18.6875</span>
</span><span id="SiTiCalculator.oetf_pq-376"><a href="#SiTiCalculator.oetf_pq-376"><span class="linenos">376</span></a>        <span class="n">lm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pq-377"><a href="#SiTiCalculator.oetf_pq-377"><span class="linenos">377</span></a>        <span class="c1"># FIXME: this might return an error if input is negative, see https://stackoverflow.com/q/45384602/</span>
</span><span id="SiTiCalculator.oetf_pq-378"><a href="#SiTiCalculator.oetf_pq-378"><span class="linenos">378</span></a>        <span class="n">lm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pq-379"><a href="#SiTiCalculator.oetf_pq-379"><span class="linenos">379</span></a>
</span><span id="SiTiCalculator.oetf_pq-380"><a href="#SiTiCalculator.oetf_pq-380"><span class="linenos">380</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">c1</span> <span class="o">*</span> <span class="n">lm1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lm1</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">lm2</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pq-381"><a href="#SiTiCalculator.oetf_pq-381"><span class="linenos">381</span></a>
</span><span id="SiTiCalculator.oetf_pq-382"><a href="#SiTiCalculator.oetf_pq-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span></pre></div>


            <div class="docstring"><p>Perceptual quantizer opto-electrical transfer function defined in ITU-R Rec. BT.2100</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data:</strong>  pixel values expected to be in the physical luminance between 0 and 10,000 cd/m^2</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the range [0, 1]</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.oetf_pu21" class="classattr">
                                        <input id="SiTiCalculator.oetf_pu21-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">oetf_pu21</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n"><a href="#Pu21Mode">siti_tools.siti.Pu21Mode</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Pu21Mode.BANDING">Pu21Mode.BANDING</a></span><span class="p">:</span> <span class="s1">&#39;banding&#39;</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.oetf_pu21-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.oetf_pu21"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.oetf_pu21-384"><a href="#SiTiCalculator.oetf_pu21-384"><span class="linenos">384</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.oetf_pu21-385"><a href="#SiTiCalculator.oetf_pu21-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">oetf_pu21</span><span class="p">(</span>
</span><span id="SiTiCalculator.oetf_pu21-386"><a href="#SiTiCalculator.oetf_pu21-386"><span class="linenos">386</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-387"><a href="#SiTiCalculator.oetf_pu21-387"><span class="linenos">387</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Pu21Mode</span> <span class="o">=</span> <span class="n">Pu21Mode</span><span class="o">.</span><span class="n">BANDING</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-388"><a href="#SiTiCalculator.oetf_pu21-388"><span class="linenos">388</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-389"><a href="#SiTiCalculator.oetf_pu21-389"><span class="linenos">389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.oetf_pu21-390"><a href="#SiTiCalculator.oetf_pu21-390"><span class="linenos">390</span></a><span class="sd">        PU21 OETF, see https://github.com/gfxdisp/pu21</span>
</span><span id="SiTiCalculator.oetf_pu21-391"><a href="#SiTiCalculator.oetf_pu21-391"><span class="linenos">391</span></a>
</span><span id="SiTiCalculator.oetf_pu21-392"><a href="#SiTiCalculator.oetf_pu21-392"><span class="linenos">392</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.oetf_pu21-393"><a href="#SiTiCalculator.oetf_pu21-393"><span class="linenos">393</span></a><span class="sd">            frame_data (np.ndarray): Raw frame data in full range, values in the range [0, 1]</span>
</span><span id="SiTiCalculator.oetf_pu21-394"><a href="#SiTiCalculator.oetf_pu21-394"><span class="linenos">394</span></a><span class="sd">            mode (Pu21Mode), defaults to Pu21Mode.BANDING</span>
</span><span id="SiTiCalculator.oetf_pu21-395"><a href="#SiTiCalculator.oetf_pu21-395"><span class="linenos">395</span></a>
</span><span id="SiTiCalculator.oetf_pu21-396"><a href="#SiTiCalculator.oetf_pu21-396"><span class="linenos">396</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.oetf_pu21-397"><a href="#SiTiCalculator.oetf_pu21-397"><span class="linenos">397</span></a><span class="sd">            frame_data: pixel values in the range [0, 1]</span>
</span><span id="SiTiCalculator.oetf_pu21-398"><a href="#SiTiCalculator.oetf_pu21-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.oetf_pu21-399"><a href="#SiTiCalculator.oetf_pu21-399"><span class="linenos">399</span></a>
</span><span id="SiTiCalculator.oetf_pu21-400"><a href="#SiTiCalculator.oetf_pu21-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-401"><a href="#SiTiCalculator.oetf_pu21-401"><span class="linenos">401</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator.oetf_pu21-402"><a href="#SiTiCalculator.oetf_pu21-402"><span class="linenos">402</span></a>                <span class="mf">1.070275272</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-403"><a href="#SiTiCalculator.oetf_pu21-403"><span class="linenos">403</span></a>                <span class="mf">0.4088273932</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-404"><a href="#SiTiCalculator.oetf_pu21-404"><span class="linenos">404</span></a>                <span class="mf">0.153224308</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-405"><a href="#SiTiCalculator.oetf_pu21-405"><span class="linenos">405</span></a>                <span class="mf">0.2520326168</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-406"><a href="#SiTiCalculator.oetf_pu21-406"><span class="linenos">406</span></a>                <span class="mf">1.063512885</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-407"><a href="#SiTiCalculator.oetf_pu21-407"><span class="linenos">407</span></a>                <span class="mf">1.14115047</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-408"><a href="#SiTiCalculator.oetf_pu21-408"><span class="linenos">408</span></a>                <span class="mf">521.4527484</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-409"><a href="#SiTiCalculator.oetf_pu21-409"><span class="linenos">409</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator.oetf_pu21-410"><a href="#SiTiCalculator.oetf_pu21-410"><span class="linenos">410</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5580e-07</span>
</span><span id="SiTiCalculator.oetf_pu21-411"><a href="#SiTiCalculator.oetf_pu21-411"><span class="linenos">411</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">520.4673</span>
</span><span id="SiTiCalculator.oetf_pu21-412"><a href="#SiTiCalculator.oetf_pu21-412"><span class="linenos">412</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;banding_glare&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-413"><a href="#SiTiCalculator.oetf_pu21-413"><span class="linenos">413</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator.oetf_pu21-414"><a href="#SiTiCalculator.oetf_pu21-414"><span class="linenos">414</span></a>                <span class="mf">0.353487901</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-415"><a href="#SiTiCalculator.oetf_pu21-415"><span class="linenos">415</span></a>                <span class="mf">0.3734658629</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-416"><a href="#SiTiCalculator.oetf_pu21-416"><span class="linenos">416</span></a>                <span class="mf">8.277049286e-05</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-417"><a href="#SiTiCalculator.oetf_pu21-417"><span class="linenos">417</span></a>                <span class="mf">0.9062562627</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-418"><a href="#SiTiCalculator.oetf_pu21-418"><span class="linenos">418</span></a>                <span class="mf">0.09150303166</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-419"><a href="#SiTiCalculator.oetf_pu21-419"><span class="linenos">419</span></a>                <span class="mf">0.9099517204</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-420"><a href="#SiTiCalculator.oetf_pu21-420"><span class="linenos">420</span></a>                <span class="mf">596.3148142</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-421"><a href="#SiTiCalculator.oetf_pu21-421"><span class="linenos">421</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator.oetf_pu21-422"><a href="#SiTiCalculator.oetf_pu21-422"><span class="linenos">422</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">5.4705e-10</span>
</span><span id="SiTiCalculator.oetf_pu21-423"><a href="#SiTiCalculator.oetf_pu21-423"><span class="linenos">423</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">595.3939</span>
</span><span id="SiTiCalculator.oetf_pu21-424"><a href="#SiTiCalculator.oetf_pu21-424"><span class="linenos">424</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-425"><a href="#SiTiCalculator.oetf_pu21-425"><span class="linenos">425</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator.oetf_pu21-426"><a href="#SiTiCalculator.oetf_pu21-426"><span class="linenos">426</span></a>                <span class="mf">1.043882782</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-427"><a href="#SiTiCalculator.oetf_pu21-427"><span class="linenos">427</span></a>                <span class="mf">0.6459495343</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-428"><a href="#SiTiCalculator.oetf_pu21-428"><span class="linenos">428</span></a>                <span class="mf">0.3194584211</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-429"><a href="#SiTiCalculator.oetf_pu21-429"><span class="linenos">429</span></a>                <span class="mf">0.374025247</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-430"><a href="#SiTiCalculator.oetf_pu21-430"><span class="linenos">430</span></a>                <span class="mf">1.114783422</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-431"><a href="#SiTiCalculator.oetf_pu21-431"><span class="linenos">431</span></a>                <span class="mf">1.095360363</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-432"><a href="#SiTiCalculator.oetf_pu21-432"><span class="linenos">432</span></a>                <span class="mf">384.9217577</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-433"><a href="#SiTiCalculator.oetf_pu21-433"><span class="linenos">433</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator.oetf_pu21-434"><a href="#SiTiCalculator.oetf_pu21-434"><span class="linenos">434</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="mf">1.3674e-07</span>
</span><span id="SiTiCalculator.oetf_pu21-435"><a href="#SiTiCalculator.oetf_pu21-435"><span class="linenos">435</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">380.9853</span>
</span><span id="SiTiCalculator.oetf_pu21-436"><a href="#SiTiCalculator.oetf_pu21-436"><span class="linenos">436</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;peaks_glare&quot;</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-437"><a href="#SiTiCalculator.oetf_pu21-437"><span class="linenos">437</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SiTiCalculator.oetf_pu21-438"><a href="#SiTiCalculator.oetf_pu21-438"><span class="linenos">438</span></a>                <span class="mf">816.885024</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-439"><a href="#SiTiCalculator.oetf_pu21-439"><span class="linenos">439</span></a>                <span class="mf">1479.463946</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-440"><a href="#SiTiCalculator.oetf_pu21-440"><span class="linenos">440</span></a>                <span class="mf">0.001253215609</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-441"><a href="#SiTiCalculator.oetf_pu21-441"><span class="linenos">441</span></a>                <span class="mf">0.9329636822</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-442"><a href="#SiTiCalculator.oetf_pu21-442"><span class="linenos">442</span></a>                <span class="mf">0.06746643971</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-443"><a href="#SiTiCalculator.oetf_pu21-443"><span class="linenos">443</span></a>                <span class="mf">1.573435413</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-444"><a href="#SiTiCalculator.oetf_pu21-444"><span class="linenos">444</span></a>                <span class="mf">419.6006374</span><span class="p">,</span>
</span><span id="SiTiCalculator.oetf_pu21-445"><a href="#SiTiCalculator.oetf_pu21-445"><span class="linenos">445</span></a>            <span class="p">]</span>
</span><span id="SiTiCalculator.oetf_pu21-446"><a href="#SiTiCalculator.oetf_pu21-446"><span class="linenos">446</span></a>            <span class="n">p_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.7360e-08</span>
</span><span id="SiTiCalculator.oetf_pu21-447"><a href="#SiTiCalculator.oetf_pu21-447"><span class="linenos">447</span></a>            <span class="n">p_max</span> <span class="o">=</span> <span class="mf">407.5066</span>
</span><span id="SiTiCalculator.oetf_pu21-448"><a href="#SiTiCalculator.oetf_pu21-448"><span class="linenos">448</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.oetf_pu21-449"><a href="#SiTiCalculator.oetf_pu21-449"><span class="linenos">449</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode specified for PU21&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pu21-450"><a href="#SiTiCalculator.oetf_pu21-450"><span class="linenos">450</span></a>
</span><span id="SiTiCalculator.oetf_pu21-451"><a href="#SiTiCalculator.oetf_pu21-451"><span class="linenos">451</span></a>        <span class="c1"># scale frame_data to the range 0.005 - 10,000</span>
</span><span id="SiTiCalculator.oetf_pu21-452"><a href="#SiTiCalculator.oetf_pu21-452"><span class="linenos">452</span></a>        <span class="c1"># disabled since the input is already in physical luminance</span>
</span><span id="SiTiCalculator.oetf_pu21-453"><a href="#SiTiCalculator.oetf_pu21-453"><span class="linenos">453</span></a>        <span class="c1"># frame_data = frame_data * 10000.0</span>
</span><span id="SiTiCalculator.oetf_pu21-454"><a href="#SiTiCalculator.oetf_pu21-454"><span class="linenos">454</span></a>        <span class="c1"># frame_data = np.maximum(frame_data, 0.05)</span>
</span><span id="SiTiCalculator.oetf_pu21-455"><a href="#SiTiCalculator.oetf_pu21-455"><span class="linenos">455</span></a>
</span><span id="SiTiCalculator.oetf_pu21-456"><a href="#SiTiCalculator.oetf_pu21-456"><span class="linenos">456</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SiTiCalculator.oetf_pu21-457"><a href="#SiTiCalculator.oetf_pu21-457"><span class="linenos">457</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
</span><span id="SiTiCalculator.oetf_pu21-458"><a href="#SiTiCalculator.oetf_pu21-458"><span class="linenos">458</span></a>                <span class="p">(</span>
</span><span id="SiTiCalculator.oetf_pu21-459"><a href="#SiTiCalculator.oetf_pu21-459"><span class="linenos">459</span></a>                    <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SiTiCalculator.oetf_pu21-460"><a href="#SiTiCalculator.oetf_pu21-460"><span class="linenos">460</span></a>                    <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SiTiCalculator.oetf_pu21-461"><a href="#SiTiCalculator.oetf_pu21-461"><span class="linenos">461</span></a>                <span class="p">),</span>
</span><span id="SiTiCalculator.oetf_pu21-462"><a href="#SiTiCalculator.oetf_pu21-462"><span class="linenos">462</span></a>                <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span id="SiTiCalculator.oetf_pu21-463"><a href="#SiTiCalculator.oetf_pu21-463"><span class="linenos">463</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pu21-464"><a href="#SiTiCalculator.oetf_pu21-464"><span class="linenos">464</span></a>            <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="SiTiCalculator.oetf_pu21-465"><a href="#SiTiCalculator.oetf_pu21-465"><span class="linenos">465</span></a>        <span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pu21-466"><a href="#SiTiCalculator.oetf_pu21-466"><span class="linenos">466</span></a>
</span><span id="SiTiCalculator.oetf_pu21-467"><a href="#SiTiCalculator.oetf_pu21-467"><span class="linenos">467</span></a>        <span class="c1"># get the output into the range [0, 1]</span>
</span><span id="SiTiCalculator.oetf_pu21-468"><a href="#SiTiCalculator.oetf_pu21-468"><span class="linenos">468</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_max</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span>
</span><span id="SiTiCalculator.oetf_pu21-469"><a href="#SiTiCalculator.oetf_pu21-469"><span class="linenos">469</span></a>
</span><span id="SiTiCalculator.oetf_pu21-470"><a href="#SiTiCalculator.oetf_pu21-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span></pre></div>


            <div class="docstring"><p>PU21 OETF, see <a href="https://github.com/gfxdisp/pu21">https://github.com/gfxdisp/pu21</a></p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data (np.ndarray):</strong>  Raw frame data in full range, values in the range [0, 1]</li>
<li>mode (Pu21Mode), defaults to <a href="#Pu21Mode.BANDING">Pu21Mode.BANDING</a></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the range [0, 1]</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.eotf_hlg" class="classattr">
                                        <input id="SiTiCalculator.eotf_hlg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">eotf_hlg</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>,</span><span class="param">	<span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1000.0</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.eotf_hlg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.eotf_hlg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.eotf_hlg-472"><a href="#SiTiCalculator.eotf_hlg-472"><span class="linenos">472</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.eotf_hlg-473"><a href="#SiTiCalculator.eotf_hlg-473"><span class="linenos">473</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eotf_hlg</span><span class="p">(</span>
</span><span id="SiTiCalculator.eotf_hlg-474"><a href="#SiTiCalculator.eotf_hlg-474"><span class="linenos">474</span></a>        <span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_hlg-475"><a href="#SiTiCalculator.eotf_hlg-475"><span class="linenos">475</span></a>        <span class="n">l_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MIN_HDR</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_hlg-476"><a href="#SiTiCalculator.eotf_hlg-476"><span class="linenos">476</span></a>        <span class="n">l_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_L_MAX_HDR</span><span class="p">,</span>
</span><span id="SiTiCalculator.eotf_hlg-477"><a href="#SiTiCalculator.eotf_hlg-477"><span class="linenos">477</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_hlg-478"><a href="#SiTiCalculator.eotf_hlg-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_hlg-479"><a href="#SiTiCalculator.eotf_hlg-479"><span class="linenos">479</span></a><span class="sd">        Hybrid log-gamma opto-electrical transfer function defined in ITU-T Rec. BT.2100</span>
</span><span id="SiTiCalculator.eotf_hlg-480"><a href="#SiTiCalculator.eotf_hlg-480"><span class="linenos">480</span></a>
</span><span id="SiTiCalculator.eotf_hlg-481"><a href="#SiTiCalculator.eotf_hlg-481"><span class="linenos">481</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.eotf_hlg-482"><a href="#SiTiCalculator.eotf_hlg-482"><span class="linenos">482</span></a><span class="sd">            frame_data: pixel values expected to be in the range [0, 1]</span>
</span><span id="SiTiCalculator.eotf_hlg-483"><a href="#SiTiCalculator.eotf_hlg-483"><span class="linenos">483</span></a>
</span><span id="SiTiCalculator.eotf_hlg-484"><a href="#SiTiCalculator.eotf_hlg-484"><span class="linenos">484</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.eotf_hlg-485"><a href="#SiTiCalculator.eotf_hlg-485"><span class="linenos">485</span></a><span class="sd">            frame_data: pixel values in the physical luminance up to 10,000 cd/m^2</span>
</span><span id="SiTiCalculator.eotf_hlg-486"><a href="#SiTiCalculator.eotf_hlg-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.eotf_hlg-487"><a href="#SiTiCalculator.eotf_hlg-487"><span class="linenos">487</span></a>
</span><span id="SiTiCalculator.eotf_hlg-488"><a href="#SiTiCalculator.eotf_hlg-488"><span class="linenos">488</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.17883277</span>
</span><span id="SiTiCalculator.eotf_hlg-489"><a href="#SiTiCalculator.eotf_hlg-489"><span class="linenos">489</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.02372241</span>
</span><span id="SiTiCalculator.eotf_hlg-490"><a href="#SiTiCalculator.eotf_hlg-490"><span class="linenos">490</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="mf">1.00429347</span>
</span><span id="SiTiCalculator.eotf_hlg-491"><a href="#SiTiCalculator.eotf_hlg-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="n">l_max</span> <span class="o">&lt;=</span> <span class="mf">1000.0</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_hlg-492"><a href="#SiTiCalculator.eotf_hlg-492"><span class="linenos">492</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span>
</span><span id="SiTiCalculator.eotf_hlg-493"><a href="#SiTiCalculator.eotf_hlg-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.eotf_hlg-494"><a href="#SiTiCalculator.eotf_hlg-494"><span class="linenos">494</span></a>            <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">+</span> <span class="mf">0.42</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">l_max</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_hlg-495"><a href="#SiTiCalculator.eotf_hlg-495"><span class="linenos">495</span></a>
</span><span id="SiTiCalculator.eotf_hlg-496"><a href="#SiTiCalculator.eotf_hlg-496"><span class="linenos">496</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="SiTiCalculator.eotf_hlg-497"><a href="#SiTiCalculator.eotf_hlg-497"><span class="linenos">497</span></a>            <span class="n">frame_data</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
</span><span id="SiTiCalculator.eotf_hlg-498"><a href="#SiTiCalculator.eotf_hlg-498"><span class="linenos">498</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="SiTiCalculator.eotf_hlg-499"><a href="#SiTiCalculator.eotf_hlg-499"><span class="linenos">499</span></a>
</span><span id="SiTiCalculator.eotf_hlg-500"><a href="#SiTiCalculator.eotf_hlg-500"><span class="linenos">500</span></a>        <span class="c1"># NOTE: The following is only valid when the function is applied to the Y channel.</span>
</span><span id="SiTiCalculator.eotf_hlg-501"><a href="#SiTiCalculator.eotf_hlg-501"><span class="linenos">501</span></a>        <span class="c1"># If frame_data was a color channel (R, G, or B), the correct implementation would be:</span>
</span><span id="SiTiCalculator.eotf_hlg-502"><a href="#SiTiCalculator.eotf_hlg-502"><span class="linenos">502</span></a>        <span class="c1"># (l_max - l_min) * np.power(Y, gamma - 1.0) * frame_data + l_min,</span>
</span><span id="SiTiCalculator.eotf_hlg-503"><a href="#SiTiCalculator.eotf_hlg-503"><span class="linenos">503</span></a>        <span class="c1"># where Y would be obtained from linearized R, G, B channels.</span>
</span><span id="SiTiCalculator.eotf_hlg-504"><a href="#SiTiCalculator.eotf_hlg-504"><span class="linenos">504</span></a>        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_max</span> <span class="o">-</span> <span class="n">l_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">l_min</span>
</span><span id="SiTiCalculator.eotf_hlg-505"><a href="#SiTiCalculator.eotf_hlg-505"><span class="linenos">505</span></a>
</span><span id="SiTiCalculator.eotf_hlg-506"><a href="#SiTiCalculator.eotf_hlg-506"><span class="linenos">506</span></a>        <span class="k">return</span> <span class="n">frame_data</span>
</span></pre></div>


            <div class="docstring"><p>Hybrid log-gamma opto-electrical transfer function defined in ITU-T Rec. BT.2100</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>frame_data:</strong>  pixel values expected to be in the range [0, 1]</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>frame_data: pixel values in the physical luminance up to 10,000 cd/m^2</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.normalize_to_original_range" class="classattr">
                                        <input id="SiTiCalculator.normalize_to_original_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_to_original_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SiTiCalculator.normalize_to_original_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.normalize_to_original_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.normalize_to_original_range-508"><a href="#SiTiCalculator.normalize_to_original_range-508"><span class="linenos">508</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator.normalize_to_original_range-509"><a href="#SiTiCalculator.normalize_to_original_range-509"><span class="linenos">509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_to_original_range-510"><a href="#SiTiCalculator.normalize_to_original_range-510"><span class="linenos">510</span></a><span class="sd">        Normalize frame data in the range [0, 1] to their original range, based on</span>
</span><span id="SiTiCalculator.normalize_to_original_range-511"><a href="#SiTiCalculator.normalize_to_original_range-511"><span class="linenos">511</span></a><span class="sd">        bit depth, e.g. from [0, 1] to [0, 255].</span>
</span><span id="SiTiCalculator.normalize_to_original_range-512"><a href="#SiTiCalculator.normalize_to_original_range-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_to_original_range-513"><a href="#SiTiCalculator.normalize_to_original_range-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Normalize frame data in the range [0, 1] to their original range, based on
bit depth, e.g. from [0, 1] to [0, 255].</p>
</div>


                            </div>
                            <div id="SiTiCalculator.normalize_to_original_si_range" class="classattr">
                                        <input id="SiTiCalculator.normalize_to_original_si_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_to_original_si_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SiTiCalculator.normalize_to_original_si_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.normalize_to_original_si_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.normalize_to_original_si_range-515"><a href="#SiTiCalculator.normalize_to_original_si_range-515"><span class="linenos">515</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_to_original_si_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator.normalize_to_original_si_range-516"><a href="#SiTiCalculator.normalize_to_original_si_range-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_to_original_si_range-517"><a href="#SiTiCalculator.normalize_to_original_si_range-517"><span class="linenos">517</span></a><span class="sd">        Normalize frame data in the range [0, 1] to [0, 255], which was the original</span>
</span><span id="SiTiCalculator.normalize_to_original_si_range-518"><a href="#SiTiCalculator.normalize_to_original_si_range-518"><span class="linenos">518</span></a><span class="sd">        range for SI/TI.</span>
</span><span id="SiTiCalculator.normalize_to_original_si_range-519"><a href="#SiTiCalculator.normalize_to_original_si_range-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_to_original_si_range-520"><a href="#SiTiCalculator.normalize_to_original_si_range-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">frame_data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Normalize frame data in the range [0, 1] to [0, 255], which was the original
range for SI/TI.</p>
</div>


                            </div>
                            <div id="SiTiCalculator.normalize_between_0_1" class="classattr">
                                        <input id="SiTiCalculator.normalize_between_0_1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_between_0_1</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SiTiCalculator.normalize_between_0_1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.normalize_between_0_1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.normalize_between_0_1-522"><a href="#SiTiCalculator.normalize_between_0_1-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_between_0_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="SiTiCalculator.normalize_between_0_1-523"><a href="#SiTiCalculator.normalize_between_0_1-523"><span class="linenos">523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-524"><a href="#SiTiCalculator.normalize_between_0_1-524"><span class="linenos">524</span></a><span class="sd">        Normalize frame data in the range [0, x] to [0, 1], based on bit depth and color range.</span>
</span><span id="SiTiCalculator.normalize_between_0_1-525"><a href="#SiTiCalculator.normalize_between_0_1-525"><span class="linenos">525</span></a><span class="sd">        For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="SiTiCalculator.normalize_between_0_1-526"><a href="#SiTiCalculator.normalize_between_0_1-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-527"><a href="#SiTiCalculator.normalize_between_0_1-527"><span class="linenos">527</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_range</span> <span class="o">==</span> <span class="n">ColorRange</span><span class="o">.</span><span class="n">LIMITED</span><span class="p">:</span>
</span><span id="SiTiCalculator.normalize_between_0_1-528"><a href="#SiTiCalculator.normalize_between_0_1-528"><span class="linenos">528</span></a>            <span class="c1"># Get the limited range values for the current bit depth</span>
</span><span id="SiTiCalculator.normalize_between_0_1-529"><a href="#SiTiCalculator.normalize_between_0_1-529"><span class="linenos">529</span></a>            <span class="n">limited_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
</span><span id="SiTiCalculator.normalize_between_0_1-530"><a href="#SiTiCalculator.normalize_between_0_1-530"><span class="linenos">530</span></a>            <span class="n">limited_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIMITED_RANGE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span>
</span><span id="SiTiCalculator.normalize_between_0_1-531"><a href="#SiTiCalculator.normalize_between_0_1-531"><span class="linenos">531</span></a>
</span><span id="SiTiCalculator.normalize_between_0_1-532"><a href="#SiTiCalculator.normalize_between_0_1-532"><span class="linenos">532</span></a>            <span class="c1"># Check if input is within expected limited range</span>
</span><span id="SiTiCalculator.normalize_between_0_1-533"><a href="#SiTiCalculator.normalize_between_0_1-533"><span class="linenos">533</span></a>            <span class="n">input_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.normalize_between_0_1-534"><a href="#SiTiCalculator.normalize_between_0_1-534"><span class="linenos">534</span></a>            <span class="n">input_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.normalize_between_0_1-535"><a href="#SiTiCalculator.normalize_between_0_1-535"><span class="linenos">535</span></a>
</span><span id="SiTiCalculator.normalize_between_0_1-536"><a href="#SiTiCalculator.normalize_between_0_1-536"><span class="linenos">536</span></a>            <span class="c1"># Provide a warning if values are outside limited range</span>
</span><span id="SiTiCalculator.normalize_between_0_1-537"><a href="#SiTiCalculator.normalize_between_0_1-537"><span class="linenos">537</span></a>            <span class="k">if</span> <span class="n">input_min</span> <span class="o">&lt;</span> <span class="n">limited_min</span> <span class="ow">or</span> <span class="n">input_max</span> <span class="o">&gt;</span> <span class="n">limited_max</span><span class="p">:</span>
</span><span id="SiTiCalculator.normalize_between_0_1-538"><a href="#SiTiCalculator.normalize_between_0_1-538"><span class="linenos">538</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="SiTiCalculator.normalize_between_0_1-539"><a href="#SiTiCalculator.normalize_between_0_1-539"><span class="linenos">539</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input appears to be full range, but it is treated as limited range! &quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-540"><a href="#SiTiCalculator.normalize_between_0_1-540"><span class="linenos">540</span></a>                    <span class="sa">f</span><span class="s2">&quot;Input range is [</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_min</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">input_max</span><span class="p">)</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-541"><a href="#SiTiCalculator.normalize_between_0_1-541"><span class="linenos">541</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected range for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span><span class="si">}</span><span class="s2">-bit limited content [</span><span class="si">{</span><span class="n">limited_min</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">limited_max</span><span class="si">}</span><span class="s2">]. &quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-542"><a href="#SiTiCalculator.normalize_between_0_1-542"><span class="linenos">542</span></a>                    <span class="s2">&quot;Specify the range as full instead.&quot;</span>
</span><span id="SiTiCalculator.normalize_between_0_1-543"><a href="#SiTiCalculator.normalize_between_0_1-543"><span class="linenos">543</span></a>                <span class="p">)</span>
</span><span id="SiTiCalculator.normalize_between_0_1-544"><a href="#SiTiCalculator.normalize_between_0_1-544"><span class="linenos">544</span></a>
</span><span id="SiTiCalculator.normalize_between_0_1-545"><a href="#SiTiCalculator.normalize_between_0_1-545"><span class="linenos">545</span></a>            <span class="c1"># Normalize from limited range directly to [0, 1]</span>
</span><span id="SiTiCalculator.normalize_between_0_1-546"><a href="#SiTiCalculator.normalize_between_0_1-546"><span class="linenos">546</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">frame_data</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">limited_max</span> <span class="o">-</span> <span class="n">limited_min</span><span class="p">)</span>
</span><span id="SiTiCalculator.normalize_between_0_1-547"><a href="#SiTiCalculator.normalize_between_0_1-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.normalize_between_0_1-548"><a href="#SiTiCalculator.normalize_between_0_1-548"><span class="linenos">548</span></a>            <span class="c1"># Full range: normalize from [0, 2^bit_depth - 1] to [0, 1]</span>
</span><span id="SiTiCalculator.normalize_between_0_1-549"><a href="#SiTiCalculator.normalize_between_0_1-549"><span class="linenos">549</span></a>            <span class="k">return</span> <span class="n">frame_data</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Normalize frame data in the range [0, x] to [0, 1], based on bit depth and color range.
For limited range, this directly converts from limited range values to [0, 1].</p>
</div>


                            </div>
                            <div id="SiTiCalculator.add_frame_callback" class="classattr">
                                        <input id="SiTiCalculator.add_frame_callback-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_frame_callback</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">callback_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SiTiCalculator.add_frame_callback-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.add_frame_callback"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.add_frame_callback-551"><a href="#SiTiCalculator.add_frame_callback-551"><span class="linenos">551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_frame_callback</span><span class="p">(</span>
</span><span id="SiTiCalculator.add_frame_callback-552"><a href="#SiTiCalculator.add_frame_callback-552"><span class="linenos">552</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">callback_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="SiTiCalculator.add_frame_callback-553"><a href="#SiTiCalculator.add_frame_callback-553"><span class="linenos">553</span></a>    <span class="p">):</span>
</span><span id="SiTiCalculator.add_frame_callback-554"><a href="#SiTiCalculator.add_frame_callback-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a function that gets called whenever a frame&#39;s values are available</span>
</span><span id="SiTiCalculator.add_frame_callback-555"><a href="#SiTiCalculator.add_frame_callback-555"><span class="linenos">555</span></a>
</span><span id="SiTiCalculator.add_frame_callback-556"><a href="#SiTiCalculator.add_frame_callback-556"><span class="linenos">556</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.add_frame_callback-557"><a href="#SiTiCalculator.add_frame_callback-557"><span class="linenos">557</span></a><span class="sd">            callback_fn (Callable[[float, Union[float, None], int], None]): The function that should get called. It will receive SI, TI and the frame number.</span>
</span><span id="SiTiCalculator.add_frame_callback-558"><a href="#SiTiCalculator.add_frame_callback-558"><span class="linenos">558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.add_frame_callback-559"><a href="#SiTiCalculator.add_frame_callback-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback_fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a function that gets called whenever a frame's values are available</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>callback_fn (Callable[[float, Union[float, None], int], None]):</strong>  The function that should get called. It will receive SI, TI and the frame number.</li>
</ul>
</div>


                            </div>
                            <div id="SiTiCalculator.plot_histogram" class="classattr">
                                        <input id="SiTiCalculator.plot_histogram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">plot_histogram</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">frame_data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.plot_histogram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.plot_histogram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.plot_histogram-561"><a href="#SiTiCalculator.plot_histogram-561"><span class="linenos">561</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SiTiCalculator.plot_histogram-562"><a href="#SiTiCalculator.plot_histogram-562"><span class="linenos">562</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span><span class="n">frame_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SiTiCalculator.plot_histogram-563"><a href="#SiTiCalculator.plot_histogram-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="n">plotille</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
</span><span id="SiTiCalculator.plot_histogram-564"><a href="#SiTiCalculator.plot_histogram-564"><span class="linenos">564</span></a>            <span class="n">frame_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="mi">0</span>
</span><span id="SiTiCalculator.plot_histogram-565"><a href="#SiTiCalculator.plot_histogram-565"><span class="linenos">565</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SiTiCalculator.calculate" class="classattr">
                                        <input id="SiTiCalculator.calculate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.calculate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.calculate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.calculate-567"><a href="#SiTiCalculator.calculate-567"><span class="linenos">567</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-568"><a href="#SiTiCalculator.calculate-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-569"><a href="#SiTiCalculator.calculate-569"><span class="linenos">569</span></a>        <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-570"><a href="#SiTiCalculator.calculate-570"><span class="linenos">570</span></a>        <span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-571"><a href="#SiTiCalculator.calculate-571"><span class="linenos">571</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="SiTiCalculator.calculate-572"><a href="#SiTiCalculator.calculate-572"><span class="linenos">572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SI and TI from an input file.</span>
</span><span id="SiTiCalculator.calculate-573"><a href="#SiTiCalculator.calculate-573"><span class="linenos">573</span></a>
</span><span id="SiTiCalculator.calculate-574"><a href="#SiTiCalculator.calculate-574"><span class="linenos">574</span></a><span class="sd">        Returns two arrays and one integer, the first array being the SI values, the</span>
</span><span id="SiTiCalculator.calculate-575"><a href="#SiTiCalculator.calculate-575"><span class="linenos">575</span></a><span class="sd">        second array being the TI values. The first element of the TI value array will</span>
</span><span id="SiTiCalculator.calculate-576"><a href="#SiTiCalculator.calculate-576"><span class="linenos">576</span></a><span class="sd">        always be 0. The integer will be equal to the number of frames read.</span>
</span><span id="SiTiCalculator.calculate-577"><a href="#SiTiCalculator.calculate-577"><span class="linenos">577</span></a>
</span><span id="SiTiCalculator.calculate-578"><a href="#SiTiCalculator.calculate-578"><span class="linenos">578</span></a><span class="sd">        You can also get the results later via .get_results()</span>
</span><span id="SiTiCalculator.calculate-579"><a href="#SiTiCalculator.calculate-579"><span class="linenos">579</span></a>
</span><span id="SiTiCalculator.calculate-580"><a href="#SiTiCalculator.calculate-580"><span class="linenos">580</span></a><span class="sd">        Args:</span>
</span><span id="SiTiCalculator.calculate-581"><a href="#SiTiCalculator.calculate-581"><span class="linenos">581</span></a><span class="sd">            input_file (str): input file path</span>
</span><span id="SiTiCalculator.calculate-582"><a href="#SiTiCalculator.calculate-582"><span class="linenos">582</span></a><span class="sd">            num_frames (int): number of frames to calculate. Defaults to 0 (unlimited).</span>
</span><span id="SiTiCalculator.calculate-583"><a href="#SiTiCalculator.calculate-583"><span class="linenos">583</span></a>
</span><span id="SiTiCalculator.calculate-584"><a href="#SiTiCalculator.calculate-584"><span class="linenos">584</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.calculate-585"><a href="#SiTiCalculator.calculate-585"><span class="linenos">585</span></a><span class="sd">            [[float], [float|None], int]: [si_values], [ti_values], frame count</span>
</span><span id="SiTiCalculator.calculate-586"><a href="#SiTiCalculator.calculate-586"><span class="linenos">586</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.calculate-587"><a href="#SiTiCalculator.calculate-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator.calculate-588"><a href="#SiTiCalculator.calculate-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SiTiCalculator.calculate-589"><a href="#SiTiCalculator.calculate-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="o">=</span> <span class="n">input_file</span>
</span><span id="SiTiCalculator.calculate-590"><a href="#SiTiCalculator.calculate-590"><span class="linenos">590</span></a>        <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SiTiCalculator.calculate-591"><a href="#SiTiCalculator.calculate-591"><span class="linenos">591</span></a>
</span><span id="SiTiCalculator.calculate-592"><a href="#SiTiCalculator.calculate-592"><span class="linenos">592</span></a>        <span class="n">current_frame</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SiTiCalculator.calculate-593"><a href="#SiTiCalculator.calculate-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">frame_data</span> <span class="ow">in</span> <span class="n">read_container</span><span class="p">(</span><span class="n">input_file</span><span class="p">):</span>
</span><span id="SiTiCalculator.calculate-594"><a href="#SiTiCalculator.calculate-594"><span class="linenos">594</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">current_frame</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-595"><a href="#SiTiCalculator.calculate-595"><span class="linenos">595</span></a>
</span><span id="SiTiCalculator.calculate-596"><a href="#SiTiCalculator.calculate-596"><span class="linenos">596</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-597"><a href="#SiTiCalculator.calculate-597"><span class="linenos">597</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Original frame data&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-598"><a href="#SiTiCalculator.calculate-598"><span class="linenos">598</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-599"><a href="#SiTiCalculator.calculate-599"><span class="linenos">599</span></a>
</span><span id="SiTiCalculator.calculate-600"><a href="#SiTiCalculator.calculate-600"><span class="linenos">600</span></a>            <span class="c1"># Normalize frame data according to bit depth between 0 and 1.</span>
</span><span id="SiTiCalculator.calculate-601"><a href="#SiTiCalculator.calculate-601"><span class="linenos">601</span></a>            <span class="c1"># This will transform [0, 255] to [0, 1], and [0, 1023] to [0, 1] etc.</span>
</span><span id="SiTiCalculator.calculate-602"><a href="#SiTiCalculator.calculate-602"><span class="linenos">602</span></a>            <span class="c1"># For limited range, this directly converts from limited range values to [0, 1].</span>
</span><span id="SiTiCalculator.calculate-603"><a href="#SiTiCalculator.calculate-603"><span class="linenos">603</span></a>            <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_between_0_1</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-604"><a href="#SiTiCalculator.calculate-604"><span class="linenos">604</span></a>
</span><span id="SiTiCalculator.calculate-605"><a href="#SiTiCalculator.calculate-605"><span class="linenos">605</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-606"><a href="#SiTiCalculator.calculate-606"><span class="linenos">606</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Frame data after normalization between 0 and 1&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-607"><a href="#SiTiCalculator.calculate-607"><span class="linenos">607</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-608"><a href="#SiTiCalculator.calculate-608"><span class="linenos">608</span></a>
</span><span id="SiTiCalculator.calculate-609"><a href="#SiTiCalculator.calculate-609"><span class="linenos">609</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-610"><a href="#SiTiCalculator.calculate-610"><span class="linenos">610</span></a>                <span class="c1"># in legacy mode we&#39;ll compute the values directly in the SDR domain</span>
</span><span id="SiTiCalculator.calculate-611"><a href="#SiTiCalculator.calculate-611"><span class="linenos">611</span></a>                <span class="k">pass</span>
</span><span id="SiTiCalculator.calculate-612"><a href="#SiTiCalculator.calculate-612"><span class="linenos">612</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-613"><a href="#SiTiCalculator.calculate-613"><span class="linenos">613</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">SDR</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-614"><a href="#SiTiCalculator.calculate-614"><span class="linenos">614</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">apply_display_model</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-615"><a href="#SiTiCalculator.calculate-615"><span class="linenos">615</span></a>                        <span class="n">frame_data</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-616"><a href="#SiTiCalculator.calculate-616"><span class="linenos">616</span></a>                        <span class="n">eotf_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eotf_function</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-617"><a href="#SiTiCalculator.calculate-617"><span class="linenos">617</span></a>                        <span class="n">l_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-618"><a href="#SiTiCalculator.calculate-618"><span class="linenos">618</span></a>                        <span class="n">l_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-619"><a href="#SiTiCalculator.calculate-619"><span class="linenos">619</span></a>                        <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="SiTiCalculator.calculate-620"><a href="#SiTiCalculator.calculate-620"><span class="linenos">620</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-621"><a href="#SiTiCalculator.calculate-621"><span class="linenos">621</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-622"><a href="#SiTiCalculator.calculate-622"><span class="linenos">622</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-623"><a href="#SiTiCalculator.calculate-623"><span class="linenos">623</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after apply_display_model for SDR (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="SiTiCalculator.calculate-624"><a href="#SiTiCalculator.calculate-624"><span class="linenos">624</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-625"><a href="#SiTiCalculator.calculate-625"><span class="linenos">625</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-626"><a href="#SiTiCalculator.calculate-626"><span class="linenos">626</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-627"><a href="#SiTiCalculator.calculate-627"><span class="linenos">627</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="SiTiCalculator.calculate-628"><a href="#SiTiCalculator.calculate-628"><span class="linenos">628</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-629"><a href="#SiTiCalculator.calculate-629"><span class="linenos">629</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-630"><a href="#SiTiCalculator.calculate-630"><span class="linenos">630</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-631"><a href="#SiTiCalculator.calculate-631"><span class="linenos">631</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator.calculate-632"><a href="#SiTiCalculator.calculate-632"><span class="linenos">632</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-633"><a href="#SiTiCalculator.calculate-633"><span class="linenos">633</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-634"><a href="#SiTiCalculator.calculate-634"><span class="linenos">634</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HDR10</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-635"><a href="#SiTiCalculator.calculate-635"><span class="linenos">635</span></a>                    <span class="c1"># nothing to do, we are already in PQ domain</span>
</span><span id="SiTiCalculator.calculate-636"><a href="#SiTiCalculator.calculate-636"><span class="linenos">636</span></a>                    <span class="c1"># TODO allow using Pu21 here?</span>
</span><span id="SiTiCalculator.calculate-637"><a href="#SiTiCalculator.calculate-637"><span class="linenos">637</span></a>                    <span class="k">pass</span>
</span><span id="SiTiCalculator.calculate-638"><a href="#SiTiCalculator.calculate-638"><span class="linenos">638</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span> <span class="o">==</span> <span class="n">HdrMode</span><span class="o">.</span><span class="n">HLG</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-639"><a href="#SiTiCalculator.calculate-639"><span class="linenos">639</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">eotf_hlg</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-640"><a href="#SiTiCalculator.calculate-640"><span class="linenos">640</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_max</span>
</span><span id="SiTiCalculator.calculate-641"><a href="#SiTiCalculator.calculate-641"><span class="linenos">641</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-642"><a href="#SiTiCalculator.calculate-642"><span class="linenos">642</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-643"><a href="#SiTiCalculator.calculate-643"><span class="linenos">643</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-644"><a href="#SiTiCalculator.calculate-644"><span class="linenos">644</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after eotf_hlg for HLG with l_min/l_max settings </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">l_min</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator.calculate-645"><a href="#SiTiCalculator.calculate-645"><span class="linenos">645</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-646"><a href="#SiTiCalculator.calculate-646"><span class="linenos">646</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-647"><a href="#SiTiCalculator.calculate-647"><span class="linenos">647</span></a>                    <span class="n">frame_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-648"><a href="#SiTiCalculator.calculate-648"><span class="linenos">648</span></a>                        <span class="n">frame_data</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span>
</span><span id="SiTiCalculator.calculate-649"><a href="#SiTiCalculator.calculate-649"><span class="linenos">649</span></a>                    <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-650"><a href="#SiTiCalculator.calculate-650"><span class="linenos">650</span></a>                    <span class="k">if</span> <span class="n">current_frame</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-651"><a href="#SiTiCalculator.calculate-651"><span class="linenos">651</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-652"><a href="#SiTiCalculator.calculate-652"><span class="linenos">652</span></a>                            <span class="sa">f</span><span class="s2">&quot;Frame data after OETF function </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function</span><span class="si">}</span><span class="s2"> with args </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oetf_function_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SiTiCalculator.calculate-653"><a href="#SiTiCalculator.calculate-653"><span class="linenos">653</span></a>                        <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-654"><a href="#SiTiCalculator.calculate-654"><span class="linenos">654</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_frame_data</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-655"><a href="#SiTiCalculator.calculate-655"><span class="linenos">655</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-656"><a href="#SiTiCalculator.calculate-656"><span class="linenos">656</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid HDR mode &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hdr_mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-657"><a href="#SiTiCalculator.calculate-657"><span class="linenos">657</span></a>
</span><span id="SiTiCalculator.calculate-658"><a href="#SiTiCalculator.calculate-658"><span class="linenos">658</span></a>            <span class="n">si_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-659"><a href="#SiTiCalculator.calculate-659"><span class="linenos">659</span></a>                <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">frame_data</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-660"><a href="#SiTiCalculator.calculate-660"><span class="linenos">660</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-661"><a href="#SiTiCalculator.calculate-661"><span class="linenos">661</span></a>
</span><span id="SiTiCalculator.calculate-662"><a href="#SiTiCalculator.calculate-662"><span class="linenos">662</span></a>            <span class="k">if</span> <span class="n">current_frame</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-663"><a href="#SiTiCalculator.calculate-663"><span class="linenos">663</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_to_original_si_range</span><span class="p">(</span>
</span><span id="SiTiCalculator.calculate-664"><a href="#SiTiCalculator.calculate-664"><span class="linenos">664</span></a>                    <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">SiTiCalculator</span><span class="o">.</span><span class="n">ti</span><span class="p">(</span><span class="n">frame_data</span><span class="p">,</span> <span class="n">previous_frame_data</span><span class="p">))</span>
</span><span id="SiTiCalculator.calculate-665"><a href="#SiTiCalculator.calculate-665"><span class="linenos">665</span></a>                <span class="p">)</span>
</span><span id="SiTiCalculator.calculate-666"><a href="#SiTiCalculator.calculate-666"><span class="linenos">666</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-667"><a href="#SiTiCalculator.calculate-667"><span class="linenos">667</span></a>                <span class="n">ti_value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SiTiCalculator.calculate-668"><a href="#SiTiCalculator.calculate-668"><span class="linenos">668</span></a>
</span><span id="SiTiCalculator.calculate-669"><a href="#SiTiCalculator.calculate-669"><span class="linenos">669</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-670"><a href="#SiTiCalculator.calculate-670"><span class="linenos">670</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-671"><a href="#SiTiCalculator.calculate-671"><span class="linenos">671</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TI value </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-672"><a href="#SiTiCalculator.calculate-672"><span class="linenos">672</span></a>
</span><span id="SiTiCalculator.calculate-673"><a href="#SiTiCalculator.calculate-673"><span class="linenos">673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">si_value</span><span class="p">))</span>
</span><span id="SiTiCalculator.calculate-674"><a href="#SiTiCalculator.calculate-674"><span class="linenos">674</span></a>            <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-675"><a href="#SiTiCalculator.calculate-675"><span class="linenos">675</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">))</span>
</span><span id="SiTiCalculator.calculate-676"><a href="#SiTiCalculator.calculate-676"><span class="linenos">676</span></a>
</span><span id="SiTiCalculator.calculate-677"><a href="#SiTiCalculator.calculate-677"><span class="linenos">677</span></a>            <span class="n">previous_frame_data</span> <span class="o">=</span> <span class="n">frame_data</span>
</span><span id="SiTiCalculator.calculate-678"><a href="#SiTiCalculator.calculate-678"><span class="linenos">678</span></a>
</span><span id="SiTiCalculator.calculate-679"><a href="#SiTiCalculator.calculate-679"><span class="linenos">679</span></a>            <span class="n">current_frame</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SiTiCalculator.calculate-680"><a href="#SiTiCalculator.calculate-680"><span class="linenos">680</span></a>
</span><span id="SiTiCalculator.calculate-681"><a href="#SiTiCalculator.calculate-681"><span class="linenos">681</span></a>            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-682"><a href="#SiTiCalculator.calculate-682"><span class="linenos">682</span></a>                <span class="n">callback</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">,</span> <span class="n">current_frame</span><span class="p">)</span>
</span><span id="SiTiCalculator.calculate-683"><a href="#SiTiCalculator.calculate-683"><span class="linenos">683</span></a>
</span><span id="SiTiCalculator.calculate-684"><a href="#SiTiCalculator.calculate-684"><span class="linenos">684</span></a>            <span class="k">if</span> <span class="n">num_frames</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">current_frame</span> <span class="o">&gt;=</span> <span class="n">num_frames</span><span class="p">:</span>
</span><span id="SiTiCalculator.calculate-685"><a href="#SiTiCalculator.calculate-685"><span class="linenos">685</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span><span id="SiTiCalculator.calculate-686"><a href="#SiTiCalculator.calculate-686"><span class="linenos">686</span></a>
</span><span id="SiTiCalculator.calculate-687"><a href="#SiTiCalculator.calculate-687"><span class="linenos">687</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span> <span class="n">current_frame</span>
</span></pre></div>


            <div class="docstring"><p>Calculate SI and TI from an input file.</p>

<p>Returns two arrays and one integer, the first array being the SI values, the
second array being the TI values. The first element of the TI value array will
always be 0. The integer will be equal to the number of frames read.</p>

<p>You can also get the results later via .get_results()</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>input_file (str):</strong>  input file path</li>
<li><strong>num_frames (int):</strong>  number of frames to calculate. Defaults to 0 (unlimited).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>[[float], [float|None], int]: [si_values], [ti_values], frame count</p>
</blockquote>
</div>


                            </div>
                            <div id="SiTiCalculator.get_csv_results" class="classattr">
                                        <input id="SiTiCalculator.get_csv_results-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_csv_results</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.get_csv_results-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.get_csv_results"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.get_csv_results-689"><a href="#SiTiCalculator.get_csv_results-689"><span class="linenos">689</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_csv_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SiTiCalculator.get_csv_results-690"><a href="#SiTiCalculator.get_csv_results-690"><span class="linenos">690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_csv_results-691"><a href="#SiTiCalculator.get_csv_results-691"><span class="linenos">691</span></a><span class="sd">        Return a CSV string with the results.</span>
</span><span id="SiTiCalculator.get_csv_results-692"><a href="#SiTiCalculator.get_csv_results-692"><span class="linenos">692</span></a>
</span><span id="SiTiCalculator.get_csv_results-693"><a href="#SiTiCalculator.get_csv_results-693"><span class="linenos">693</span></a><span class="sd">        Note that this does not output all data. Also, the first TI value will be output as &quot;None&quot;.</span>
</span><span id="SiTiCalculator.get_csv_results-694"><a href="#SiTiCalculator.get_csv_results-694"><span class="linenos">694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_csv_results-695"><a href="#SiTiCalculator.get_csv_results-695"><span class="linenos">695</span></a>        <span class="c1"># prepend a zero here</span>
</span><span id="SiTiCalculator.get_csv_results-696"><a href="#SiTiCalculator.get_csv_results-696"><span class="linenos">696</span></a>        <span class="n">ti_values_to_output</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">]</span>
</span><span id="SiTiCalculator.get_csv_results-697"><a href="#SiTiCalculator.get_csv_results-697"><span class="linenos">697</span></a>
</span><span id="SiTiCalculator.get_csv_results-698"><a href="#SiTiCalculator.get_csv_results-698"><span class="linenos">698</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</span><span id="SiTiCalculator.get_csv_results-699"><a href="#SiTiCalculator.get_csv_results-699"><span class="linenos">699</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input_file&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;ti&quot;</span><span class="p">])</span>
</span><span id="SiTiCalculator.get_csv_results-700"><a href="#SiTiCalculator.get_csv_results-700"><span class="linenos">700</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="SiTiCalculator.get_csv_results-701"><a href="#SiTiCalculator.get_csv_results-701"><span class="linenos">701</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="n">ti_value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="SiTiCalculator.get_csv_results-702"><a href="#SiTiCalculator.get_csv_results-702"><span class="linenos">702</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span> <span class="n">ti_values_to_output</span><span class="p">)</span>
</span><span id="SiTiCalculator.get_csv_results-703"><a href="#SiTiCalculator.get_csv_results-703"><span class="linenos">703</span></a>        <span class="p">):</span>
</span><span id="SiTiCalculator.get_csv_results-704"><a href="#SiTiCalculator.get_csv_results-704"><span class="linenos">704</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span>
</span><span id="SiTiCalculator.get_csv_results-705"><a href="#SiTiCalculator.get_csv_results-705"><span class="linenos">705</span></a>                <span class="p">{</span>
</span><span id="SiTiCalculator.get_csv_results-706"><a href="#SiTiCalculator.get_csv_results-706"><span class="linenos">706</span></a>                    <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="SiTiCalculator.get_csv_results-707"><a href="#SiTiCalculator.get_csv_results-707"><span class="linenos">707</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SiTiCalculator.get_csv_results-708"><a href="#SiTiCalculator.get_csv_results-708"><span class="linenos">708</span></a>                    <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_csv_results-709"><a href="#SiTiCalculator.get_csv_results-709"><span class="linenos">709</span></a>                    <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_csv_results-710"><a href="#SiTiCalculator.get_csv_results-710"><span class="linenos">710</span></a>                    <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">si_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="SiTiCalculator.get_csv_results-711"><a href="#SiTiCalculator.get_csv_results-711"><span class="linenos">711</span></a>                    <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ti_value</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">ti_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_csv_results-712"><a href="#SiTiCalculator.get_csv_results-712"><span class="linenos">712</span></a>                <span class="p">}</span>
</span><span id="SiTiCalculator.get_csv_results-713"><a href="#SiTiCalculator.get_csv_results-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="SiTiCalculator.get_csv_results-714"><a href="#SiTiCalculator.get_csv_results-714"><span class="linenos">714</span></a>        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Return a CSV string with the results.</p>

<p>Note that this does not output all data. Also, the first TI value will be output as "None".</p>
</div>


                            </div>
                            <div id="SiTiCalculator.get_results" class="classattr">
                                        <input id="SiTiCalculator.get_results-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="SiTiCalculator.get_results-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SiTiCalculator.get_results"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SiTiCalculator.get_results-716"><a href="#SiTiCalculator.get_results-716"><span class="linenos">716</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SiTiCalculator.get_results-717"><a href="#SiTiCalculator.get_results-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_results-718"><a href="#SiTiCalculator.get_results-718"><span class="linenos">718</span></a><span class="sd">        Get a JSON-serializable result dictionary with SI, TI values, as well as used settings.</span>
</span><span id="SiTiCalculator.get_results-719"><a href="#SiTiCalculator.get_results-719"><span class="linenos">719</span></a>
</span><span id="SiTiCalculator.get_results-720"><a href="#SiTiCalculator.get_results-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="SiTiCalculator.get_results-721"><a href="#SiTiCalculator.get_results-721"><span class="linenos">721</span></a><span class="sd">            dict: A dictionary containing &quot;si&quot;, &quot;ti&quot; arrays, &quot;settings&quot; as a dict, and the &quot;input_file&quot; name.</span>
</span><span id="SiTiCalculator.get_results-722"><a href="#SiTiCalculator.get_results-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SiTiCalculator.get_results-723"><a href="#SiTiCalculator.get_results-723"><span class="linenos">723</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="SiTiCalculator.get_results-724"><a href="#SiTiCalculator.get_results-724"><span class="linenos">724</span></a>            <span class="s2">&quot;si&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">si_values</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_results-725"><a href="#SiTiCalculator.get_results-725"><span class="linenos">725</span></a>            <span class="s2">&quot;ti&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ti_values</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_results-726"><a href="#SiTiCalculator.get_results-726"><span class="linenos">726</span></a>            <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_general_settings</span><span class="p">(),</span>
</span><span id="SiTiCalculator.get_results-727"><a href="#SiTiCalculator.get_results-727"><span class="linenos">727</span></a>            <span class="s2">&quot;input_file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span><span class="p">)</span>
</span><span id="SiTiCalculator.get_results-728"><a href="#SiTiCalculator.get_results-728"><span class="linenos">728</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_input_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SiTiCalculator.get_results-729"><a href="#SiTiCalculator.get_results-729"><span class="linenos">729</span></a>            <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="SiTiCalculator.get_results-730"><a href="#SiTiCalculator.get_results-730"><span class="linenos">730</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get a JSON-serializable result dictionary with SI, TI values, as well as used settings.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing "si", "ti" arrays, "settings" as a dict, and the "input_file" name.</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>